
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The operating system for autonomous systems">
      
      
      
        <link rel="canonical" href="https://github.com/nervosys/Botnix/languages-frameworks/python.section.html">
      
      
        <link rel="prev" href="pkg-config.section.html">
      
      
        <link rel="next" href="qt.section.html">
      
      
      <link rel="icon" href="../media/images/rune.svg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.7">
    
    
      
        <title>Python - Botnix</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#python" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Botnix" class="md-header__button md-logo" aria-label="Botnix" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Botnix
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Python
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="nervosys" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/nervosys/Botnix" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    nervosys/Botnix
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Botnix" class="md-nav__button md-logo" aria-label="Botnix" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    Botnix
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nervosys/Botnix" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    nervosys/Botnix
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build helpers
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing to Nixpkgs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../development.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development of Nixpkgs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Functions reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nixpkgs lib
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../preface.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preface
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../stdenv.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standard environment
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../using-nixpkgs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Nixpkgs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Build helpers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Build helpers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/fetchers.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fetchers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Images
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Special build helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/testers.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/trivial-build-helpers.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trivial build helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_6" >
        
          
          <label class="md-nav__link" for="__nav_10_6" id="__nav_10_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Images
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_6">
            <span class="md-nav__icon md-icon"></span>
            Images
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/appimagetools.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.appimageTools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/binarycache.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.mkBinaryCache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/dockertools.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.dockerTools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/makediskimage.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    &lt;nixpkgs/nixos/lib/make-disk-image.nix&gt;
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/ocitools.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.ociTools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/portableservice.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.portableService
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/snaptools.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.snapTools
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_7" >
        
          
          <label class="md-nav__link" for="__nav_10_7" id="__nav_10_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Special
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_7">
            <span class="md-nav__icon md-icon"></span>
            Special
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/checkpoint-build.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.checkpointBuildTools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/fakenss.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fakeNss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/fhs-environments.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    buildFHSEnv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/makesetuphook.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.makeSetupHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/mkshell.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.mkShell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/vm-tools.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vmTools
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/coding-conventions.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coding conventions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/contributing-to-documentation.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing to Nixpkgs documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/quick-start.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start to Adding a Package
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/reviewing-contributions.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reviewing contributions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/submitting-changes.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submitting changes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/vulnerability-roundup.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vulnerability Roundup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/opening-issues.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Opening issues
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Functions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Functions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/debug.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging Nix Expressions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/generators.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/nix-gitignore.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.nix-gitignore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/prefer-remote-fetch.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    prefer-remote-fetch overlay
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hooks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Hooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hooks reference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/autoconf.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autoconf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/automake.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automake
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/autopatchelf.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    autoPatchelfHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/bmake.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bmake
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/breakpoint.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    breakpointHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/cmake.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cmake
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/gdk-pixbuf.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gdk-pixbuf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/ghc.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GHC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/gnome.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GNOME platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/installShellFiles.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    installShellFiles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/libiconv.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    libiconv, libintl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/libxml2.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    libxml2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/meson.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/mpi-check-hook.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mpiCheckPhaseHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/ninja.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ninja
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/patch-rc-path-hooks.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    patchRcPath hooks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/perl.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/pkg-config.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkg-config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/postgresql-test-hook.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    postgresqlTestHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/python.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/scons.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    scons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/tetex-tex-live.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    teTeX / TeX Live
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/unzip.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    unzip
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/validatePkgConfig.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    validatePkgConfig
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/waf.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    wafHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/xcbuild.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    xcbuildHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/zig.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zig.hook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" checked>
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Languages frameworks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            Languages frameworks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Languages and frameworks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="agda.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="android.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="beam.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BEAM Languages (Erlang, Elixir & LFE)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="bower.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bower
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="chicken.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CHICKEN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="coq.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coq and coq packages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="crystal.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crystal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cuda.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CUDA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cuelang.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cue (Cuelang)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dart.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dhall.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dhall
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dotnet.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dotnet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="emscripten.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Emscripten
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gnome.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GNOME
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="go.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Go
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="haskell.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Haskell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hy.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="idris.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Idris
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="idris2.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Idris2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ios.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="java.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="javascript.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Javascript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="julia.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Julia
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="lisp.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lisp-modules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="lua.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User’s Guide to Lua Infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="maven.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maven
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="nim.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ocaml.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="octave.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Octave
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="perl.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="php.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pkg-config.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkg-config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Python
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="python.section.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    <span class="md-ellipsis">
      Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interpreters" class="md-nav__link">
    <span class="md-ellipsis">
      Interpreters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Interpreters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#missing-tkinter-module-standard-library" class="md-nav__link">
    <span class="md-ellipsis">
      Missing tkinter module standard library
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attributes-on-interpreters-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes on interpreters packages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-packages-and-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Building packages and applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building packages and applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buildpythonpackage-function" class="md-nav__link">
    <span class="md-ellipsis">
      buildPythonPackage function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="buildPythonPackage function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buildpythonpackage-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      buildPythonPackage parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overriding-python-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Overriding Python packages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buildpythonapplication-function" class="md-nav__link">
    <span class="md-ellipsis">
      buildPythonApplication function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topythonapplication-function" class="md-nav__link">
    <span class="md-ellipsis">
      toPythonApplication function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topythonmodule-function" class="md-nav__link">
    <span class="md-ellipsis">
      toPythonModule function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python.buildenv-function" class="md-nav__link">
    <span class="md-ellipsis">
      python.buildEnv function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="python.buildEnv function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python.buildenv-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      python.buildEnv arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python.withpackages-function" class="md-nav__link">
    <span class="md-ellipsis">
      python.withPackages function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-hooks" class="md-nav__link">
    <span class="md-ellipsis">
      Setup hooks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Development mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-guide" class="md-nav__link">
    <span class="md-ellipsis">
      User Guide
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-python" class="md-nav__link">
    <span class="md-ellipsis">
      Using Python
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using Python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-python-and-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Python and packages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ad-hoc-temporary-python-environment-with-nix-shell" class="md-nav__link">
    <span class="md-ellipsis">
      Ad-hoc temporary Python environment with nix-shell
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ad-hoc temporary Python environment with nix-shell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-python-scripts-and-using-nix-shell-as-shebang" class="md-nav__link">
    <span class="md-ellipsis">
      Running Python scripts and using nix-shell as shebang
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-environment-from-.nix-expression" class="md-nav__link">
    <span class="md-ellipsis">
      Load environment from .nix expression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-environments-globally-on-the-system" class="md-nav__link">
    <span class="md-ellipsis">
      Installing environments globally on the system
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-defined-in-etcnixosconfiguration.nix" class="md-nav__link">
    <span class="md-ellipsis">
      Environment defined in /etc/nixos/configuration.nix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developing-with-python" class="md-nav__link">
    <span class="md-ellipsis">
      Developing with Python
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Developing with Python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-library-packages-in-nixpkgs" class="md-nav__link">
    <span class="md-ellipsis">
      Python library packages in Nixpkgs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Handling dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-python-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Python Packages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-pytest" class="md-nav__link">
    <span class="md-ellipsis">
      Using pytest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-pytestcheckhook" class="md-nav__link">
    <span class="md-ellipsis">
      Using pytestCheckHook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-pythonimportscheck" class="md-nav__link">
    <span class="md-ellipsis">
      Using pythonImportsCheck
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-pythonrelaxdepshook" class="md-nav__link">
    <span class="md-ellipsis">
      Using pythonRelaxDepsHook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-unittestcheckhook" class="md-nav__link">
    <span class="md-ellipsis">
      Using unittestCheckHook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-sphinxhook" class="md-nav__link">
    <span class="md-ellipsis">
      Using sphinxHook
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#develop-local-package" class="md-nav__link">
    <span class="md-ellipsis">
      Develop local package
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#organising-your-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Organising your packages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#including-a-derivation-using-callpackage" class="md-nav__link">
    <span class="md-ellipsis">
      Including a derivation using callPackage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    <span class="md-ellipsis">
      FAQ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FAQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-solve-circular-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      How to solve circular dependencies?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-override-a-python-package" class="md-nav__link">
    <span class="md-ellipsis">
      How to override a Python package?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-setup.py-bdist_wheel-cannot-create-.whl" class="md-nav__link">
    <span class="md-ellipsis">
      python setup.py bdist_wheel cannot create .whl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install_data-data_files-problems" class="md-nav__link">
    <span class="md-ellipsis">
      install_data / data_files problems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rationale-of-non-existent-global-site-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Rationale of non-existent global site-packages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-consume-python-modules-using-pip-in-a-virtual-environment-like-i-am-used-to-on-other-operating-systems" class="md-nav__link">
    <span class="md-ellipsis">
      How to consume Python modules using pip in a virtual environment like I am used to on other Operating Systems?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-override-a-python-package-from-configuration.nix" class="md-nav__link">
    <span class="md-ellipsis">
      How to override a Python package from configuration.nix?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-override-a-python-package-using-overlays" class="md-nav__link">
    <span class="md-ellipsis">
      How to override a Python package using overlays?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-override-a-python-package-for-all-python-versions-using-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      How to override a Python package for all Python versions using extensions?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use-intels-mkl-with-numpy-and-scipy" class="md-nav__link">
    <span class="md-ellipsis">
      How to use Intel’s MKL with numpy and scipy?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-inputs-do-setup_requires-install_requires-and-tests_require-map-to" class="md-nav__link">
    <span class="md-ellipsis">
      What inputs do setup_requires, install_requires and tests_require map to?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      How to enable interpreter optimizations?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-optional-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      How to add optional dependencies?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    <span class="md-ellipsis">
      How to contribute a Python package to nixpkgs?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deterministic-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Are Python interpreters built deterministically?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-tests" class="md-nav__link">
    <span class="md-ellipsis">
      How to provide automatic tests to Python packages?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How to provide automatic tests to Python packages?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Common issues
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contributing" class="md-nav__link">
    <span class="md-ellipsis">
      Contributing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contributing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contributing-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      Contributing guidelines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-package-set-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      Package set maintenance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Package set maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-package-bulk-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Updating packages in bulk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-cpython-update-schedule" class="md-nav__link">
    <span class="md-ellipsis">
      CPython Update Schedule
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="qt.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Qt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="r.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    R
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ruby.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ruby
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rust.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rust
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="swift.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Swift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="texlive.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TeX Live
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="titanium.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Titanium
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="vim.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vim
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Module system
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Module system
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../module-system/module-system.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Module System
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_17" >
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Packages
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            Packages
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Packages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/cataclysm-dda.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cataclysm: Dark Days Ahead
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/citrix.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Citrix Workspace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/darwin-builder.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    darwin.linux-builder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/dlib.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DLib
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/eclipse.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Eclipse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/elm.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Elm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/emacs.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Emacs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/etc-files.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    /etc files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/firefox.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Firefox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/fish.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fish
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/fuse.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FUSE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/ibus.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ibus-engines.typing-booster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/kakoune.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kakoune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/linux.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux kernel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/locales.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Locales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/nginx.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/opengl.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenGL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/shell-helpers.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interactive shell helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/steam.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Steam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/urxvt.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Urxvt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/weechat.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WeeChat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/xorg.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    X.org
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_18" >
        
          
          <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stdenv
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            Stdenv
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stdenv/cross-compilation.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross-compilation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stdenv/meta.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meta-attributes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stdenv/multiple-output.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple-output packages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stdenv/platform-notes.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Platform Notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stdenv/stdenv.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Standard Environment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_19" >
        
          
          <label class="md-nav__link" for="__nav_19" id="__nav_19_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Using
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19">
            <span class="md-nav__icon md-icon"></span>
            Using
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../using/configuration.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Global configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../using/overlays.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overlays
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../using/overrides.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overriding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../using/platform-support.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Platform Support
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="python">Python<a class="headerlink" href="#python" title="Permanent link">#</a></h1>
<h2 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">#</a></h2>
<h3 id="interpreters">Interpreters<a class="headerlink" href="#interpreters" title="Permanent link">#</a></h3>
<table>
<thead>
<tr>
<th>Package</th>
<th>Aliases</th>
<th>Interpreter</th>
</tr>
</thead>
<tbody>
<tr>
<td>python27</td>
<td>python2, python</td>
<td>CPython 2.7</td>
</tr>
<tr>
<td>python38</td>
<td></td>
<td>CPython 3.8</td>
</tr>
<tr>
<td>python39</td>
<td></td>
<td>CPython 3.9</td>
</tr>
<tr>
<td>python310</td>
<td></td>
<td>CPython 3.10</td>
</tr>
<tr>
<td>python311</td>
<td>python3</td>
<td>CPython 3.11</td>
</tr>
<tr>
<td>python312</td>
<td></td>
<td>CPython 3.12</td>
</tr>
<tr>
<td>python313</td>
<td></td>
<td>CPython 3.13</td>
</tr>
<tr>
<td>pypy27</td>
<td>pypy2, pypy</td>
<td>PyPy2.7</td>
</tr>
<tr>
<td>pypy39</td>
<td>pypy3</td>
<td>PyPy 3.9</td>
</tr>
</tbody>
</table>
<p>The Nix expressions for the interpreters can be found in
<code>pkgs/development/interpreters/python</code>.</p>
<p>All packages depending on any Python interpreter get appended
<code>out/{python.sitePackages}</code> to <code>$PYTHONPATH</code> if such directory
exists.</p>
<h4 id="missing-tkinter-module-standard-library">Missing <code>tkinter</code> module standard library<a class="headerlink" href="#missing-tkinter-module-standard-library" title="Permanent link">#</a></h4>
<p>To reduce closure size the <code>Tkinter</code>/<code>tkinter</code> is available as a separate package, <code>pythonPackages.tkinter</code>.</p>
<h4 id="attributes-on-interpreters-packages">Attributes on interpreters packages<a class="headerlink" href="#attributes-on-interpreters-packages" title="Permanent link">#</a></h4>
<p>Each interpreter has the following attributes:</p>
<ul>
<li><code>libPrefix</code>. Name of the folder in <code>${python}/lib/</code> for corresponding interpreter.</li>
<li><code>interpreter</code>. Alias for <code>${python}/bin/${executable}</code>.</li>
<li><code>buildEnv</code>. Function to build python interpreter environments with extra packages bundled together. See <a href="#python.buildenv-function"></a> for usage and documentation.</li>
<li><code>withPackages</code>. Simpler interface to <code>buildEnv</code>. See <a href="#python.withpackages-function"></a> for usage and documentation.</li>
<li><code>sitePackages</code>. Alias for <code>lib/${libPrefix}/site-packages</code>.</li>
<li><code>executable</code>. Name of the interpreter executable, e.g. <code>python3.10</code>.</li>
<li><code>pkgs</code>. Set of Python packages for that specific interpreter. The package set can be modified by overriding the interpreter and passing <code>packageOverrides</code>.</li>
</ul>
<h3 id="building-packages-and-applications">Building packages and applications<a class="headerlink" href="#building-packages-and-applications" title="Permanent link">#</a></h3>
<p>Python libraries and applications that use <code>setuptools</code> or
<code>distutils</code> are typically built with respectively the <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a> and
<a href="#buildpythonapplication-function"><code>buildPythonApplication</code></a> functions. These two functions also support installing a <code>wheel</code>.</p>
<p>All Python packages reside in <code>pkgs/top-level/python-packages.nix</code> and all
applications elsewhere. In case a package is used as both a library and an
application, then the package should be in <code>pkgs/top-level/python-packages.nix</code>
since only those packages are made available for all interpreter versions. The
preferred location for library expressions is in
<code>pkgs/development/python-modules</code>. It is important that these packages are
called from <code>pkgs/top-level/python-packages.nix</code> and not elsewhere, to guarantee
the right version of the package is built.</p>
<p>Based on the packages defined in <code>pkgs/top-level/python-packages.nix</code> an
attribute set is created for each available Python interpreter. The available
sets are</p>
<ul>
<li><code>pkgs.python27Packages</code></li>
<li><code>pkgs.python3Packages</code></li>
<li><code>pkgs.python38Packages</code></li>
<li><code>pkgs.python39Packages</code></li>
<li><code>pkgs.python310Packages</code></li>
<li><code>pkgs.python311Packages</code></li>
<li><code>pkgs.python312Packages</code></li>
<li><code>pkgs.python313Packages</code></li>
<li><code>pkgs.pypyPackages</code></li>
</ul>
<p>and the aliases</p>
<ul>
<li><code>pkgs.python2Packages</code> pointing to <code>pkgs.python27Packages</code></li>
<li><code>pkgs.python3Packages</code> pointing to <code>pkgs.python311Packages</code></li>
<li><code>pkgs.pythonPackages</code> pointing to <code>pkgs.python2Packages</code></li>
</ul>
<h4 id="buildpythonpackage-function"><code>buildPythonPackage</code> function<a class="headerlink" href="#buildpythonpackage-function" title="Permanent link">#</a></h4>
<p>The <code>buildPythonPackage</code> function is implemented in
<code>pkgs/development/interpreters/python/mk-python-derivation.nix</code>
using setup hooks.</p>
<p>The following is an example:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span> lib
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="p">,</span> buildPythonPackage
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">,</span> fetchPypi
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1"># build-system</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">,</span> setuptools-scm
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># dependencies</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">,</span> attrs
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="p">,</span> pluggy
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="p">,</span> py
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="p">,</span> setuptools
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">,</span> six
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="c1"># tests</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="p">,</span> hypothesis
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a> <span class="p">}:</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>buildPythonPackage <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;pytest&quot;</span><span class="p">;</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;3.3.1&quot;</span><span class="p">;</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>  <span class="ss">pyproject</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>  <span class="ss">src</span> <span class="o">=</span> fetchPypi <span class="p">{</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>    <span class="k">inherit</span> pname version<span class="p">;</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-z4Q23FnYaVNG/NOrKW3kZCXsqwDWQJbOvnn7Ueyy65M=&quot;</span><span class="p">;</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>  <span class="p">};</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>  <span class="ss">postPatch</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="s s-Multiline">    # don&#39;t test bash builtins</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="s s-Multiline">    rm testing/test_argcomplete.py</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>  <span class="ss">nativeBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>    setuptools-scm
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>  <span class="p">];</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>  <span class="ss">propagatedBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    attrs
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>    py
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>    setuptools
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>    six
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    pluggy
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>  <span class="p">];</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>  <span class="ss">nativeCheckInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>    hypothesis
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>  <span class="p">];</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>  <span class="ss">meta</span> <span class="o">=</span> <span class="k">with</span> lib<span class="p">;</span> <span class="p">{</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>    <span class="ss">changelog</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/pytest-dev/pytest/releases/tag/</span><span class="si">${</span>version<span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>    <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Framework for writing tests&quot;</span><span class="p">;</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>    <span class="ss">homepage</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/pytest-dev/pytest&quot;</span><span class="p">;</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>    <span class="ss">license</span> <span class="o">=</span> licenses<span class="o">.</span>mit<span class="p">;</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>    <span class="ss">maintainers</span> <span class="o">=</span> <span class="k">with</span> maintainers<span class="p">;</span> <span class="p">[</span> domenkozar lovek323 madjar lsix <span class="p">];</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>  <span class="p">};</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>buildPythonPackage</code> mainly does four things:</p>
<ul>
<li>In the <a href="#build-phase"><code>buildPhase</code></a>, it calls <code>${python.pythonOnBuildForHost.interpreter} setup.py bdist_wheel</code> to
  build a wheel binary zipfile.</li>
<li>In the <a href="#ssec-install-phase"><code>installPhase</code></a>, it installs the wheel file using <code>pip install *.whl</code>.</li>
<li>In the <a href="#var-stdenv-postFixup"><code>postFixup</code></a> phase, the <code>wrapPythonPrograms</code> bash function is called to
  wrap all programs in the <code>$out/bin/*</code> directory to include <code>$PATH</code>
  environment variable and add dependent libraries to script's <code>sys.path</code>.</li>
<li>In the <a href="#ssec-installCheck-phase"><code>installCheck</code></a> phase, <code>${python.interpreter} setup.py test</code> is run.</li>
</ul>
<p>By default tests are run because <a href="#var-stdenv-doCheck"><code>doCheck = true</code></a>. Test dependencies, like
e.g. the test runner, should be added to <a href="#var-stdenv-nativeCheckInputs"><code>nativeCheckInputs</code></a>.</p>
<p>By default <code>meta.platforms</code> is set to the same value
as the interpreter unless overridden otherwise.</p>
<h5 id="buildpythonpackage-parameters"><code>buildPythonPackage</code> parameters<a class="headerlink" href="#buildpythonpackage-parameters" title="Permanent link">#</a></h5>
<p>All parameters from <a href="#sec-using-stdenv"><code>stdenv.mkDerivation</code></a> function are still supported. The
following are specific to <code>buildPythonPackage</code>:</p>
<ul>
<li><code>catchConflicts ? true</code>: If <code>true</code>, abort package build if a package name
  appears more than once in dependency tree. Default is <code>true</code>.</li>
<li><code>disabled ? false</code>: If <code>true</code>, package is not built for the particular Python
  interpreter version.</li>
<li><code>dontWrapPythonPrograms ? false</code>: Skip wrapping of Python programs.</li>
<li><code>permitUserSite ? false</code>: Skip setting the <code>PYTHONNOUSERSITE</code> environment
  variable in wrapped programs.</li>
<li><code>pyproject</code>: Whether the pyproject format should be used. When set to <code>true</code>,
  <code>pypaBuildHook</code> will be used, and you can add the required build dependencies
  from <code>build-system.requires</code> to <code>nativeBuildInputs</code>. Note that the pyproject
  format falls back to using <code>setuptools</code>, so you can use <code>pyproject = true</code>
  even if the package only has a <code>setup.py</code>. When set to <code>false</code>, you can
  use the existing [hooks](#setup-hooks0 or provide your own logic to build the
  package. This can be useful for packages that don't support the pyproject
  format. When unset, the legacy <code>setuptools</code> hooks are used for backwards
  compatibility.</li>
<li><code>makeWrapperArgs ? []</code>: A list of strings. Arguments to be passed to
  <a href="#fun-makeWrapper"><code>makeWrapper</code></a>, which wraps generated binaries. By default, the arguments to
  <a href="#fun-makeWrapper"><code>makeWrapper</code></a> set <code>PATH</code> and <code>PYTHONPATH</code> environment variables before calling
  the binary. Additional arguments here can allow a developer to set environment
  variables which will be available when the binary is run. For example,
  <code>makeWrapperArgs = ["--set FOO BAR" "--set BAZ QUX"]</code>.</li>
<li><code>namePrefix</code>: Prepends text to <code>${name}</code> parameter. In case of libraries, this
  defaults to <code>"python3.8-"</code> for Python 3.8, etc., and in case of applications to <code>""</code>.</li>
<li><code>pipInstallFlags ? []</code>: A list of strings. Arguments to be passed to <code>pip
  install</code>. To pass options to <code>python setup.py install</code>, use
  <code>--install-option</code>. E.g., <code>pipInstallFlags=["--install-option='--cpp_implementation'"]</code>.</li>
<li><code>pipBuildFlags ? []</code>: A list of strings. Arguments to be passed to <code>pip wheel</code>.</li>
<li><code>pypaBuildFlags ? []</code>: A list of strings. Arguments to be passed to <code>python -m build --wheel</code>.</li>
<li><code>pythonPath ? []</code>: List of packages to be added into <code>$PYTHONPATH</code>. Packages
  in <code>pythonPath</code> are not propagated (contrary to <a href="#var-stdenv-propagatedBuildInputs"><code>propagatedBuildInputs</code></a>).</li>
<li><code>preShellHook</code>: Hook to execute commands before <code>shellHook</code>.</li>
<li><code>postShellHook</code>: Hook to execute commands after <code>shellHook</code>.</li>
<li><code>removeBinByteCode ? true</code>: Remove bytecode from <code>/bin</code>. Bytecode is only
  created when the filenames end with <code>.py</code>.</li>
<li><code>setupPyGlobalFlags ? []</code>: List of flags passed to <code>setup.py</code> command.</li>
<li><code>setupPyBuildFlags ? []</code>: List of flags passed to <code>setup.py build_ext</code> command.</li>
</ul>
<p>The <a href="#sec-using-stdenv"><code>stdenv.mkDerivation</code></a> function accepts various parameters for describing
build inputs (see "Specifying dependencies"). The following are of special
interest for Python packages, either because these are primarily used, or
because their behaviour is different:</p>
<ul>
<li><code>nativeBuildInputs ? []</code>: Build-time only dependencies. Typically executables
  as well as the items listed in <code>setup_requires</code>.</li>
<li><code>buildInputs ? []</code>: Build and/or run-time dependencies that need to be
  compiled for the host machine. Typically non-Python libraries which are being
  linked.</li>
<li><code>nativeCheckInputs ? []</code>: Dependencies needed for running the <a href="#ssec-check-phase"><code>checkPhase</code></a>. These
  are added to <a href="#var-stdenv-nativeBuildInputs"><code>nativeBuildInputs</code></a> when <a href="#var-stdenv-doCheck"><code>doCheck = true</code></a>. Items listed in
  <code>tests_require</code> go here.</li>
<li><code>propagatedBuildInputs ? []</code>: Aside from propagating dependencies,
  <code>buildPythonPackage</code> also injects code into and wraps executables with the
  paths included in this list. Items listed in <code>install_requires</code> go here.</li>
</ul>
<h5 id="overriding-python-packages">Overriding Python packages<a class="headerlink" href="#overriding-python-packages" title="Permanent link">#</a></h5>
<p>The <code>buildPythonPackage</code> function has a <code>overridePythonAttrs</code> method that can be
used to override the package. In the following example we create an environment
where we have the <code>blaze</code> package using an older version of <code>pandas</code>. We
override first the Python interpreter and pass <code>packageOverrides</code> which contains
the overrides for packages in the package set.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="p">(</span><span class="k">let</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>  <span class="ss">python</span> <span class="o">=</span> <span class="k">let</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="ss">packageOverrides</span> <span class="o">=</span> self<span class="p">:</span> super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>      <span class="ss">pandas</span> <span class="o">=</span> super<span class="o">.</span>pandas<span class="o">.</span>overridePythonAttrs<span class="p">(</span>old<span class="p">:</span> <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>        <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;0.19.1&quot;</span><span class="p">;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>        <span class="ss">src</span> <span class="o">=</span>  fetchPypi <span class="p">{</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>          <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;pandas&quot;</span><span class="p">;</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>          <span class="k">inherit</span> version<span class="p">;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>          <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-JQn+rtpy/OA2deLszSKEuxyttqBzcAil50H+JDHUdCE=&quot;</span><span class="p">;</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>        <span class="p">};</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>      <span class="p">});</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="p">};</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>  <span class="k">in</span> pkgs<span class="o">.</span>python3<span class="o">.</span>override <span class="p">{</span><span class="k">inherit</span> packageOverrides<span class="p">;</span> <span class="ss">self</span> <span class="o">=</span> python<span class="p">;};</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="k">in</span> python<span class="o">.</span>withPackages<span class="p">(</span>ps<span class="p">:</span> <span class="p">[</span> ps<span class="o">.</span>blaze <span class="p">]))</span><span class="o">.</span>env
</span></code></pre></div>
<p>The next example shows a non trivial overriding of the <code>blas</code> implementation to
be used through out all of the Python package set:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="ss">python3MyBlas</span> <span class="o">=</span> pkgs<span class="o">.</span>python3<span class="o">.</span>override <span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>  <span class="ss">packageOverrides</span> <span class="o">=</span> self<span class="p">:</span> super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="c1"># We need toPythonModule for the package set to evaluate this</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="ss">blas</span> <span class="o">=</span> super<span class="o">.</span>toPythonModule<span class="p">(</span>super<span class="o">.</span>pkgs<span class="o">.</span>blas<span class="o">.</span>override <span class="p">{</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>      <span class="ss">blasProvider</span> <span class="o">=</span> super<span class="o">.</span>pkgs<span class="o">.</span>mkl<span class="p">;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="p">});</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="ss">lapack</span> <span class="o">=</span> super<span class="o">.</span>toPythonModule<span class="p">(</span>super<span class="o">.</span>pkgs<span class="o">.</span>lapack<span class="o">.</span>override <span class="p">{</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>      <span class="ss">lapackProvider</span> <span class="o">=</span> super<span class="o">.</span>pkgs<span class="o">.</span>mkl<span class="p">;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    <span class="p">});</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>  <span class="p">};</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="p">};</span>
</span></code></pre></div>
<p>This is particularly useful for numpy and scipy users who want to gain speed with other blas implementations.
Note that using <code>scipy = super.scipy.override { blas = super.pkgs.mkl; };</code> will likely result in
compilation issues, because scipy dependencies need to use the same blas implementation as well.</p>
<h4 id="buildpythonapplication-function"><code>buildPythonApplication</code> function<a class="headerlink" href="#buildpythonapplication-function" title="Permanent link">#</a></h4>
<p>The <a href="#buildpythonapplication-function"><code>buildPythonApplication</code></a> function is practically the same as
<a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a>. The main purpose of this function is to build a Python
package where one is interested only in the executables, and not importable
modules. For that reason, when adding this package to a <a href="#python.buildenv-function"><code>python.buildEnv</code></a>, the
modules won't be made available.</p>
<p>Another difference is that <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a> by default prefixes the names of
the packages with the version of the interpreter. Because this is irrelevant for
applications, the prefix is omitted.</p>
<p>When packaging a Python application with <a href="#buildpythonapplication-function"><code>buildPythonApplication</code></a>, it should be
called with <code>callPackage</code> and passed <code>python3</code> or <code>python3Packages</code> (possibly
specifying an interpreter version), like this:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span> lib
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="p">,</span> python3Packages
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">,</span> fetchPypi
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="p">}:</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>python3Packages<span class="o">.</span>buildPythonApplication <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;luigi&quot;</span><span class="p">;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;2.7.9&quot;</span><span class="p">;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>  <span class="ss">pyproject</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>  <span class="ss">src</span> <span class="o">=</span> fetchPypi <span class="p">{</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="k">inherit</span> pname version<span class="p">;</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="ss">hash</span>  <span class="o">=</span> <span class="s2">&quot;sha256-Pe229rT0aHwA98s+nTHQMEFKZPo/yw6sot8MivFDvAw=&quot;</span><span class="p">;</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>  <span class="p">};</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>  <span class="ss">nativeBuildInputs</span> <span class="o">=</span> <span class="k">with</span> python3Packages<span class="p">;</span> <span class="p">[</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>    setuptools
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>  <span class="p">];</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>  <span class="ss">propagatedBuildInputs</span> <span class="o">=</span> <span class="k">with</span> python3Packages<span class="p">;</span> <span class="p">[</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>    tornado
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>    python-daemon
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>  <span class="p">];</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>  <span class="ss">meta</span> <span class="o">=</span> <span class="k">with</span> lib<span class="p">;</span> <span class="p">{</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>    <span class="c1"># ...</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>  <span class="p">};</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="p">}</span>
</span></code></pre></div>
<p>This is then added to <code>all-packages.nix</code> just as any other application would be.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="ss">luigi</span> <span class="o">=</span> callPackage <span class="l">../applications/networking/cluster/luigi</span> <span class="p">{</span> <span class="p">};</span>
</span></code></pre></div>
<p>Since the package is an application, a consumer doesn't need to care about
Python versions or modules, which is why they don't go in <code>python3Packages</code>.</p>
<h4 id="topythonapplication-function"><code>toPythonApplication</code> function<a class="headerlink" href="#topythonapplication-function" title="Permanent link">#</a></h4>
<p>A distinction is made between applications and libraries, however, sometimes a
package is used as both. In this case the package is added as a library to
<code>python-packages.nix</code> and as an application to <code>all-packages.nix</code>. To reduce
duplication the <code>toPythonApplication</code> can be used to convert a library to an
application.</p>
<p>The Nix expression shall use <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a> and be called from
<code>python-packages.nix</code>. A reference shall be created from <code>all-packages.nix</code> to
the attribute in <code>python-packages.nix</code>, and the <code>toPythonApplication</code> shall be
applied to the reference:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="ss">youtube-dl</span> <span class="o">=</span> <span class="k">with</span> python3Packages<span class="p">;</span> toPythonApplication youtube-dl<span class="p">;</span>
</span></code></pre></div>
<h4 id="topythonmodule-function"><code>toPythonModule</code> function<a class="headerlink" href="#topythonmodule-function" title="Permanent link">#</a></h4>
<p>In some cases, such as bindings, a package is created using
<a href="#sec-using-stdenv"><code>stdenv.mkDerivation</code></a> and added as attribute in <code>all-packages.nix</code>. The Python
bindings should be made available from <code>python-packages.nix</code>. The
<code>toPythonModule</code> function takes a derivation and makes certain Python-specific
modifications.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="ss">opencv</span> <span class="o">=</span> toPythonModule <span class="p">(</span>pkgs<span class="o">.</span>opencv<span class="o">.</span>override <span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>  <span class="ss">enablePython</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  <span class="ss">pythonPackages</span> <span class="o">=</span> self<span class="p">;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">});</span>
</span></code></pre></div>
<p>Do pay attention to passing in the right Python version!</p>
<h4 id="python.buildenv-function"><code>python.buildEnv</code> function<a class="headerlink" href="#python.buildenv-function" title="Permanent link">#</a></h4>
<p>Python environments can be created using the low-level <code>pkgs.buildEnv</code> function.
This example shows how to create an environment that has the Pyramid Web Framework.
Saving the following as <code>default.nix</code></p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>python3<span class="o">.</span>buildEnv<span class="o">.</span>override <span class="p">{</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>  <span class="ss">extraLibs</span> <span class="o">=</span> <span class="p">[</span> python3Packages<span class="o">.</span>pyramid <span class="p">];</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>  <span class="ss">ignoreCollisions</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>and running <code>nix-build</code> will create</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>/nix/store/cf1xhjwzmdki7fasgr4kz6di72ykicl5-python-2.7.8-env
</span></code></pre></div>
<p>with wrapped binaries in <code>bin/</code>.</p>
<p>You can also use the <code>env</code> attribute to create local environments with needed
packages installed. This is somewhat comparable to <code>virtualenv</code>. For example,
running <code>nix-shell</code> with the following <code>shell.nix</code></p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="p">(</span>python3<span class="o">.</span>buildEnv<span class="o">.</span>override <span class="p">{</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>  <span class="ss">extraLibs</span> <span class="o">=</span> <span class="k">with</span> python3Packages<span class="p">;</span> <span class="p">[</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    numpy
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    requests
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>  <span class="p">];</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="p">})</span><span class="o">.</span>env
</span></code></pre></div>
<p>will drop you into a shell where Python will have the
specified packages in its path.</p>
<h5 id="python.buildenv-arguments"><code>python.buildEnv</code> arguments<a class="headerlink" href="#python.buildenv-arguments" title="Permanent link">#</a></h5>
<ul>
<li><code>extraLibs</code>: List of packages installed inside the environment.</li>
<li><code>postBuild</code>: Shell command executed after the build of environment.</li>
<li><code>ignoreCollisions</code>: Ignore file collisions inside the environment (default is <code>false</code>).</li>
<li><code>permitUserSite</code>: Skip setting the <code>PYTHONNOUSERSITE</code> environment variable in
  wrapped binaries in the environment.</li>
</ul>
<h4 id="python.withpackages-function"><code>python.withPackages</code> function<a class="headerlink" href="#python.withpackages-function" title="Permanent link">#</a></h4>
<p>The <a href="#python.withpackages-function"><code>python.withPackages</code></a> function provides a simpler interface to the <a href="#python.buildenv-function"><code>python.buildEnv</code></a> functionality.
It takes a function as an argument that is passed the set of python packages and returns the list
of the packages to be included in the environment. Using the <a href="#python.withpackages-function"><code>withPackages</code></a> function, the previous
example for the Pyramid Web Framework environment can be written like this:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>python<span class="o">.</span>withPackages <span class="p">(</span>ps<span class="p">:</span> <span class="p">[</span> ps<span class="o">.</span>pyramid <span class="p">])</span>
</span></code></pre></div>
<p><a href="#python.withpackages-function"><code>withPackages</code></a> passes the correct package set for the specific interpreter
version as an argument to the function. In the above example, <code>ps</code> equals
<code>pythonPackages</code>. But you can also easily switch to using python3:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>python3<span class="o">.</span>withPackages <span class="p">(</span>ps<span class="p">:</span> <span class="p">[</span> ps<span class="o">.</span>pyramid <span class="p">])</span>
</span></code></pre></div>
<p>Now, <code>ps</code> is set to <code>python3Packages</code>, matching the version of the interpreter.</p>
<p>As <a href="#python.withpackages-function"><code>python.withPackages</code></a> uses <a href="#python.buildenv-function"><code>python.buildEnv</code></a> under the hood, it also
supports the <code>env</code> attribute. The <code>shell.nix</code> file from the previous section can
thus be also written like this:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="p">(</span>python3<span class="o">.</span>withPackages <span class="p">(</span>ps<span class="p">:</span> <span class="k">with</span> ps<span class="p">;</span> <span class="p">[</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>  numpy
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>  requests
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="p">]))</span><span class="o">.</span>env
</span></code></pre></div>
<p>In contrast to <a href="#python.buildenv-function"><code>python.buildEnv</code></a>, <a href="#python.withpackages-function"><code>python.withPackages</code></a> does not support the
more advanced options such as <code>ignoreCollisions = true</code> or <code>postBuild</code>. If you
need them, you have to use <a href="#python.buildenv-function"><code>python.buildEnv</code></a>.</p>
<p>Python 2 namespace packages may provide <code>__init__.py</code> that collide. In that case
<a href="#python.buildenv-function"><code>python.buildEnv</code></a> should be used with <code>ignoreCollisions = true</code>.</p>
<h4 id="setup-hooks">Setup hooks<a class="headerlink" href="#setup-hooks" title="Permanent link">#</a></h4>
<p>The following are setup hooks specifically for Python packages. Most of these
are used in <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a>.</p>
<ul>
<li><code>eggUnpackhook</code> to move an egg to the correct folder so it can be installed
  with the <code>eggInstallHook</code></li>
<li><code>eggBuildHook</code> to skip building for eggs.</li>
<li><code>eggInstallHook</code> to install eggs.</li>
<li><code>pipBuildHook</code> to build a wheel using <code>pip</code> and PEP 517. Note a build system
  (e.g. <code>setuptools</code> or <code>flit</code>) should still be added as <code>nativeBuildInput</code>.</li>
<li><code>pypaBuildHook</code> to build a wheel using
  <a href="https://pypa-build.readthedocs.io/en/latest/index.html"><code>pypa/build</code></a> and
  PEP 517/518. Note a build system (e.g. <code>setuptools</code> or <code>flit</code>) should still
  be added as <code>nativeBuildInput</code>.</li>
<li><code>pipInstallHook</code> to install wheels.</li>
<li><code>pytestCheckHook</code> to run tests with <code>pytest</code>. See <a href="#using-pytestcheckhook">example usage</a>.</li>
<li><code>pythonCatchConflictsHook</code> to check whether a Python package is not already existing.</li>
<li><code>pythonImportsCheckHook</code> to check whether importing the listed modules works.</li>
<li><code>pythonRelaxDepsHook</code> will relax Python dependencies restrictions for the package.
  See <a href="#using-pythonrelaxdepshook">example usage</a>.</li>
<li><code>pythonRemoveBinBytecode</code> to remove bytecode from the <code>/bin</code> folder.</li>
<li><code>setuptoolsBuildHook</code> to build a wheel using <code>setuptools</code>.</li>
<li><code>setuptoolsCheckHook</code> to run tests with <code>python setup.py test</code>.</li>
<li><code>sphinxHook</code> to build documentation and manpages using Sphinx.</li>
<li><code>venvShellHook</code> to source a Python 3 <code>venv</code> at the <code>venvDir</code> location. A
  <code>venv</code> is created if it does not yet exist. <code>postVenvCreation</code> can be used to
  to run commands only after venv is first created.</li>
<li><code>wheelUnpackHook</code> to move a wheel to the correct folder so it can be installed
  with the <code>pipInstallHook</code>.</li>
<li><code>unittestCheckHook</code> will run tests with <code>python -m unittest discover</code>. See <a href="#using-unittestcheckhook">example usage</a>.</li>
</ul>
<h3 id="development-mode">Development mode<a class="headerlink" href="#development-mode" title="Permanent link">#</a></h3>
<p>Development or editable mode is supported. To develop Python packages
<a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a> has additional logic inside <code>shellPhase</code> to run <code>pip
install -e . --prefix $TMPDIR/</code>for the package.</p>
<p>Warning: <code>shellPhase</code> is executed only if <code>setup.py</code> exists.</p>
<p>Given a <code>default.nix</code>:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>python3Packages<span class="o">.</span>buildPythonPackage <span class="p">{</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>  <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;myproject&quot;</span><span class="p">;</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>  <span class="ss">buildInputs</span> <span class="o">=</span> <span class="k">with</span> python3Packages<span class="p">;</span> <span class="p">[</span> pyramid <span class="p">];</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>  <span class="ss">src</span> <span class="o">=</span> <span class="l">./.</span><span class="p">;</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>Running <code>nix-shell</code> with no arguments should give you the environment in which
the package would be built with <code>nix-build</code>.</p>
<p>Shortcut to setup environments with C headers/libraries and Python packages:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>nix-shell<span class="w"> </span>-p<span class="w"> </span>python3Packages.pyramid<span class="w"> </span>zlib<span class="w"> </span>libjpeg<span class="w"> </span>git
</span></code></pre></div>
<p>::: {.note}
There is a boolean value <code>lib.inNixShell</code> set to <code>true</code> if nix-shell is invoked.
:::</p>
<h2 id="user-guide">User Guide<a class="headerlink" href="#user-guide" title="Permanent link">#</a></h2>
<h3 id="using-python">Using Python<a class="headerlink" href="#using-python" title="Permanent link">#</a></h3>
<h4 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">#</a></h4>
<p>Several versions of the Python interpreter are available on Nix, as well as a
high amount of packages. The attribute <code>python3</code> refers to the default
interpreter, which is currently CPython 3.11. The attribute <code>python</code> refers to
CPython 2.7 for backwards-compatibility. It is also possible to refer to
specific versions, e.g. <code>python311</code> refers to CPython 3.11, and <code>pypy</code> refers to
the default PyPy interpreter.</p>
<p>Python is used a lot, and in different ways. This affects also how it is
packaged. In the case of Python on Nix, an important distinction is made between
whether the package is considered primarily an application, or whether it should
be used as a library, i.e., of primary interest are the modules in
<code>site-packages</code> that should be importable.</p>
<p>In the Nixpkgs tree Python applications can be found throughout, depending on
what they do, and are called from the main package set. Python libraries,
however, are in separate sets, with one set per interpreter version.</p>
<p>The interpreters have several common attributes. One of these attributes is
<code>pkgs</code>, which is a package set of Python libraries for this specific
interpreter. E.g., the <code>toolz</code> package corresponding to the default interpreter
is <code>python3.pkgs.toolz</code>, and the CPython 3.11 version is <code>python311.pkgs.toolz</code>.
The main package set contains aliases to these package sets, e.g.
<code>pythonPackages</code> refers to <code>python.pkgs</code> and <code>python311Packages</code> to
<code>python311.pkgs</code>.</p>
<h4 id="installing-python-and-packages">Installing Python and packages<a class="headerlink" href="#installing-python-and-packages" title="Permanent link">#</a></h4>
<p>The Nix and NixOS manuals explain how packages are generally installed. In the
case of Python and Nix, it is important to make a distinction between whether the
package is considered an application or a library.</p>
<p>Applications on Nix are typically installed into your user profile imperatively
using <code>nix-env -i</code>, and on NixOS declaratively by adding the package name to
<code>environment.systemPackages</code> in <code>/etc/nixos/configuration.nix</code>. Dependencies
such as libraries are automatically installed and should not be installed
explicitly.</p>
<p>The same goes for Python applications. Python applications can be installed in
your profile, and will be wrapped to find their exact library dependencies,
without impacting other applications or polluting your user environment.</p>
<p>But Python libraries you would like to use for development cannot be installed,
at least not individually, because they won't be able to find each other
resulting in import errors. Instead, it is possible to create an environment
with <a href="#python.buildenv-function"><code>python.buildEnv</code></a> or <a href="#python.withpackages-function"><code>python.withPackages</code></a> where the interpreter and other
executables are wrapped to be able to find each other and all of the modules.</p>
<p>In the following examples we will start by creating a simple, ad-hoc environment
with a nix-shell that has <code>numpy</code> and <code>toolz</code> in Python 3.11; then we will create
a re-usable environment in a single-file Python script; then we will create a
full Python environment for development with this same environment.</p>
<p>Philosophically, this should be familiar to users who are used to a <code>venv</code> style
of development: individual projects create their own Python environments without
impacting the global environment or each other.</p>
<h4 id="ad-hoc-temporary-python-environment-with-nix-shell">Ad-hoc temporary Python environment with <code>nix-shell</code><a class="headerlink" href="#ad-hoc-temporary-python-environment-with-nix-shell" title="Permanent link">#</a></h4>
<p>The simplest way to start playing with the way nix wraps and sets up Python
environments is with <code>nix-shell</code> at the cmdline. These environments create a
temporary shell session with a Python and a <em>precise</em> list of packages (plus
their runtime dependencies), with no other Python packages in the Python
interpreter's scope.</p>
<p>To create a Python 3.11 session with <code>numpy</code> and <code>toolz</code> available, run:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>$<span class="w"> </span>nix-shell<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;python311.withPackages(ps: with ps; [ numpy toolz ])&#39;</span>
</span></code></pre></div>
<p>By default <code>nix-shell</code> will start a <code>bash</code> session with this interpreter in our
<code>PATH</code>, so if we then run:</p>
<p>```Python console
[nix-shell:~/src/nixpkgs]$ python3
Python 3.11.3 (main, Apr  4 2023, 22:36:41) [GCC 12.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.</p>
<blockquote>
<blockquote>
<blockquote>
<p>import numpy; import toolz
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Note that no other modules are in scope, even if they were imperatively
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>installed into our user environment as a dependency of a Python application:
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>```Python console
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>&gt;&gt;&gt; import requests
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>Traceback (most recent call last):
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>ModuleNotFoundError: No module named &#39;requests&#39;
</span></code></pre></div></p>
</blockquote>
</blockquote>
</blockquote>
<p>We can add as many additional modules onto the <code>nix-shell</code> as we need, and we
will still get 1 wrapped Python interpreter. We can start the interpreter
directly like so:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>$<span class="w"> </span>nix-shell<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;python311.withPackages (ps: with ps; [ numpy toolz requests ])&quot;</span><span class="w"> </span>--run<span class="w"> </span>python3
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>this<span class="w"> </span>derivation<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>built:
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span>/nix/store/r19yf5qgfiakqlhkgjahbg3zg79549n4-python3-3.11.2-env.drv
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>building<span class="w"> </span><span class="s1">&#39;/nix/store/r19yf5qgfiakqlhkgjahbg3zg79549n4-python3-3.11.2-env.drv&#39;</span>...
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>created<span class="w"> </span><span class="m">273</span><span class="w"> </span>symlinks<span class="w"> </span><span class="k">in</span><span class="w"> </span>user<span class="w"> </span>environment
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>Python<span class="w"> </span><span class="m">3</span>.11.2<span class="w"> </span><span class="o">(</span>main,<span class="w"> </span>Feb<span class="w">  </span><span class="m">7</span><span class="w"> </span><span class="m">2023</span>,<span class="w"> </span><span class="m">13</span>:52:42<span class="o">)</span><span class="w"> </span><span class="o">[</span>GCC<span class="w"> </span><span class="m">12</span>.2.0<span class="o">]</span><span class="w"> </span>on<span class="w"> </span>linux
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>Type<span class="w"> </span><span class="s2">&quot;help&quot;</span>,<span class="w"> </span><span class="s2">&quot;copyright&quot;</span>,<span class="w"> </span><span class="s2">&quot;credits&quot;</span><span class="w"> </span>or<span class="w"> </span><span class="s2">&quot;license&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>information.
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>&gt;&gt;&gt;<span class="w"> </span>import<span class="w"> </span>requests
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>&gt;&gt;&gt;
</span></code></pre></div>
<p>Notice that this time it built a new Python environment, which now includes
<code>requests</code>. Building an environment just creates wrapper scripts that expose the
selected dependencies to the interpreter while re-using the actual modules. This
means if any other env has installed <code>requests</code> or <code>numpy</code> in a different
context, we don't need to recompile them -- we just recompile the wrapper script
that sets up an interpreter pointing to them. This matters much more for "big"
modules like <code>pytorch</code> or <code>tensorflow</code>.</p>
<p>Module names usually match their names on <a href="https://pypi.org/">pypi.org</a>, but
you can use the <a href="https://nixos.org/nixos/packages.html">Nixpkgs search website</a>
to find them as well (along with non-python packages).</p>
<p>At this point we can create throwaway experimental Python environments with
arbitrary dependencies. This is a good way to get a feel for how the Python
interpreter and dependencies work in Nix and NixOS, but to do some actual
development, we'll want to make it a bit more persistent.</p>
<h5 id="running-python-scripts-and-using-nix-shell-as-shebang">Running Python scripts and using <code>nix-shell</code> as shebang<a class="headerlink" href="#running-python-scripts-and-using-nix-shell-as-shebang" title="Permanent link">#</a></h5>
<p>Sometimes, we have a script whose header looks like this:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The dot product of </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> is: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Executing this script requires a <code>python3</code> that has <code>numpy</code>. Using what we learned
in the previous section, we could startup a shell and just run it like so:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>$ nix-shell -p &#39;python311.withPackages (ps: with ps; [ numpy ])&#39; --run &#39;python3 foo.py&#39;
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>The dot product of [1 2] and [3 4] is: 11
</span></code></pre></div>
<p>But if we maintain the script ourselves, and if there are more dependencies, it
may be nice to encode those dependencies in source to make the script re-usable
without that bit of knowledge. That can be done by using <code>nix-shell</code> as a
<a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a>, like so:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="ch">#!/usr/bin/env nix-shell</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="c1">#!nix-shell -i python3 -p &quot;python3.withPackages(ps: [ ps.numpy ])&quot;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The dot product of </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> is: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Then we execute it, without requiring any environment setup at all!</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>$<span class="w"> </span>./foo.py
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>The<span class="w"> </span>dot<span class="w"> </span>product<span class="w"> </span>of<span class="w"> </span><span class="o">[</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">]</span><span class="w"> </span>and<span class="w"> </span><span class="o">[</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">]</span><span class="w"> </span>is:<span class="w"> </span><span class="m">11</span>
</span></code></pre></div>
<p>If the dependencies are not available on the host where <code>foo.py</code> is executed, it
will build or download them from a Nix binary cache prior to starting up, prior
that it is executed on a machine with a multi-user nix installation.</p>
<p>This provides a way to ship a self bootstrapping Python script, akin to a
statically linked binary, where it can be run on any machine (provided nix is
installed) without having to assume that <code>numpy</code> is installed globally on the
system.</p>
<p>By default it is pulling the import checkout of Nixpkgs itself from our nix
channel, which is nice as it cache aligns with our other package builds, but we
can make it fully reproducible by pinning the <code>nixpkgs</code> import:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="ch">#!/usr/bin/env nix-shell</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="c1">#!nix-shell -i python3 -p &quot;python3.withPackages (ps: [ ps.numpy ])&quot;</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="c1">#!nix-shell -I nixpkgs=https://github.com/NixOS/nixpkgs/archive/e51209796c4262bfb8908e3d6d72302fe4e96f5f.tar.gz</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The dot product of </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> is: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>This will execute with the exact same versions of Python 3.10, numpy, and system
dependencies a year from now as it does today, because it will always use
exactly git commit <code>e51209796c4262bfb8908e3d6d72302fe4e96f5f</code> of Nixpkgs for all
of the package versions.</p>
<p>This is also a great way to ensure the script executes identically on different
servers.</p>
<h5 id="load-environment-from-.nix-expression">Load environment from <code>.nix</code> expression<a class="headerlink" href="#load-environment-from-.nix-expression" title="Permanent link">#</a></h5>
<p>We've now seen how to create an ad-hoc temporary shell session, and how to
create a single script with Python dependencies, but in the course of normal
development we're usually working in an entire package repository.</p>
<p>As explained <a href="https://nixos.org/manual/nix/stable/command-ref/nix-shell">in the <code>nix-shell</code> section</a> of the Nix manual, <code>nix-shell</code> can also load an expression from a <code>.nix</code> file.
Say we want to have Python 3.11, <code>numpy</code> and <code>toolz</code>, like before,
in an environment. We can add a <code>shell.nix</code> file describing our dependencies:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="p">(</span>python311<span class="o">.</span>withPackages <span class="p">(</span>ps<span class="p">:</span> <span class="k">with</span> ps<span class="p">;</span> <span class="p">[</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>  numpy
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>  toolz
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="p">]))</span><span class="o">.</span>env
</span></code></pre></div>
<p>And then at the command line, just typing <code>nix-shell</code> produces the same
environment as before. In a normal project, we'll likely have many more
dependencies; this can provide a way for developers to share the environments
with each other and with CI builders.</p>
<p>What's happening here?</p>
<ol>
<li>We begin with importing the Nix Packages collections. <code>import &lt;nixpkgs&gt;</code>
   imports the <code>&lt;nixpkgs&gt;</code> function, <code>{}</code> calls it and the <code>with</code> statement
   brings all attributes of <code>nixpkgs</code> in the local scope. These attributes form
   the main package set.</li>
<li>Then we create a Python 3.11 environment with the <a href="#python.withpackages-function"><code>withPackages</code></a> function, as before.</li>
<li>The <a href="#python.withpackages-function"><code>withPackages</code></a> function expects us to provide a function as an argument
   that takes the set of all Python packages and returns a list of packages to
   include in the environment. Here, we select the packages <code>numpy</code> and <code>toolz</code>
   from the package set.</li>
</ol>
<p>To combine this with <code>mkShell</code> you can:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="k">let</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>  <span class="ss">pythonEnv</span> <span class="o">=</span> python311<span class="o">.</span>withPackages <span class="p">(</span>ps<span class="p">:</span> <span class="p">[</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    ps<span class="o">.</span>numpy
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>    ps<span class="o">.</span>toolz
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>  <span class="p">]);</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="k">in</span> mkShell <span class="p">{</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>  <span class="ss">packages</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>    pythonEnv
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    black
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>    mypy
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>    libffi
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>    openssl
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>  <span class="p">];</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="p">}</span>
</span></code></pre></div>
<p>This will create a unified environment that has not just our Python interpreter
and its Python dependencies, but also tools like <code>black</code> or <code>mypy</code> and libraries
like <code>libffi</code> the <code>openssl</code> in scope. This is generic and can span any number of
tools or languages across the Nixpkgs ecosystem.</p>
<h5 id="installing-environments-globally-on-the-system">Installing environments globally on the system<a class="headerlink" href="#installing-environments-globally-on-the-system" title="Permanent link">#</a></h5>
<p>Up to now, we've been creating environments scoped to an ad-hoc shell session,
or a single script, or a single project. This is generally advisable, as it
avoids pollution across contexts.</p>
<p>However, sometimes we know we will often want a Python with some basic packages,
and want this available without having to enter into a shell or build context.
This can be useful to have things like vim/emacs editors and plugins or shell
tools "just work" without having to set them up, or when running other software
that expects packages to be installed globally.</p>
<p>To create your own custom environment, create a file in <code>~/.config/nixpkgs/overlays/</code>
that looks like this:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># ~/.config/nixpkgs/overlays/myEnv.nix</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>self<span class="p">:</span> super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>  <span class="ss">myEnv</span> <span class="o">=</span> super<span class="o">.</span>buildEnv <span class="p">{</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>    <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;myEnv&quot;</span><span class="p">;</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="ss">paths</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>      <span class="c1"># A Python 3 interpreter with some packages</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>      <span class="p">(</span>self<span class="o">.</span>python3<span class="o">.</span>withPackages <span class="p">(</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>        ps<span class="p">:</span> <span class="k">with</span> ps<span class="p">;</span> <span class="p">[</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>          pyflakes
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>          pytest
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>          black
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>        <span class="p">]</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>      <span class="p">))</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>      <span class="c1"># Some other packages we&#39;d like as part of this env</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>      self<span class="o">.</span>mypy
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>      self<span class="o">.</span>black
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>      self<span class="o">.</span>ripgrep
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>      self<span class="o">.</span>tmux
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>    <span class="p">];</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>  <span class="p">};</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="p">}</span>
</span></code></pre></div>
<p>You can then build and install this to your profile with:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>nix-env<span class="w"> </span>-iA<span class="w"> </span>myEnv
</span></code></pre></div>
<p>One limitation of this is that you can only have 1 Python env installed
globally, since they conflict on the <code>python</code> to load out of your <code>PATH</code>.</p>
<p>If you get a conflict or prefer to keep the setup clean, you can have <code>nix-env</code>
atomically <em>uninstall</em> all other imperatively installed packages and replace
your profile with just <code>myEnv</code> by using the <code>--replace</code> flag.</p>
<h5 id="environment-defined-in-etcnixosconfiguration.nix">Environment defined in <code>/etc/nixos/configuration.nix</code><a class="headerlink" href="#environment-defined-in-etcnixosconfiguration.nix" title="Permanent link">#</a></h5>
<p>For the sake of completeness, here's how to install the environment system-wide
on NixOS.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="p">{</span> <span class="c1"># ...</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>  environment<span class="o">.</span><span class="ss">systemPackages</span> <span class="o">=</span> <span class="k">with</span> pkgs<span class="p">;</span> <span class="p">[</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="p">(</span>python310<span class="o">.</span>withPackages<span class="p">(</span>ps<span class="p">:</span> <span class="k">with</span> ps<span class="p">;</span> <span class="p">[</span> numpy toolz <span class="p">]))</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>  <span class="p">];</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="developing-with-python">Developing with Python<a class="headerlink" href="#developing-with-python" title="Permanent link">#</a></h3>
<p>Above, we were mostly just focused on use cases and what to do to get started
creating working Python environments in nix.</p>
<p>Now that you know the basics to be up and running, it is time to take a step
back and take a deeper look at how Python packages are packaged on Nix. Then,
we will look at how you can use development mode with your code.</p>
<h4 id="python-library-packages-in-nixpkgs">Python library packages in Nixpkgs<a class="headerlink" href="#python-library-packages-in-nixpkgs" title="Permanent link">#</a></h4>
<p>With Nix all packages are built by functions. The main function in Nix for
building Python libraries is <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a>. Let's see how we can build the
<code>toolz</code> package.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="p">{</span> lib
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="p">,</span> buildPythonPackage
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="p">,</span> fetchPypi
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="p">,</span> setuptools
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="p">,</span> wheel
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="p">}:</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>buildPythonPackage <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;toolz&quot;</span><span class="p">;</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;0.10.0&quot;</span><span class="p">;</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>  <span class="ss">pyproject</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>  <span class="ss">src</span> <span class="o">=</span> fetchPypi <span class="p">{</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>    <span class="k">inherit</span> pname version<span class="p">;</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>    <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-CP3V73yWSArRHBLUct4hrNMjWZlvaaUlkpm1QP66RWA=&quot;</span><span class="p">;</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>  <span class="p">};</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>  <span class="ss">nativeBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>    setuptools
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>    wheel
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>  <span class="p">];</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>  <span class="c1"># has no tests</span>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>  <span class="ss">doCheck</span> <span class="o">=</span> <span class="no">false</span><span class="p">;</span>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>
</span><span id="__span-28-26"><a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>  <span class="ss">pythonImportsCheck</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-28-27"><a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>    <span class="s2">&quot;toolz.itertoolz&quot;</span>
</span><span id="__span-28-28"><a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>    <span class="s2">&quot;toolz.functoolz&quot;</span>
</span><span id="__span-28-29"><a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>    <span class="s2">&quot;toolz.dicttoolz&quot;</span>
</span><span id="__span-28-30"><a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>  <span class="p">];</span>
</span><span id="__span-28-31"><a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a>
</span><span id="__span-28-32"><a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a>  <span class="ss">meta</span> <span class="o">=</span> <span class="k">with</span> lib<span class="p">;</span> <span class="p">{</span>
</span><span id="__span-28-33"><a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a>    <span class="ss">changelog</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/pytoolz/toolz/releases/tag/</span><span class="si">${</span>version<span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span id="__span-28-34"><a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a>    <span class="ss">homepage</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/pytoolz/toolz&quot;</span><span class="p">;</span>
</span><span id="__span-28-35"><a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a>    <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;List processing tools and functional utilities&quot;</span><span class="p">;</span>
</span><span id="__span-28-36"><a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a>    <span class="ss">license</span> <span class="o">=</span> licenses<span class="o">.</span>bsd3<span class="p">;</span>
</span><span id="__span-28-37"><a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a>    <span class="ss">maintainers</span> <span class="o">=</span> <span class="k">with</span> maintainers<span class="p">;</span> <span class="p">[</span> fridh <span class="p">];</span>
</span><span id="__span-28-38"><a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a>  <span class="p">};</span>
</span><span id="__span-28-39"><a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a><span class="p">}</span>
</span></code></pre></div>
<p>What happens here? The function <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a> is called and as argument
it accepts a set. In this case the set is a recursive set, <code>rec</code>. One of the
arguments is the name of the package, which consists of a basename (generally
following the name on PyPi) and a version. Another argument, <code>src</code> specifies the
source, which in this case is fetched from PyPI using the helper function
<code>fetchPypi</code>. The argument <code>doCheck</code> is used to set whether tests should be run
when building the package. Since there are no tests, we rely on <a href="#using-pythonimportscheck"><code>pythonImportsCheck</code></a>
to test whether the package can be imported. Furthermore, we specify some meta
information. The output of the function is a derivation.</p>
<p>An expression for <code>toolz</code> can be found in the Nixpkgs repository. As explained
in the introduction of this Python section, a derivation of <code>toolz</code> is available
for each interpreter version, e.g. <code>python311.pkgs.toolz</code> refers to the <code>toolz</code>
derivation corresponding to the CPython 3.11 interpreter.</p>
<p>The above example works when you're directly working on
<code>pkgs/top-level/python-packages.nix</code> in the Nixpkgs repository. Often though,
you will want to test a Nix expression outside of the Nixpkgs tree.</p>
<p>The following expression creates a derivation for the <code>toolz</code> package,
and adds it along with a <code>numpy</code> package to a Python environment.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="p">(</span> <span class="k">let</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>    <span class="ss">my_toolz</span> <span class="o">=</span> python311<span class="o">.</span>pkgs<span class="o">.</span>buildPythonPackage <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>      <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;toolz&quot;</span><span class="p">;</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>      <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;0.10.0&quot;</span><span class="p">;</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>      <span class="ss">pyproject</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>      <span class="ss">src</span> <span class="o">=</span> fetchPypi <span class="p">{</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>        <span class="k">inherit</span> pname version<span class="p">;</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>        <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-CP3V73yWSArRHBLUct4hrNMjWZlvaaUlkpm1QP66RWA=&quot;</span><span class="p">;</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>      <span class="p">};</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>      <span class="ss">nativeBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>        python311<span class="o">.</span>pkgs<span class="o">.</span>setuptools
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>        python311<span class="o">.</span>pkgs<span class="o">.</span>wheel
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>      <span class="p">];</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a>      <span class="c1"># has no tests</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>      <span class="ss">doCheck</span> <span class="o">=</span> <span class="no">false</span><span class="p">;</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a>      <span class="ss">meta</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a>        <span class="ss">homepage</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/pytoolz/toolz/&quot;</span><span class="p">;</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>        <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;List processing tools and functional utilities&quot;</span><span class="p">;</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a>        <span class="c1"># [...]</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a>      <span class="p">};</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a>    <span class="p">};</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a>
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a>  <span class="k">in</span> python311<span class="o">.</span>withPackages <span class="p">(</span>ps<span class="p">:</span> <span class="k">with</span> ps<span class="p">;</span> <span class="p">[</span>
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a>    numpy
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a>    my_toolz
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a>  <span class="p">])</span>
</span><span id="__span-29-33"><a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a><span class="p">)</span><span class="o">.</span>env
</span></code></pre></div>
<p>Executing <code>nix-shell</code> will result in an environment in which you can use
Python 3.11 and the <code>toolz</code> package. As you can see we had to explicitly mention
for which Python version we want to build a package.</p>
<p>So, what did we do here? Well, we took the Nix expression that we used earlier
to build a Python environment, and said that we wanted to include our own
version of <code>toolz</code>, named <code>my_toolz</code>. To introduce our own package in the scope
of <a href="#python.withpackages-function"><code>withPackages</code></a> we used a <code>let</code> expression. You can see that we used
<code>ps.numpy</code> to select numpy from the nixpkgs package set (<code>ps</code>). We did not take
<code>toolz</code> from the Nixpkgs package set this time, but instead took our own version
that we introduced with the <code>let</code> expression.</p>
<h4 id="handling-dependencies">Handling dependencies<a class="headerlink" href="#handling-dependencies" title="Permanent link">#</a></h4>
<p>Our example, <code>toolz</code>, does not have any dependencies on other Python packages or
system libraries. According to the manual, <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a> uses the
arguments <a href="#var-stdenv-buildInputs"><code>buildInputs</code></a> and <a href="#var-stdenv-propagatedBuildInputs"><code>propagatedBuildInputs</code></a> to specify dependencies. If
something is exclusively a build-time dependency, then the dependency should be
included in <a href="#var-stdenv-buildInputs"><code>buildInputs</code></a>, but if it is (also) a runtime dependency, then it
should be added to <a href="#var-stdenv-propagatedBuildInputs"><code>propagatedBuildInputs</code></a>. Test dependencies are considered
build-time dependencies and passed to <a href="#var-stdenv-nativeCheckInputs"><code>nativeCheckInputs</code></a>.</p>
<p>The following example shows which arguments are given to <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a> in
order to build <a href="https://github.com/blaze/datashape"><code>datashape</code></a>.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="p">{</span> lib
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="p">,</span> buildPythonPackage
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="p">,</span> fetchPypi
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="c1"># build dependencies</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="p">,</span> setuptools<span class="p">,</span> wheel
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="c1"># dependencies</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="p">,</span> numpy<span class="p">,</span> multipledispatch<span class="p">,</span> python-dateutil
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="c1"># tests</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="p">,</span> pytest
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="p">}:</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>buildPythonPackage <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;datashape&quot;</span><span class="p">;</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;0.4.7&quot;</span><span class="p">;</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>  <span class="ss">pyproject</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>  <span class="ss">src</span> <span class="o">=</span> fetchPypi <span class="p">{</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>    <span class="k">inherit</span> pname version<span class="p">;</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>    <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-FLLvdm1MllKrgTGC6Gb0k0deZeVYvtCCLji/B7uhong=&quot;</span><span class="p">;</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>  <span class="p">};</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>  <span class="ss">nativeBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a>    setuptools
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a>    wheel
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a>  <span class="p">];</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a>  <span class="ss">propagatedBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a>    multipledispatch
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a>    numpy
</span><span id="__span-30-33"><a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a>    python-dateutil
</span><span id="__span-30-34"><a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a>  <span class="p">];</span>
</span><span id="__span-30-35"><a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a>
</span><span id="__span-30-36"><a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a>  <span class="ss">nativeCheckInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-30-37"><a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a>    pytest
</span><span id="__span-30-38"><a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a>  <span class="p">];</span>
</span><span id="__span-30-39"><a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a>
</span><span id="__span-30-40"><a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a>  <span class="ss">meta</span> <span class="o">=</span> <span class="k">with</span> lib<span class="p">;</span> <span class="p">{</span>
</span><span id="__span-30-41"><a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a>    <span class="ss">changelog</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/blaze/datashape/releases/tag/</span><span class="si">${</span>version<span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span id="__span-30-42"><a id="__codelineno-30-42" name="__codelineno-30-42" href="#__codelineno-30-42"></a>    <span class="ss">homepage</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/ContinuumIO/datashape&quot;</span><span class="p">;</span>
</span><span id="__span-30-43"><a id="__codelineno-30-43" name="__codelineno-30-43" href="#__codelineno-30-43"></a>    <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;A data description language&quot;</span><span class="p">;</span>
</span><span id="__span-30-44"><a id="__codelineno-30-44" name="__codelineno-30-44" href="#__codelineno-30-44"></a>    <span class="ss">license</span> <span class="o">=</span> licenses<span class="o">.</span>bsd2<span class="p">;</span>
</span><span id="__span-30-45"><a id="__codelineno-30-45" name="__codelineno-30-45" href="#__codelineno-30-45"></a>    <span class="ss">maintainers</span> <span class="o">=</span> <span class="k">with</span> maintainers<span class="p">;</span> <span class="p">[</span> fridh <span class="p">];</span>
</span><span id="__span-30-46"><a id="__codelineno-30-46" name="__codelineno-30-46" href="#__codelineno-30-46"></a>  <span class="p">};</span>
</span><span id="__span-30-47"><a id="__codelineno-30-47" name="__codelineno-30-47" href="#__codelineno-30-47"></a><span class="p">}</span>
</span></code></pre></div>
<p>We can see several runtime dependencies, <code>numpy</code>, <code>multipledispatch</code>, and
<code>python-dateutil</code>. Furthermore, we have <a href="#var-stdenv-nativeCheckInputs"><code>nativeCheckInputs</code></a> with <code>pytest</code>.
<code>pytest</code> is a test runner and is only used during the <a href="#ssec-check-phase"><code>checkPhase</code></a> and is
therefore not added to <a href="#var-stdenv-propagatedBuildInputs"><code>propagatedBuildInputs</code></a>.</p>
<p>In the previous case we had only dependencies on other Python packages to consider.
Occasionally you have also system libraries to consider. E.g., <code>lxml</code> provides
Python bindings to <code>libxml2</code> and <code>libxslt</code>. These libraries are only required
when building the bindings and are therefore added as <a href="#var-stdenv-buildInputs"><code>buildInputs</code></a>.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="p">{</span> lib
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="p">,</span> buildPythonPackage
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="p">,</span> fetchPypi
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="p">,</span> setuptools
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="p">,</span> wheel
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="p">,</span> libxml2
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="p">,</span> libxslt
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="p">}:</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>buildPythonPackage <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;lxml&quot;</span><span class="p">;</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;3.4.4&quot;</span><span class="p">;</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>  <span class="ss">pyproject</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>  <span class="ss">src</span> <span class="o">=</span> fetchPypi <span class="p">{</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>    <span class="k">inherit</span> pname version<span class="p">;</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>    <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-s9NiusRxFydHzaNRMjjxFcvWxfi45jGb9ql6eJJyQJk=&quot;</span><span class="p">;</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>  <span class="p">};</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>  <span class="ss">nativeBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>    setuptools
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>    wheel
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a>  <span class="p">];</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a>  <span class="ss">buildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>    libxml2
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>    libxslt
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a>  <span class="p">];</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>  <span class="ss">meta</span> <span class="o">=</span> <span class="k">with</span> lib<span class="p">;</span> <span class="p">{</span>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a>    <span class="ss">changelog</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/lxml/lxml/releases/tag/lxml-</span><span class="si">${</span>version<span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a>    <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Pythonic binding for the libxml2 and libxslt libraries&quot;</span><span class="p">;</span>
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a>    <span class="ss">homepage</span> <span class="o">=</span> <span class="s2">&quot;https://lxml.de&quot;</span><span class="p">;</span>
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a>    <span class="ss">license</span> <span class="o">=</span> licenses<span class="o">.</span>bsd3<span class="p">;</span>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a>    <span class="ss">maintainers</span> <span class="o">=</span> <span class="k">with</span> maintainers<span class="p">;</span> <span class="p">[</span> sjourdois <span class="p">];</span>
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a>  <span class="p">};</span>
</span><span id="__span-31-37"><a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a><span class="p">}</span>
</span></code></pre></div>
<p>In this example <code>lxml</code> and Nix are able to work out exactly where the relevant
files of the dependencies are. This is not always the case.</p>
<p>The example below shows bindings to The Fastest Fourier Transform in the West,
commonly known as FFTW. On Nix we have separate packages of FFTW for the
different types of floats (<code>"single"</code>, <code>"double"</code>, <code>"long-double"</code>). The
bindings need all three types, and therefore we add all three as <a href="#var-stdenv-buildInputs"><code>buildInputs</code></a>.
The bindings don't expect to find each of them in a different folder, and
therefore we have to set <code>LDFLAGS</code> and <code>CFLAGS</code>.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="p">{</span> lib
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="p">,</span> buildPythonPackage
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="p">,</span> fetchPypi
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="c1"># build dependencies</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="p">,</span> setuptools
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="p">,</span> wheel
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="c1"># dependencies</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="p">,</span> fftw
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="p">,</span> fftwFloat
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="p">,</span> fftwLongDouble
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="p">,</span> numpy
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="p">,</span> scipy
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="p">}:</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>buildPythonPackage <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;pyFFTW&quot;</span><span class="p">;</span>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;0.9.2&quot;</span><span class="p">;</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>  <span class="ss">pyproject</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a>
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a>  <span class="ss">src</span> <span class="o">=</span> fetchPypi <span class="p">{</span>
</span><span id="__span-32-23"><a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>    <span class="k">inherit</span> pname version<span class="p">;</span>
</span><span id="__span-32-24"><a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a>    <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-9ru2r6kwhUCaskiFoaPNuJCfCVoUL01J40byvRt4kHQ=&quot;</span><span class="p">;</span>
</span><span id="__span-32-25"><a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>  <span class="p">};</span>
</span><span id="__span-32-26"><a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>
</span><span id="__span-32-27"><a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a>  <span class="ss">nativeBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-32-28"><a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>    setuptools
</span><span id="__span-32-29"><a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a>    wheel
</span><span id="__span-32-30"><a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a>  <span class="p">];</span>
</span><span id="__span-32-31"><a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a>
</span><span id="__span-32-32"><a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a>  <span class="ss">buildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-32-33"><a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a>    fftw
</span><span id="__span-32-34"><a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a>    fftwFloat
</span><span id="__span-32-35"><a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a>    fftwLongDouble
</span><span id="__span-32-36"><a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a>  <span class="p">];</span>
</span><span id="__span-32-37"><a id="__codelineno-32-37" name="__codelineno-32-37" href="#__codelineno-32-37"></a>
</span><span id="__span-32-38"><a id="__codelineno-32-38" name="__codelineno-32-38" href="#__codelineno-32-38"></a>  <span class="ss">propagatedBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-32-39"><a id="__codelineno-32-39" name="__codelineno-32-39" href="#__codelineno-32-39"></a>    numpy
</span><span id="__span-32-40"><a id="__codelineno-32-40" name="__codelineno-32-40" href="#__codelineno-32-40"></a>    scipy
</span><span id="__span-32-41"><a id="__codelineno-32-41" name="__codelineno-32-41" href="#__codelineno-32-41"></a>  <span class="p">];</span>
</span><span id="__span-32-42"><a id="__codelineno-32-42" name="__codelineno-32-42" href="#__codelineno-32-42"></a>
</span><span id="__span-32-43"><a id="__codelineno-32-43" name="__codelineno-32-43" href="#__codelineno-32-43"></a>  <span class="ss">preConfigure</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-32-44"><a id="__codelineno-32-44" name="__codelineno-32-44" href="#__codelineno-32-44"></a><span class="s s-Multiline">    export LDFLAGS=&quot;-L</span><span class="si">${</span>fftw<span class="o">.</span>dev<span class="si">}</span><span class="s s-Multiline">/lib -L</span><span class="si">${</span>fftwFloat<span class="o">.</span>out<span class="si">}</span><span class="s s-Multiline">/lib -L</span><span class="si">${</span>fftwLongDouble<span class="o">.</span>out<span class="si">}</span><span class="s s-Multiline">/lib&quot;</span>
</span><span id="__span-32-45"><a id="__codelineno-32-45" name="__codelineno-32-45" href="#__codelineno-32-45"></a><span class="s s-Multiline">    export CFLAGS=&quot;-I</span><span class="si">${</span>fftw<span class="o">.</span>dev<span class="si">}</span><span class="s s-Multiline">/include -I</span><span class="si">${</span>fftwFloat<span class="o">.</span>dev<span class="si">}</span><span class="s s-Multiline">/include -I</span><span class="si">${</span>fftwLongDouble<span class="o">.</span>dev<span class="si">}</span><span class="s s-Multiline">/include&quot;</span>
</span><span id="__span-32-46"><a id="__codelineno-32-46" name="__codelineno-32-46" href="#__codelineno-32-46"></a><span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
</span><span id="__span-32-47"><a id="__codelineno-32-47" name="__codelineno-32-47" href="#__codelineno-32-47"></a>
</span><span id="__span-32-48"><a id="__codelineno-32-48" name="__codelineno-32-48" href="#__codelineno-32-48"></a>  <span class="c1"># Tests cannot import pyfftw. pyfftw works fine though.</span>
</span><span id="__span-32-49"><a id="__codelineno-32-49" name="__codelineno-32-49" href="#__codelineno-32-49"></a>  <span class="ss">doCheck</span> <span class="o">=</span> <span class="no">false</span><span class="p">;</span>
</span><span id="__span-32-50"><a id="__codelineno-32-50" name="__codelineno-32-50" href="#__codelineno-32-50"></a>
</span><span id="__span-32-51"><a id="__codelineno-32-51" name="__codelineno-32-51" href="#__codelineno-32-51"></a>  <span class="ss">meta</span> <span class="o">=</span> <span class="k">with</span> lib<span class="p">;</span> <span class="p">{</span>
</span><span id="__span-32-52"><a id="__codelineno-32-52" name="__codelineno-32-52" href="#__codelineno-32-52"></a>    <span class="ss">changelog</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/pyFFTW/pyFFTW/releases/tag/v</span><span class="si">${</span>version<span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span id="__span-32-53"><a id="__codelineno-32-53" name="__codelineno-32-53" href="#__codelineno-32-53"></a>    <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;A pythonic wrapper around FFTW, the FFT library, presenting a unified interface for all the supported transforms&quot;</span><span class="p">;</span>
</span><span id="__span-32-54"><a id="__codelineno-32-54" name="__codelineno-32-54" href="#__codelineno-32-54"></a>    <span class="ss">homepage</span> <span class="o">=</span> <span class="s2">&quot;http://hgomersall.github.com/pyFFTW&quot;</span><span class="p">;</span>
</span><span id="__span-32-55"><a id="__codelineno-32-55" name="__codelineno-32-55" href="#__codelineno-32-55"></a>    <span class="ss">license</span> <span class="o">=</span> <span class="k">with</span> licenses<span class="p">;</span> <span class="p">[</span> bsd2 bsd3 <span class="p">];</span>
</span><span id="__span-32-56"><a id="__codelineno-32-56" name="__codelineno-32-56" href="#__codelineno-32-56"></a>    <span class="ss">maintainers</span> <span class="o">=</span> <span class="k">with</span> maintainers<span class="p">;</span> <span class="p">[</span> fridh <span class="p">];</span>
</span><span id="__span-32-57"><a id="__codelineno-32-57" name="__codelineno-32-57" href="#__codelineno-32-57"></a>  <span class="p">};</span>
</span><span id="__span-32-58"><a id="__codelineno-32-58" name="__codelineno-32-58" href="#__codelineno-32-58"></a><span class="p">}</span>
</span></code></pre></div>
<p>Note also the line <a href="#var-stdenv-doCheck"><code>doCheck = false;</code></a>, we explicitly disabled running the test-suite.</p>
<h4 id="testing-python-packages">Testing Python Packages<a class="headerlink" href="#testing-python-packages" title="Permanent link">#</a></h4>
<p>It is highly encouraged to have testing as part of the package build. This
helps to avoid situations where the package was able to build and install,
but is not usable at runtime. Currently, all packages will use the <code>test</code>
command provided by the setup.py (i.e. <code>python setup.py test</code>). However,
this is currently deprecated https://github.com/pypa/setuptools/pull/1878
and your package should provide its own <a href="#ssec-check-phase"><code>checkPhase</code></a>.</p>
<p>::: {.note}
The <a href="#ssec-check-phase"><code>checkPhase</code></a> for python maps to the <code>installCheckPhase</code> on a
normal derivation. This is due to many python packages not behaving well
to the pre-installed version of the package. Version info, and natively
compiled extensions generally only exist in the install directory, and
thus can cause issues when a test suite asserts on that behavior.
:::</p>
<p>::: {.note}
Tests should only be disabled if they don't agree with nix
(e.g. external dependencies, network access, flakey tests), however,
as many tests should be enabled as possible. Failing tests can still be
a good indication that the package is not in a valid state.
:::</p>
<h4 id="using-pytest">Using pytest<a class="headerlink" href="#using-pytest" title="Permanent link">#</a></h4>
<p>Pytest is the most common test runner for python repositories. A trivial
test run would be:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>  nativeCheckInputs = [ pytest ];
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>  checkPhase = &#39;&#39;
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    runHook preCheck
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>    pytest
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>    runHook postCheck
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>  &#39;&#39;;
</span></code></pre></div>
<p>However, many repositories' test suites do not translate well to nix's build
sandbox, and will generally need many tests to be disabled.</p>
<p>To filter tests using pytest, one can do the following:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>  nativeCheckInputs = [ pytest ];
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>  # avoid tests which need additional data or touch network
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>  checkPhase = &#39;&#39;
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>    runHook preCheck
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>    pytest tests/ --ignore=tests/integration -k &#39;not download and not update&#39; --ignore=tests/test_failing.py
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>    runHook postCheck
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>  &#39;&#39;;
</span></code></pre></div>
<p><code>--ignore</code> will tell pytest to ignore that file or directory from being
collected as part of a test run. This is useful is a file uses a package
which is not available in nixpkgs, thus skipping that test file is much
easier than having to create a new package.</p>
<p><code>-k</code> is used to define a predicate for test names. In this example, we are
filtering out tests which contain <code>download</code> or <code>update</code> in their test case name.
Only one <code>-k</code> argument is allowed, and thus a long predicate should be concatenated
with “\” and wrapped to the next line.</p>
<p>::: {.note}
In pytest==6.0.1, the use of “\” to continue a line (e.g. <code>-k 'not download \'</code>) has
been removed, in this case, it's recommended to use <code>pytestCheckHook</code>.
:::</p>
<h4 id="using-pytestcheckhook">Using pytestCheckHook<a class="headerlink" href="#using-pytestcheckhook" title="Permanent link">#</a></h4>
<p><code>pytestCheckHook</code> is a convenient hook which will substitute the setuptools
<code>test</code> command for a <a href="#ssec-check-phase"><code>checkPhase</code></a> which runs <code>pytest</code>. This is also beneficial
when a package may need many items disabled to run the test suite.</p>
<p>Using the example above, the analogous <code>pytestCheckHook</code> usage would be:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>  nativeCheckInputs = [
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>    pytestCheckHook
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>  ];
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>  # requires additional data
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>  pytestFlagsArray = [
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>    &quot;tests/&quot;
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>    &quot;--ignore=tests/integration&quot;
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>  ];
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>  disabledTests = [
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>    # touches network
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>    &quot;download&quot;
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>    &quot;update&quot;
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>  ];
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>  disabledTestPaths = [
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>    &quot;tests/test_failing.py&quot;
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>  ];
</span></code></pre></div>
<p>This is especially useful when tests need to be conditionally disabled,
for example:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>  disabledTests = [
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>    # touches network
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>    &quot;download&quot;
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>    &quot;update&quot;
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>  ] ++ lib.optionals (pythonAtLeast &quot;3.8&quot;) [
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>    # broken due to python3.8 async changes
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>    &quot;async&quot;
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>  ] ++ lib.optionals stdenv.isDarwin [
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>    # can fail when building with other packages
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>    &quot;socket&quot;
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>  ];
</span></code></pre></div>
<p>Trying to concatenate the related strings to disable tests in a regular
<a href="#ssec-check-phase"><code>checkPhase</code></a> would be much harder to read. This also enables us to comment on
why specific tests are disabled.</p>
<h4 id="using-pythonimportscheck">Using pythonImportsCheck<a class="headerlink" href="#using-pythonimportscheck" title="Permanent link">#</a></h4>
<p>Although unit tests are highly preferred to validate correctness of a package, not
all packages have test suites that can be run easily, and some have none at all.
To help ensure the package still works, <a href="#using-pythonimportscheck"><code>pythonImportsCheck</code></a> can attempt to import
the listed modules.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>  pythonImportsCheck = [
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>    &quot;requests&quot;
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>    &quot;urllib&quot;
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>  ];
</span></code></pre></div>
<p>roughly translates to:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>  postCheck = &#39;&#39;
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>    PYTHONPATH=$out/${python.sitePackages}:$PYTHONPATH
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>    python -c &quot;import requests; import urllib&quot;
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>  &#39;&#39;;
</span></code></pre></div>
<p>However, this is done in its own phase, and not dependent on whether <a href="#var-stdenv-doCheck"><code>doCheck = true;</code></a>.</p>
<p>This can also be useful in verifying that the package doesn't assume commonly
present packages (e.g. <code>setuptools</code>).</p>
<h4 id="using-pythonrelaxdepshook">Using pythonRelaxDepsHook<a class="headerlink" href="#using-pythonrelaxdepshook" title="Permanent link">#</a></h4>
<p>It is common for upstream to specify a range of versions for its package
dependencies. This makes sense, since it ensures that the package will be built
with a subset of packages that is well tested. However, this commonly causes
issues when packaging in Nixpkgs, because the dependencies that this package
may need are too new or old for the package to build correctly. We also cannot
package multiple versions of the same package since this may cause conflicts
in <code>PYTHONPATH</code>.</p>
<p>One way to side step this issue is to relax the dependencies. This can be done
by either removing the package version range or by removing the package
declaration entirely. This can be done using the <code>pythonRelaxDepsHook</code> hook. For
example, given the following <code>requirements.txt</code> file:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>pkg1&lt;1.0
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>pkg2
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>pkg3&gt;=1.0,&lt;=2.0
</span></code></pre></div>
<p>we can do:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>  nativeBuildInputs = [
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>    pythonRelaxDepsHook
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>  ];
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>  pythonRelaxDeps = [
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>    &quot;pkg1&quot;
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>    &quot;pkg3&quot;
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>  ];
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>  pythonRemoveDeps = [
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>    &quot;pkg2&quot;
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>  ];
</span></code></pre></div>
<p>which would result in the following <code>requirements.txt</code> file:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>pkg1
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>pkg3
</span></code></pre></div>
<p>Another option is to pass <code>true</code>, that will relax/remove all dependencies, for
example:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>  nativeBuildInputs = [ pythonRelaxDepsHook ];
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>  pythonRelaxDeps = true;
</span></code></pre></div>
<p>which would result in the following <code>requirements.txt</code> file:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>pkg1
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>pkg2
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>pkg3
</span></code></pre></div>
<p>In general you should always use <code>pythonRelaxDeps</code>, because <code>pythonRemoveDeps</code>
will convert build errors into runtime errors. However <code>pythonRemoveDeps</code> may
still be useful in exceptional cases, and also to remove dependencies wrongly
declared by upstream (for example, declaring <code>black</code> as a runtime dependency
instead of a dev dependency).</p>
<p>Keep in mind that while the examples above are done with <code>requirements.txt</code>,
<code>pythonRelaxDepsHook</code> works by modifying the resulting wheel file, so it should
work with any of the <a href="#setup-hooks">existing hooks</a>.</p>
<h4 id="using-unittestcheckhook">Using unittestCheckHook<a class="headerlink" href="#using-unittestcheckhook" title="Permanent link">#</a></h4>
<p><code>unittestCheckHook</code> is a hook which will substitute the setuptools <code>test</code> command for a <a href="#ssec-check-phase"><code>checkPhase</code></a> which runs <code>python -m unittest discover</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>  nativeCheckInputs = [
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>    unittestCheckHook
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>  ];
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>  unittestFlagsArray = [
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>    &quot;-s&quot; &quot;tests&quot; &quot;-v&quot;
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>  ];
</span></code></pre></div>
<h4 id="using-sphinxhook">Using sphinxHook<a class="headerlink" href="#using-sphinxhook" title="Permanent link">#</a></h4>
<p>The <code>sphinxHook</code> is a helpful tool to build documentation and manpages
using the popular Sphinx documentation generator.
It is setup to automatically find common documentation source paths and
render them using the default <code>html</code> style.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>  outputs = [
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>    &quot;out&quot;
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>    &quot;doc&quot;
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>  ];
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>  nativeBuildInputs = [
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>    sphinxHook
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>  ];
</span></code></pre></div>
<p>The hook will automatically build and install the artifact into the
<code>doc</code> output, if it exists. It also provides an automatic diversion
for the artifacts of the <code>man</code> builder into the <code>man</code> target.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>  outputs = [
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>    &quot;out&quot;
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>    &quot;doc&quot;
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>    &quot;man&quot;
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>  ];
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>  # Use multiple builders
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>  sphinxBuilders = [
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>    &quot;singlehtml&quot;
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>    &quot;man&quot;
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>  ];
</span></code></pre></div>
<p>Overwrite <code>sphinxRoot</code> when the hook is unable to find your
documentation source root.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>  # Configure sphinxRoot for uncommon paths
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>  sphinxRoot = &quot;weird/docs/path&quot;;
</span></code></pre></div>
<p>The hook is also available to packages outside the python ecosystem by
referencing it using <code>sphinxHook</code> from top-level.</p>
<h3 id="develop-local-package">Develop local package<a class="headerlink" href="#develop-local-package" title="Permanent link">#</a></h3>
<p>As a Python developer you're likely aware of <a href="http://setuptools.readthedocs.io/en/latest/setuptools.html#development-mode">development mode</a>
(<code>python setup.py develop</code>); instead of installing the package this command
creates a special link to the project code. That way, you can run updated code
without having to reinstall after each and every change you make. Development
mode is also available. Let's see how you can use it.</p>
<p>In the previous Nix expression the source was fetched from a url. We can also
refer to a local source instead using <code>src = ./path/to/source/tree;</code></p>
<p>If we create a <code>shell.nix</code> file which calls <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a>, and if <code>src</code>
is a local source, and if the local source has a <code>setup.py</code>, then development
mode is activated.</p>
<p>In the following example, we create a simple environment that has a Python 3.11
version of our package in it, as well as its dependencies and other packages we
like to have in the environment, all specified with <a href="#var-stdenv-propagatedBuildInputs"><code>propagatedBuildInputs</code></a>.
Indeed, we can just add any package we like to have in our environment to
<a href="#var-stdenv-propagatedBuildInputs"><code>propagatedBuildInputs</code></a>.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="k">with</span> python311Packages<span class="p">;</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>buildPythonPackage <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>  <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;mypackage&quot;</span><span class="p">;</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>  <span class="ss">src</span> <span class="o">=</span> <span class="l">./path/to/package/source</span><span class="p">;</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>  <span class="ss">propagatedBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>    pytest
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>    numpy
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>    pkgs<span class="o">.</span>libsndfile
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>  <span class="p">];</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="p">}</span>
</span></code></pre></div>
<p>It is important to note that due to how development mode is implemented on Nix
it is not possible to have multiple packages simultaneously in development mode.</p>
<h3 id="organising-your-packages">Organising your packages<a class="headerlink" href="#organising-your-packages" title="Permanent link">#</a></h3>
<p>So far we discussed how you can use Python on Nix, and how you can develop with
it. We've looked at how you write expressions to package Python packages, and we
looked at how you can create environments in which specified packages are
available.</p>
<p>At some point you'll likely have multiple packages which you would
like to be able to use in different projects. In order to minimise unnecessary
duplication we now look at how you can maintain a repository with your
own packages. The important functions here are <code>import</code> and <code>callPackage</code>.</p>
<h3 id="including-a-derivation-using-callpackage">Including a derivation using <code>callPackage</code><a class="headerlink" href="#including-a-derivation-using-callpackage" title="Permanent link">#</a></h3>
<p>Earlier we created a Python environment using <a href="#python.withpackages-function"><code>withPackages</code></a>, and included the
<code>toolz</code> package via a <code>let</code> expression.
Let's split the package definition from the environment definition.</p>
<p>We first create a function that builds <code>toolz</code> in <code>~/path/to/toolz/release.nix</code></p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="p">{</span> lib
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="p">,</span> buildPythonPackage
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="p">,</span> fetchPypi
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="p">,</span> setuptools
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="p">,</span> wheel
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="p">}:</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>buildPythonPackage <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;toolz&quot;</span><span class="p">;</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;0.10.0&quot;</span><span class="p">;</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>  <span class="ss">pyproject</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>  <span class="ss">src</span> <span class="o">=</span> fetchPypi <span class="p">{</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>    <span class="k">inherit</span> pname version<span class="p">;</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>    <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-CP3V73yWSArRHBLUct4hrNMjWZlvaaUlkpm1QP66RWA=&quot;</span><span class="p">;</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a>  <span class="p">};</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a>  <span class="ss">nativeBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a>    setuptools
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a>    wheel
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a>  <span class="p">];</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a>  <span class="ss">meta</span> <span class="o">=</span> <span class="k">with</span> lib<span class="p">;</span> <span class="p">{</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a>    <span class="ss">changelog</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/pytoolz/toolz/releases/tag/</span><span class="si">${</span>version<span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25" href="#__codelineno-49-25"></a>    <span class="ss">homepage</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/pytoolz/toolz/&quot;</span><span class="p">;</span>
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26" href="#__codelineno-49-26"></a>    <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;List processing tools and functional utilities&quot;</span><span class="p">;</span>
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27" href="#__codelineno-49-27"></a>    <span class="ss">license</span> <span class="o">=</span> licenses<span class="o">.</span>bsd3<span class="p">;</span>
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28" href="#__codelineno-49-28"></a>    <span class="ss">maintainers</span> <span class="o">=</span> <span class="k">with</span> maintainers<span class="p">;</span> <span class="p">[</span> fridh <span class="p">];</span>
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29" href="#__codelineno-49-29"></a>  <span class="p">};</span>
</span><span id="__span-49-30"><a id="__codelineno-49-30" name="__codelineno-49-30" href="#__codelineno-49-30"></a><span class="p">}</span>
</span></code></pre></div>
<p>It takes an argument <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a>. We now call this function using
<code>callPackage</code> in the definition of our environment</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="p">(</span> <span class="k">let</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>    <span class="ss">toolz</span> <span class="o">=</span> callPackage <span class="l">/path/to/toolz/release.nix</span> <span class="p">{</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>      <span class="ss">buildPythonPackage</span> <span class="o">=</span> python310
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>Packages<span class="o">.</span>buildPythonPackage<span class="p">;</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>    <span class="p">};</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>  <span class="k">in</span> python310<span class="o">.</span>withPackages <span class="p">(</span>ps<span class="p">:</span> <span class="p">[</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>    ps<span class="o">.</span>numpy
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>    toolz
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a>  <span class="p">])</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="p">)</span><span class="o">.</span>env
</span></code></pre></div>
<p>Important to remember is that the Python version for which the package is made
depends on the <code>python</code> derivation that is passed to <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a>. Nix
tries to automatically pass arguments when possible, which is why generally you
don't explicitly define which <code>python</code> derivation should be used. In the above
example we use <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a> that is part of the set <code>python3Packages</code>,
and in this case the <code>python3</code> interpreter is automatically used.</p>
<h2 id="faq">FAQ<a class="headerlink" href="#faq" title="Permanent link">#</a></h2>
<h3 id="how-to-solve-circular-dependencies">How to solve circular dependencies?<a class="headerlink" href="#how-to-solve-circular-dependencies" title="Permanent link">#</a></h3>
<p>Consider the packages <code>A</code> and <code>B</code> that depend on each other. When packaging <code>B</code>,
a solution is to override package <code>A</code> not to depend on <code>B</code> as an input. The same
should also be done when packaging <code>A</code>.</p>
<h3 id="how-to-override-a-python-package">How to override a Python package?<a class="headerlink" href="#how-to-override-a-python-package" title="Permanent link">#</a></h3>
<p>We can override the interpreter and pass <code>packageOverrides</code>. In the following
example we rename the <code>pandas</code> package and build it.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="p">(</span><span class="k">let</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>  <span class="ss">python</span> <span class="o">=</span> <span class="k">let</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>    <span class="ss">packageOverrides</span> <span class="o">=</span> self<span class="p">:</span> super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>      <span class="ss">pandas</span> <span class="o">=</span> super<span class="o">.</span>pandas<span class="o">.</span>overridePythonAttrs<span class="p">(</span>old<span class="p">:</span> <span class="p">{</span><span class="ss">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">;});</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>    <span class="p">};</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>  <span class="k">in</span> pkgs<span class="o">.</span>python310<span class="o">.</span>override <span class="p">{</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>    <span class="k">inherit</span> packageOverrides<span class="p">;</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a>  <span class="p">};</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="k">in</span> python<span class="o">.</span>withPackages <span class="p">(</span>ps<span class="p">:</span> <span class="p">[</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a>  ps<span class="o">.</span>pandas
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="p">]))</span><span class="o">.</span>env
</span></code></pre></div>
<p>Using <code>nix-build</code> on this expression will build an environment that contains the
package <code>pandas</code> but with the new name <code>foo</code>.</p>
<p>All packages in the package set will use the renamed package. A typical use case
is to switch to another version of a certain package. For example, in the
Nixpkgs repository we have multiple versions of <code>django</code> and <code>scipy</code>. In the
following example we use a different version of <code>scipy</code> and create an
environment that uses it. All packages in the Python package set will now use
the updated <code>scipy</code> version.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="p">(</span> <span class="k">let</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>    <span class="ss">packageOverrides</span> <span class="o">=</span> self<span class="p">:</span> super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>      <span class="ss">scipy</span> <span class="o">=</span> super<span class="o">.</span>scipy_0_17<span class="p">;</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>    <span class="p">};</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>  <span class="k">in</span> <span class="p">(</span>pkgs<span class="o">.</span>python310<span class="o">.</span>override <span class="p">{</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>    <span class="k">inherit</span> packageOverrides<span class="p">;</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>  <span class="p">})</span><span class="o">.</span>withPackages <span class="p">(</span>ps<span class="p">:</span> <span class="p">[</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a>    ps<span class="o">.</span>blaze
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a>  <span class="p">])</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="p">)</span><span class="o">.</span>env
</span></code></pre></div>
<p>The requested package <code>blaze</code> depends on <code>pandas</code> which itself depends on <code>scipy</code>.</p>
<p>If you want the whole of Nixpkgs to use your modifications, then you can use
<code>overlays</code> as explained in this manual. In the following example we build a
<code>inkscape</code> using a different version of <code>numpy</code>.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="k">let</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>  <span class="ss">pkgs</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>  <span class="ss">newpkgs</span> <span class="o">=</span> <span class="nb">import</span> pkgs<span class="o">.</span>path <span class="p">{</span> <span class="ss">overlays</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span>self<span class="p">:</span> super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>    <span class="ss">python310</span> <span class="o">=</span> <span class="k">let</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>      <span class="ss">packageOverrides</span> <span class="o">=</span> python-self<span class="p">:</span> python-super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>        <span class="ss">numpy</span> <span class="o">=</span> python-super<span class="o">.</span>numpy_1_18<span class="p">;</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>      <span class="p">};</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>    <span class="k">in</span> super<span class="o">.</span>python310<span class="o">.</span>override <span class="p">{</span><span class="k">inherit</span> packageOverrides<span class="p">;};</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>  <span class="p">}</span> <span class="p">)</span> <span class="p">];</span> <span class="p">};</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="k">in</span> newpkgs<span class="o">.</span>inkscape
</span></code></pre></div>
<h3 id="python-setup.py-bdist_wheel-cannot-create-.whl"><code>python setup.py bdist_wheel</code> cannot create .whl<a class="headerlink" href="#python-setup.py-bdist_wheel-cannot-create-.whl" title="Permanent link">#</a></h3>
<p>Executing <code>python setup.py bdist_wheel</code> in a <code>nix-shell</code>fails with</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>ValueError: ZIP does not support timestamps before 1980
</span></code></pre></div>
<p>This is because files from the Nix store (which have a timestamp of the UNIX
epoch of January 1, 1970) are included in the .ZIP, but .ZIP archives follow the
DOS convention of counting timestamps from 1980.</p>
<p>The command <code>bdist_wheel</code> reads the <code>SOURCE_DATE_EPOCH</code> environment variable,
which <code>nix-shell</code> sets to 1. Unsetting this variable or giving it a value
corresponding to 1980 or later enables building wheels.</p>
<p>Use 1980 as timestamp:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>nix-shell<span class="w"> </span>--run<span class="w"> </span><span class="s2">&quot;SOURCE_DATE_EPOCH=315532800 python3 setup.py bdist_wheel&quot;</span>
</span></code></pre></div>
<p>or the current time:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>nix-shell<span class="w"> </span>--run<span class="w"> </span><span class="s2">&quot;SOURCE_DATE_EPOCH=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="s2"> python3 setup.py bdist_wheel&quot;</span>
</span></code></pre></div>
<p>or unset <code>SOURCE_DATE_EPOCH</code>:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>nix-shell<span class="w"> </span>--run<span class="w"> </span><span class="s2">&quot;unset SOURCE_DATE_EPOCH; python3 setup.py bdist_wheel&quot;</span>
</span></code></pre></div>
<h3 id="install_data-data_files-problems"><code>install_data</code> / <code>data_files</code> problems<a class="headerlink" href="#install_data-data_files-problems" title="Permanent link">#</a></h3>
<p>If you get the following error:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>could not create &#39;/nix/store/6l1bvljpy8gazlsw2aw9skwwp4pmvyxw-python-2.7.8/etc&#39;:
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>Permission denied
</span></code></pre></div>
<p>This is a <a href="https://github.com/pypa/setuptools/issues/130">known bug</a> in
<code>setuptools</code>. Setuptools <code>install_data</code> does not respect <code>--prefix</code>. An example
of such package using the feature is <code>pkgs/tools/X11/xpra/default.nix</code>.</p>
<p>As workaround install it as an extra <code>preInstall</code> step:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="si">${</span><span class="nv">python</span><span class="p">.pythonOnBuildForHost.interpreter</span><span class="si">}</span><span class="w"> </span>setup.py<span class="w"> </span>install_data<span class="w"> </span>--install-dir<span class="o">=</span><span class="nv">$out</span><span class="w"> </span>--root<span class="o">=</span><span class="nv">$out</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/ = data\_files/d&#39;</span><span class="w"> </span>setup.py
</span></code></pre></div>
<h3 id="rationale-of-non-existent-global-site-packages">Rationale of non-existent global site-packages<a class="headerlink" href="#rationale-of-non-existent-global-site-packages" title="Permanent link">#</a></h3>
<p>On most operating systems a global <code>site-packages</code> is maintained. This however
becomes problematic if you want to run multiple Python versions or have multiple
versions of certain libraries for your projects. Generally, you would solve such
issues by creating virtual environments using <code>virtualenv</code>.</p>
<p>On Nix each package has an isolated dependency tree which, in the case of
Python, guarantees the right versions of the interpreter and libraries or
packages are available. There is therefore no need to maintain a global <code>site-packages</code>.</p>
<p>If you want to create a Python environment for development, then the recommended
method is to use <code>nix-shell</code>, either with or without the <a href="#python.buildenv-function"><code>python.buildEnv</code></a>
function.</p>
<h3 id="how-to-consume-python-modules-using-pip-in-a-virtual-environment-like-i-am-used-to-on-other-operating-systems">How to consume Python modules using pip in a virtual environment like I am used to on other Operating Systems?<a class="headerlink" href="#how-to-consume-python-modules-using-pip-in-a-virtual-environment-like-i-am-used-to-on-other-operating-systems" title="Permanent link">#</a></h3>
<p>While this approach is not very idiomatic from Nix perspective, it can still be
useful when dealing with pre-existing projects or in situations where it's not
feasible or desired to write derivations for all required dependencies.</p>
<p>This is an example of a <code>default.nix</code> for a <code>nix-shell</code>, which allows to consume
a virtual environment created by <code>venv</code>, and install Python modules through
<code>pip</code> the traditional way.</p>
<p>Create this <code>default.nix</code> file, together with a <code>requirements.txt</code> and
execute <code>nix-shell</code>.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{</span> <span class="p">};</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="k">let</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>  <span class="ss">pythonPackages</span> <span class="o">=</span> python3Packages<span class="p">;</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="k">in</span> pkgs<span class="o">.</span>mkShell <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>  <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;impurePythonEnv&quot;</span><span class="p">;</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a>  <span class="ss">venvDir</span> <span class="o">=</span> <span class="s2">&quot;./.venv&quot;</span><span class="p">;</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a>  <span class="ss">buildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a>    <span class="c1"># A Python interpreter including the &#39;venv&#39; module is required to bootstrap</span>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a>    <span class="c1"># the environment.</span>
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a>    pythonPackages<span class="o">.</span>python
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a>
</span><span id="__span-60-13"><a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a>    <span class="c1"># This executes some shell code to initialize a venv in $venvDir before</span>
</span><span id="__span-60-14"><a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a>    <span class="c1"># dropping into the shell</span>
</span><span id="__span-60-15"><a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a>    pythonPackages<span class="o">.</span>venvShellHook
</span><span id="__span-60-16"><a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a>
</span><span id="__span-60-17"><a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a>    <span class="c1"># Those are dependencies that we would like to use from nixpkgs, which will</span>
</span><span id="__span-60-18"><a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a>    <span class="c1"># add them to PYTHONPATH and thus make them accessible from within the venv.</span>
</span><span id="__span-60-19"><a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a>    pythonPackages<span class="o">.</span>numpy
</span><span id="__span-60-20"><a id="__codelineno-60-20" name="__codelineno-60-20" href="#__codelineno-60-20"></a>    pythonPackages<span class="o">.</span>requests
</span><span id="__span-60-21"><a id="__codelineno-60-21" name="__codelineno-60-21" href="#__codelineno-60-21"></a>
</span><span id="__span-60-22"><a id="__codelineno-60-22" name="__codelineno-60-22" href="#__codelineno-60-22"></a>    <span class="c1"># In this particular example, in order to compile any binary extensions they may</span>
</span><span id="__span-60-23"><a id="__codelineno-60-23" name="__codelineno-60-23" href="#__codelineno-60-23"></a>    <span class="c1"># require, the Python modules listed in the hypothetical requirements.txt need</span>
</span><span id="__span-60-24"><a id="__codelineno-60-24" name="__codelineno-60-24" href="#__codelineno-60-24"></a>    <span class="c1"># the following packages to be installed locally:</span>
</span><span id="__span-60-25"><a id="__codelineno-60-25" name="__codelineno-60-25" href="#__codelineno-60-25"></a>    taglib
</span><span id="__span-60-26"><a id="__codelineno-60-26" name="__codelineno-60-26" href="#__codelineno-60-26"></a>    openssl
</span><span id="__span-60-27"><a id="__codelineno-60-27" name="__codelineno-60-27" href="#__codelineno-60-27"></a>    git
</span><span id="__span-60-28"><a id="__codelineno-60-28" name="__codelineno-60-28" href="#__codelineno-60-28"></a>    libxml2
</span><span id="__span-60-29"><a id="__codelineno-60-29" name="__codelineno-60-29" href="#__codelineno-60-29"></a>    libxslt
</span><span id="__span-60-30"><a id="__codelineno-60-30" name="__codelineno-60-30" href="#__codelineno-60-30"></a>    libzip
</span><span id="__span-60-31"><a id="__codelineno-60-31" name="__codelineno-60-31" href="#__codelineno-60-31"></a>    zlib
</span><span id="__span-60-32"><a id="__codelineno-60-32" name="__codelineno-60-32" href="#__codelineno-60-32"></a>  <span class="p">];</span>
</span><span id="__span-60-33"><a id="__codelineno-60-33" name="__codelineno-60-33" href="#__codelineno-60-33"></a>
</span><span id="__span-60-34"><a id="__codelineno-60-34" name="__codelineno-60-34" href="#__codelineno-60-34"></a>  <span class="c1"># Run this command, only after creating the virtual environment</span>
</span><span id="__span-60-35"><a id="__codelineno-60-35" name="__codelineno-60-35" href="#__codelineno-60-35"></a>  <span class="ss">postVenvCreation</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-60-36"><a id="__codelineno-60-36" name="__codelineno-60-36" href="#__codelineno-60-36"></a><span class="s s-Multiline">    unset SOURCE_DATE_EPOCH</span>
</span><span id="__span-60-37"><a id="__codelineno-60-37" name="__codelineno-60-37" href="#__codelineno-60-37"></a><span class="s s-Multiline">    pip install -r requirements.txt</span>
</span><span id="__span-60-38"><a id="__codelineno-60-38" name="__codelineno-60-38" href="#__codelineno-60-38"></a><span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
</span><span id="__span-60-39"><a id="__codelineno-60-39" name="__codelineno-60-39" href="#__codelineno-60-39"></a>
</span><span id="__span-60-40"><a id="__codelineno-60-40" name="__codelineno-60-40" href="#__codelineno-60-40"></a>  <span class="c1"># Now we can execute any commands within the virtual environment.</span>
</span><span id="__span-60-41"><a id="__codelineno-60-41" name="__codelineno-60-41" href="#__codelineno-60-41"></a>  <span class="c1"># This is optional and can be left out to run pip manually.</span>
</span><span id="__span-60-42"><a id="__codelineno-60-42" name="__codelineno-60-42" href="#__codelineno-60-42"></a>  <span class="ss">postShellHook</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-60-43"><a id="__codelineno-60-43" name="__codelineno-60-43" href="#__codelineno-60-43"></a><span class="s s-Multiline">    # allow pip to install wheels</span>
</span><span id="__span-60-44"><a id="__codelineno-60-44" name="__codelineno-60-44" href="#__codelineno-60-44"></a><span class="s s-Multiline">    unset SOURCE_DATE_EPOCH</span>
</span><span id="__span-60-45"><a id="__codelineno-60-45" name="__codelineno-60-45" href="#__codelineno-60-45"></a><span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
</span><span id="__span-60-46"><a id="__codelineno-60-46" name="__codelineno-60-46" href="#__codelineno-60-46"></a>
</span><span id="__span-60-47"><a id="__codelineno-60-47" name="__codelineno-60-47" href="#__codelineno-60-47"></a><span class="p">}</span>
</span></code></pre></div>
<p>In case the supplied venvShellHook is insufficient, or when Python 2 support is
needed, you can define your own shell hook and adapt to your needs like in the
following example:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{</span> <span class="p">};</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="k">let</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>  <span class="ss">venvDir</span> <span class="o">=</span> <span class="s2">&quot;./.venv&quot;</span><span class="p">;</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>  <span class="ss">pythonPackages</span> <span class="o">=</span> python3Packages<span class="p">;</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="k">in</span> pkgs<span class="o">.</span>mkShell <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>  <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;impurePythonEnv&quot;</span><span class="p">;</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>  <span class="ss">buildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>    pythonPackages<span class="o">.</span>python
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a>    <span class="c1"># Needed when using python 2.7</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a>    <span class="c1"># pythonPackages.virtualenv</span>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a>    <span class="c1"># ...</span>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a>  <span class="p">];</span>
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a>
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a>  <span class="c1"># This is very close to how venvShellHook is implemented, but</span>
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a>  <span class="c1"># adapted to use &#39;virtualenv&#39;</span>
</span><span id="__span-61-17"><a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a>  <span class="ss">shellHook</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-61-18"><a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a><span class="s s-Multiline">    SOURCE_DATE_EPOCH=$(date +%s)</span>
</span><span id="__span-61-19"><a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a>
</span><span id="__span-61-20"><a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a><span class="s s-Multiline">    if [ -d &quot;</span><span class="si">${</span>venvDir<span class="si">}</span><span class="s s-Multiline">&quot; ]; then</span>
</span><span id="__span-61-21"><a id="__codelineno-61-21" name="__codelineno-61-21" href="#__codelineno-61-21"></a><span class="s s-Multiline">      echo &quot;Skipping venv creation, &#39;${venvDir}&#39; already exists&quot;</span>
</span><span id="__span-61-22"><a id="__codelineno-61-22" name="__codelineno-61-22" href="#__codelineno-61-22"></a><span class="s s-Multiline">    else</span>
</span><span id="__span-61-23"><a id="__codelineno-61-23" name="__codelineno-61-23" href="#__codelineno-61-23"></a><span class="s s-Multiline">      echo &quot;Creating new venv environment in path: &#39;${venvDir}&#39;&quot;</span>
</span><span id="__span-61-24"><a id="__codelineno-61-24" name="__codelineno-61-24" href="#__codelineno-61-24"></a><span class="s s-Multiline">      # Note that the module venv was only introduced in python 3, so for 2.7</span>
</span><span id="__span-61-25"><a id="__codelineno-61-25" name="__codelineno-61-25" href="#__codelineno-61-25"></a><span class="s s-Multiline">      # this needs to be replaced with a call to virtualenv</span>
</span><span id="__span-61-26"><a id="__codelineno-61-26" name="__codelineno-61-26" href="#__codelineno-61-26"></a><span class="s s-Multiline">      </span><span class="si">${</span>pythonPackages<span class="o">.</span>python<span class="o">.</span>interpreter<span class="si">}</span><span class="s s-Multiline"> -m venv &quot;</span><span class="si">${</span>venvDir<span class="si">}</span><span class="s s-Multiline">&quot;</span>
</span><span id="__span-61-27"><a id="__codelineno-61-27" name="__codelineno-61-27" href="#__codelineno-61-27"></a><span class="s s-Multiline">    fi</span>
</span><span id="__span-61-28"><a id="__codelineno-61-28" name="__codelineno-61-28" href="#__codelineno-61-28"></a>
</span><span id="__span-61-29"><a id="__codelineno-61-29" name="__codelineno-61-29" href="#__codelineno-61-29"></a><span class="s s-Multiline">    # Under some circumstances it might be necessary to add your virtual</span>
</span><span id="__span-61-30"><a id="__codelineno-61-30" name="__codelineno-61-30" href="#__codelineno-61-30"></a><span class="s s-Multiline">    # environment to PYTHONPATH, which you can do here too;</span>
</span><span id="__span-61-31"><a id="__codelineno-61-31" name="__codelineno-61-31" href="#__codelineno-61-31"></a><span class="s s-Multiline">    # PYTHONPATH=$PWD/</span><span class="si">${</span>venvDir<span class="si">}</span><span class="s s-Multiline">/</span><span class="si">${</span>pythonPackages<span class="o">.</span>python<span class="o">.</span>sitePackages<span class="si">}</span><span class="s s-Multiline">/:$PYTHONPATH</span>
</span><span id="__span-61-32"><a id="__codelineno-61-32" name="__codelineno-61-32" href="#__codelineno-61-32"></a>
</span><span id="__span-61-33"><a id="__codelineno-61-33" name="__codelineno-61-33" href="#__codelineno-61-33"></a><span class="s s-Multiline">    source &quot;</span><span class="si">${</span>venvDir<span class="si">}</span><span class="s s-Multiline">/bin/activate&quot;</span>
</span><span id="__span-61-34"><a id="__codelineno-61-34" name="__codelineno-61-34" href="#__codelineno-61-34"></a>
</span><span id="__span-61-35"><a id="__codelineno-61-35" name="__codelineno-61-35" href="#__codelineno-61-35"></a><span class="s s-Multiline">    # As in the previous example, this is optional.</span>
</span><span id="__span-61-36"><a id="__codelineno-61-36" name="__codelineno-61-36" href="#__codelineno-61-36"></a><span class="s s-Multiline">    pip install -r requirements.txt</span>
</span><span id="__span-61-37"><a id="__codelineno-61-37" name="__codelineno-61-37" href="#__codelineno-61-37"></a><span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
</span><span id="__span-61-38"><a id="__codelineno-61-38" name="__codelineno-61-38" href="#__codelineno-61-38"></a><span class="p">}</span>
</span></code></pre></div>
<p>Note that the <code>pip install</code> is an imperative action. So every time <code>nix-shell</code>
is executed it will attempt to download the Python modules listed in
requirements.txt. However these will be cached locally within the <code>virtualenv</code>
folder and not downloaded again.</p>
<h3 id="how-to-override-a-python-package-from-configuration.nix">How to override a Python package from <code>configuration.nix</code>?<a class="headerlink" href="#how-to-override-a-python-package-from-configuration.nix" title="Permanent link">#</a></h3>
<p>If you need to change a package's attribute(s) from <code>configuration.nix</code> you could do:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>  nixpkgs<span class="o">.</span>config<span class="o">.</span><span class="ss">packageOverrides</span> <span class="o">=</span> super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>    <span class="ss">python3</span> <span class="o">=</span> super<span class="o">.</span>python3<span class="o">.</span>override <span class="p">{</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>      <span class="ss">packageOverrides</span> <span class="o">=</span> python-self<span class="p">:</span> python-super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>        <span class="ss">twisted</span> <span class="o">=</span> python-super<span class="o">.</span>twisted<span class="o">.</span>overridePythonAttrs <span class="p">(</span>oldAttrs<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>          <span class="ss">src</span> <span class="o">=</span> super<span class="o">.</span>fetchPypi <span class="p">{</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a>            <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;Twisted&quot;</span><span class="p">;</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a>            <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;19.10.0&quot;</span><span class="p">;</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a>            <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-c5S6fycq5yKnTz2Wnc9Zm8TvCTvDkgOHSKSQ8XJKUV0=&quot;</span><span class="p">;</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a>            <span class="ss">extension</span> <span class="o">=</span> <span class="s2">&quot;tar.bz2&quot;</span><span class="p">;</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a>          <span class="p">};</span>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a>        <span class="p">});</span>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a>      <span class="p">};</span>
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a>    <span class="p">};</span>
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a>  <span class="p">};</span>
</span></code></pre></div>
<p><code>python3Packages.twisted</code> is now globally overridden.
All packages and also all NixOS services that reference <code>twisted</code>
(such as <code>services.buildbot-worker</code>) now use the new definition.
Note that <code>python-super</code> refers to the old package set and <code>python-self</code>
to the new, overridden version.</p>
<p>To modify only a Python package set instead of a whole Python derivation, use
this snippet:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>  <span class="ss">myPythonPackages</span> <span class="o">=</span> python3Packages<span class="o">.</span>override <span class="p">{</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>    <span class="ss">overrides</span> <span class="o">=</span> self<span class="p">:</span> super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>      <span class="ss">twisted</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>    <span class="p">};</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>  <span class="p">}</span>
</span></code></pre></div>
<h3 id="how-to-override-a-python-package-using-overlays">How to override a Python package using overlays?<a class="headerlink" href="#how-to-override-a-python-package-using-overlays" title="Permanent link">#</a></h3>
<p>Use the following overlay template:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>self<span class="p">:</span> super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>  <span class="ss">python</span> <span class="o">=</span> super<span class="o">.</span>python<span class="o">.</span>override <span class="p">{</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>    <span class="ss">packageOverrides</span> <span class="o">=</span> python-self<span class="p">:</span> python-super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>      <span class="ss">twisted</span> <span class="o">=</span> python-super<span class="o">.</span>twisted<span class="o">.</span>overrideAttrs <span class="p">(</span>oldAttrs<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>        <span class="ss">src</span> <span class="o">=</span> super<span class="o">.</span>fetchPypi <span class="p">{</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>          <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;Twisted&quot;</span><span class="p">;</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>          <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;19.10.0&quot;</span><span class="p">;</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>          <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-c5S6fycq5yKnTz2Wnc9Zm8TvCTvDkgOHSKSQ8XJKUV0=&quot;</span><span class="p">;</span>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>          <span class="ss">extension</span> <span class="o">=</span> <span class="s2">&quot;tar.bz2&quot;</span><span class="p">;</span>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a>        <span class="p">};</span>
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>      <span class="p">});</span>
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>    <span class="p">};</span>
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>  <span class="p">};</span>
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="how-to-override-a-python-package-for-all-python-versions-using-extensions">How to override a Python package for all Python versions using extensions?<a class="headerlink" href="#how-to-override-a-python-package-for-all-python-versions-using-extensions" title="Permanent link">#</a></h3>
<p>The following overlay overrides the call to <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a> for the
<code>foo</code> package for all interpreters by appending a Python extension to the
<code>pythonPackagesExtensions</code> list of extensions.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>final<span class="p">:</span> prev<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>  <span class="ss">pythonPackagesExtensions</span> <span class="o">=</span> prev<span class="o">.</span>pythonPackagesExtensions <span class="o">++</span> <span class="p">[</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>    <span class="p">(</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>      python-final<span class="p">:</span> python-prev<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>        <span class="ss">foo</span> <span class="o">=</span> python-prev<span class="o">.</span>foo<span class="o">.</span>overridePythonAttrs <span class="p">(</span>oldAttrs<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>          <span class="o">...</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>        <span class="p">});</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>      <span class="p">}</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>    <span class="p">)</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>  <span class="p">];</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="how-to-use-intels-mkl-with-numpy-and-scipy">How to use Intel’s MKL with numpy and scipy?<a class="headerlink" href="#how-to-use-intels-mkl-with-numpy-and-scipy" title="Permanent link">#</a></h3>
<p>MKL can be configured using an overlay. See the section "<a href="#sec-overlays-alternatives-blas-lapack">Using overlays to
configure alternatives</a>".</p>
<h3 id="what-inputs-do-setup_requires-install_requires-and-tests_require-map-to">What inputs do <code>setup_requires</code>, <code>install_requires</code> and <code>tests_require</code> map to?<a class="headerlink" href="#what-inputs-do-setup_requires-install_requires-and-tests_require-map-to" title="Permanent link">#</a></h3>
<p>In a <code>setup.py</code> or <code>setup.cfg</code> it is common to declare dependencies:</p>
<ul>
<li><code>setup_requires</code> corresponds to <a href="#var-stdenv-nativeBuildInputs"><code>nativeBuildInputs</code></a></li>
<li><code>install_requires</code> corresponds to <a href="#var-stdenv-propagatedBuildInputs"><code>propagatedBuildInputs</code></a></li>
<li><code>tests_require</code> corresponds to <a href="#var-stdenv-nativeCheckInputs"><code>nativeCheckInputs</code></a></li>
</ul>
<h3 id="optimizations">How to enable interpreter optimizations?<a class="headerlink" href="#optimizations" title="Permanent link">#</a></h3>
<p>The Python interpreters are by default not built with optimizations enabled, because
the builds are in that case not reproducible. To enable optimizations, override the
interpreter of interest, e.g using</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>let
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>  pkgs = import ./. {};
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>  mypython = pkgs.python3.override {
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>    enableOptimizations = true;
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>    reproducibleBuild = false;
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a>    self = mypython;
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>  };
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a>in mypython
</span></code></pre></div>
<h3 id="python-optional-dependencies">How to add optional dependencies?<a class="headerlink" href="#python-optional-dependencies" title="Permanent link">#</a></h3>
<p>Some packages define optional dependencies for additional features. With
<code>setuptools</code> this is called <code>extras_require</code> and <code>flit</code> calls it
<code>extras-require</code>, while PEP 621 calls these <code>optional-dependencies</code>. A
method for supporting this is by declaring the extras of a package in its
<code>passthru</code>, e.g. in case of the package <code>dask</code></p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>passthru<span class="o">.</span><span class="ss">optional-dependencies</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>  <span class="ss">complete</span> <span class="o">=</span> <span class="p">[</span> distributed <span class="p">];</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="p">};</span>
</span></code></pre></div>
<p>and letting the package requiring the extra add the list to its dependencies</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="ss">propagatedBuildInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>  <span class="o">...</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="p">]</span> <span class="o">++</span> dask<span class="o">.</span>optional-dependencies<span class="o">.</span>complete<span class="p">;</span>
</span></code></pre></div>
<p>Note this method is preferred over adding parameters to builders, as that can
result in packages depending on different variants and thereby causing
collisions.</p>
<h3 id="tools">How to contribute a Python package to nixpkgs?<a class="headerlink" href="#tools" title="Permanent link">#</a></h3>
<p>Packages inside nixpkgs must use the <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a> or <a href="#buildpythonapplication-function"><code>buildPythonApplication</code></a> function directly,
because we can only provide security support for non-vendored dependencies.</p>
<p>We recommend <a href="https://github.com/nix-community/nix-init">nix-init</a> for creating new python packages within nixpkgs,
as it already prefetches the source, parses dependencies for common formats and prefills most things in <code>meta</code>.</p>
<h3 id="deterministic-builds">Are Python interpreters built deterministically?<a class="headerlink" href="#deterministic-builds" title="Permanent link">#</a></h3>
<p>The Python interpreters are now built deterministically. Minor modifications had
to be made to the interpreters in order to generate deterministic bytecode. This
has security implications and is relevant for those using Python in a
<code>nix-shell</code>.</p>
<p>When the environment variable <code>DETERMINISTIC_BUILD</code> is set, all bytecode will
have timestamp 1. The <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a> function sets <code>DETERMINISTIC_BUILD=1</code>
and <a href="https://docs.python.org/3.11/using/cmdline.html#envvar-PYTHONHASHSEED">PYTHONHASHSEED=0</a>.
Both are also exported in <code>nix-shell</code>.</p>
<h3 id="automatic-tests">How to provide automatic tests to Python packages?<a class="headerlink" href="#automatic-tests" title="Permanent link">#</a></h3>
<p>It is recommended to test packages as part of the build process.
Source distributions (<code>sdist</code>) often include test files, but not always.</p>
<p>By default the command <code>python setup.py test</code> is run as part of the
<a href="#ssec-check-phase"><code>checkPhase</code></a>, but often it is necessary to pass a custom <a href="#ssec-check-phase"><code>checkPhase</code></a>. An
example of such a situation is when <code>py.test</code> is used.</p>
<h4 id="common-issues">Common issues<a class="headerlink" href="#common-issues" title="Permanent link">#</a></h4>
<ul>
<li>Non-working tests can often be deselected. By default <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a>
  runs <code>python setup.py test</code>. which is deprecated. Most Python modules however
  do follow the standard test protocol where the pytest runner can be used
  instead. <code>pytest</code> supports the <code>-k</code> and <code>--ignore</code> parameters to ignore test
  methods or classes as well as whole files. For <code>pytestCheckHook</code> these are
  conveniently exposed as <code>disabledTests</code> and <code>disabledTestPaths</code> respectively.</li>
</ul>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>buildPythonPackage <span class="p">{</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>  <span class="c1"># ...</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>  <span class="ss">nativeCheckInputs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>    pytestCheckHook
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>  <span class="p">];</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a>  <span class="ss">disabledTests</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a>    <span class="s2">&quot;function_name&quot;</span>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a>    <span class="s2">&quot;other_function&quot;</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a>  <span class="p">];</span>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a>  <span class="ss">disabledTestPaths</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-69-13"><a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a>    <span class="s2">&quot;this/file.py&quot;</span>
</span><span id="__span-69-14"><a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a>  <span class="p">];</span>
</span><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Tests that attempt to access <code>$HOME</code> can be fixed by using the following
  work-around before running tests (e.g. <code>preCheck</code>): <code>export HOME=$(mktemp -d)</code></li>
</ul>
<h2 id="contributing">Contributing<a class="headerlink" href="#contributing" title="Permanent link">#</a></h2>
<h3 id="contributing-guidelines">Contributing guidelines<a class="headerlink" href="#contributing-guidelines" title="Permanent link">#</a></h3>
<p>The following rules are desired to be respected:</p>
<ul>
<li>Python libraries are called from <code>python-packages.nix</code> and packaged with
  <a href="#buildpythonpackage-function"><code>buildPythonPackage</code></a>. The expression of a library should be in
  <code>pkgs/development/python-modules/&lt;name&gt;/default.nix</code>.</li>
<li>Python applications live outside of <code>python-packages.nix</code> and are packaged
  with <a href="#buildpythonapplication-function"><code>buildPythonApplication</code></a>.</li>
<li>Make sure libraries build for all Python interpreters.</li>
<li>By default we enable tests. Make sure the tests are found and, in the case of
  libraries, are passing for all interpreters. If certain tests fail they can be
  disabled individually. Try to avoid disabling the tests altogether. In any
  case, when you disable tests, leave a comment explaining why.</li>
<li>Commit names of Python libraries should reflect that they are Python
  libraries, so write for example <code>python311Packages.numpy: 1.11 -&gt; 1.12</code>.
  It is highly recommended to specify the current default version to enable
  automatic build by ofborg.</li>
<li>Attribute names in <code>python-packages.nix</code> as well as <code>pname</code>s should match the
  library's name on PyPI, but be normalized according to <a href="https://www.python.org/dev/peps/pep-0503/#normalized-names">PEP
  0503</a>. This means
  that characters should be converted to lowercase and <code>.</code> and <code>_</code> should be
  replaced by a single <code>-</code> (foo-bar-baz instead of Foo__Bar.baz).
  If necessary, <code>pname</code> has to be given a different value within <code>fetchPypi</code>.</li>
<li>Packages from sources such as GitHub and GitLab that do not exist on PyPI
  should not use a name that is already used on PyPI. When possible, they should
  use the package repository name prefixed with the owner (e.g. organization) name
  and using a <code>-</code> as delimiter.</li>
<li>Attribute names in <code>python-packages.nix</code> should be sorted alphanumerically to
  avoid merge conflicts and ease locating attributes.</li>
</ul>
<h2 id="python-package-set-maintenance">Package set maintenance<a class="headerlink" href="#python-package-set-maintenance" title="Permanent link">#</a></h2>
<p>The whole Python package set has a lot of packages that do not see regular
updates, because they either are a very fragile component in the Python
ecosystem, like for example the <code>hypothesis</code> package, or packages that have
no maintainer, so maintenance falls back to the package set maintainers.</p>
<h3 id="python-package-bulk-updates">Updating packages in bulk<a class="headerlink" href="#python-package-bulk-updates" title="Permanent link">#</a></h3>
<p>There is a tool to update alot of python libraries in bulk, it exists at
<code>maintainers/scripts/update-python-libraries</code> with this repository.</p>
<p>It can quickly update minor or major versions for all packages selected
and create update commits, and supports the <code>fetchPypi</code>, <code>fetchurl</code> and
<code>fetchFromGitHub</code> fetchers. When updating lots of packages that are
hosted on GitHub, exporting a <code>GITHUB_API_TOKEN</code> is highly recommended.</p>
<p>Updating packages in bulk leads to lots of breakages, which is why a
stabilization period on the <code>python-updates</code> branch is required.</p>
<p>If a package is fragile and often breaks during these bulks updates, it
may be reasonable to set <code>passthru.skipBulkUpdate = true</code> in the
derivation. This decision should not be made on a whim and should
always be supported by a qualifying comment.</p>
<p>Once the branch is sufficiently stable it should normally be merged
into the <code>staging</code> branch.</p>
<p>An exemplary call to update all python libraries between minor versions
would be:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>$ maintainers/scripts/update-python-libraries --target minor --commit --use-pkgs-prefix pkgs/development/python-modules/**/default.nix
</span></code></pre></div>
<h2 id="python-cpython-update-schedule">CPython Update Schedule<a class="headerlink" href="#python-cpython-update-schedule" title="Permanent link">#</a></h2>
<p>With <a href="https://www.python.org/dev/peps/pep-0602/">PEP 602</a>, CPython now
follows a yearly release cadence. In nixpkgs, all supported interpreters
are made available, but only the most recent two
interpreters package sets are built; this is a compromise between being
the latest interpreter, and what the majority of the Python packages support.</p>
<p>New CPython interpreters are released in October. Generally, it takes some
time for the majority of active Python projects to support the latest stable
interpreter. To help ease the migration for Nixpkgs users
between Python interpreters the schedule below will be used:</p>
<table>
<thead>
<tr>
<th>When</th>
<th>Event</th>
</tr>
</thead>
<tbody>
<tr>
<td>After YY.11 Release</td>
<td>Bump CPython package set window. The latest and previous latest stable should now be built.</td>
</tr>
<tr>
<td>After YY.05 Release</td>
<td>Bump default CPython interpreter to latest stable.</td>
</tr>
</tbody>
</table>
<p>In practice, this means that the Python community will have had a stable interpreter
for ~2 months before attempting to update the package set. And this will
allow for ~7 months for Python applications to support the latest interpreter.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="pkg-config.section.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: pkg-config">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                pkg-config
              </div>
            </div>
          </a>
        
        
          
          <a href="qt.section.html" class="md-footer__link md-footer__link--next" aria-label="Next: Qt">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Qt
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 <a href=https://nervosys.ai/>Nervosys, LLC</a>
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/nervosys/Botnix" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://discord.gg/x84JXYje" target="_blank" rel="noopener" title="discord.gg" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://x.com/nervosys" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.tabs.link", "navigation.expand", "navigation.top", "navigation.instant", "navigation.path", "navigation.footer", "search.suggest", "search.share", "toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest"}}</script>
    
    
      <script src="../assets/javascripts/bundle.caa56a14.min.js"></script>
      
        <script src="../javascripts/extra.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>