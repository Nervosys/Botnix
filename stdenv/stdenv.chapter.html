
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The operating system for autonomous systems">
      
      
      
        <link rel="canonical" href="https://github.com/nervosys/Botnix/stdenv/stdenv.chapter.html">
      
      
        <link rel="prev" href="platform-notes.chapter.html">
      
      
        <link rel="next" href="../using/configuration.chapter.html">
      
      
      <link rel="icon" href="../images/rune.svg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.7">
    
    
      
        <title>The Standard Environment - Botnix</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chap-stdenv" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Botnix" class="md-header__button md-logo" aria-label="Botnix" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 14h-1c0-3.87-3.13-7-7-7h-1V5.73A2 2 0 1 0 10 4c0 .74.4 1.39 1 1.73V7h-1c-3.87 0-7 3.13-7 7H2c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h1v1a2 2 0 0 0 2 2h14c1.11 0 2-.89 2-2v-1h1c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1M8.68 17.04 7.5 15.86l-1.18 1.18-1.18-1.18L7.5 13.5l2.36 2.36-1.18 1.18m9 0-1.18-1.18-1.18 1.18-1.18-1.18 2.36-2.36 2.36 2.36-1.18 1.18Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Botnix
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              The Standard Environment
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="nervosys" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/nervosys/Botnix" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    nervosys/Botnix
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Botnix" class="md-nav__button md-logo" aria-label="Botnix" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 14h-1c0-3.87-3.13-7-7-7h-1V5.73A2 2 0 1 0 10 4c0 .74.4 1.39 1 1.73V7h-1c-3.87 0-7 3.13-7 7H2c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h1v1a2 2 0 0 0 2 2h14c1.11 0 2-.89 2-2v-1h1c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1M8.68 17.04 7.5 15.86l-1.18 1.18-1.18-1.18L7.5 13.5l2.36 2.36-1.18 1.18m9 0-1.18-1.18-1.18 1.18-1.18-1.18 2.36-2.36 2.36 2.36-1.18 1.18Z"/></svg>

    </a>
    Botnix
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nervosys/Botnix" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    nervosys/Botnix
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build helpers
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing to Nixpkgs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../development.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development of Nixpkgs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Functions reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nixpkgs lib
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../preface.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preface
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../stdenv.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standard environment
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../using-nixpkgs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Nixpkgs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Build helpers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Build helpers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/fetchers.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fetchers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Images
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Special build helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/testers.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/trivial-build-helpers.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trivial build helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_6" >
        
          
          <label class="md-nav__link" for="__nav_10_6" id="__nav_10_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Images
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_6">
            <span class="md-nav__icon md-icon"></span>
            Images
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/appimagetools.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.appimageTools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/binarycache.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.mkBinaryCache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/dockertools.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.dockerTools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/makediskimage.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    &lt;nixpkgs/nixos/lib/make-disk-image.nix&gt;
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/ocitools.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.ociTools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/portableservice.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.portableService
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/images/snaptools.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.snapTools
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_7" >
        
          
          <label class="md-nav__link" for="__nav_10_7" id="__nav_10_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Special
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_7">
            <span class="md-nav__icon md-icon"></span>
            Special
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/checkpoint-build.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.checkpointBuildTools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/fakenss.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fakeNss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/fhs-environments.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    buildFHSEnv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/makesetuphook.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.makeSetupHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/mkshell.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.mkShell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-helpers/special/vm-tools.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vmTools
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/coding-conventions.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coding conventions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/contributing-to-documentation.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing to Nixpkgs documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/quick-start.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start to Adding a Package
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/reviewing-contributions.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reviewing contributions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/submitting-changes.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submitting changes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/vulnerability-roundup.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vulnerability Roundup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/opening-issues.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Opening issues
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Functions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Functions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/debug.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging Nix Expressions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/generators.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/nix-gitignore.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkgs.nix-gitignore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/prefer-remote-fetch.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    prefer-remote-fetch overlay
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hooks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Hooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hooks reference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/autoconf.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autoconf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/automake.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automake
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/autopatchelf.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    autoPatchelfHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/bmake.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bmake
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/breakpoint.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    breakpointHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/cmake.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cmake
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/gdk-pixbuf.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gdk-pixbuf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/ghc.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GHC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/gnome.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GNOME platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/installShellFiles.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    installShellFiles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/libiconv.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    libiconv, libintl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/libxml2.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    libxml2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/meson.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/mpi-check-hook.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mpiCheckPhaseHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/ninja.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ninja
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/patch-rc-path-hooks.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    patchRcPath hooks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/perl.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/pkg-config.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkg-config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/postgresql-test-hook.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    postgresqlTestHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/python.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/scons.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    scons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/tetex-tex-live.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    teTeX / TeX Live
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/unzip.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    unzip
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/validatePkgConfig.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    validatePkgConfig
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/waf.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    wafHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/xcbuild.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    xcbuildHook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/zig.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zig.hook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Languages frameworks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            Languages frameworks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Languages and frameworks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/agda.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/android.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/beam.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BEAM Languages (Erlang, Elixir & LFE)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/bower.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bower
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/chicken.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CHICKEN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/coq.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coq and coq packages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/crystal.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crystal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/cuda.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CUDA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/cuelang.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cue (Cuelang)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/dart.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/dhall.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dhall
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/dotnet.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dotnet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/emscripten.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Emscripten
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/gnome.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GNOME
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/go.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Go
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/haskell.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Haskell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/hy.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/idris.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Idris
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/idris2.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Idris2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/ios.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/java.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/javascript.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Javascript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/julia.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Julia
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/lisp.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lisp-modules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/lua.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User’s Guide to Lua Infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/maven.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maven
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/nim.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/ocaml.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/octave.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Octave
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/perl.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/php.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/pkg-config.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pkg-config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/python.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/qt.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Qt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/r.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    R
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/ruby.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ruby
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/rust.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rust
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/swift.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Swift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/texlive.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TeX Live
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/titanium.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Titanium
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../languages-frameworks/vim.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vim
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Module system
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Module system
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../module-system/module-system.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Module System
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_17" >
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Packages
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            Packages
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Packages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/cataclysm-dda.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cataclysm: Dark Days Ahead
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/citrix.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Citrix Workspace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/darwin-builder.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    darwin.linux-builder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/dlib.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DLib
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/eclipse.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Eclipse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/elm.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Elm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/emacs.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Emacs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/etc-files.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    /etc files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/firefox.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Firefox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/fish.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fish
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/fuse.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FUSE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/ibus.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ibus-engines.typing-booster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/kakoune.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kakoune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/linux.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux kernel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/locales.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Locales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/nginx.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/opengl.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenGL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/shell-helpers.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interactive shell helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/steam.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Steam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/urxvt.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Urxvt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/weechat.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WeeChat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/xorg.section.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    X.org
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" checked>
        
          
          <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stdenv
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            Stdenv
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cross-compilation.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross-compilation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="meta.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meta-attributes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="multiple-output.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple-output packages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="platform-notes.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Platform Notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    The Standard Environment
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="stdenv.chapter.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    The Standard Environment
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sec-using-stdenv" class="md-nav__link">
    <span class="md-ellipsis">
      Using stdenv
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using stdenv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sec-building-stdenv-package-in-nix-shell" class="md-nav__link">
    <span class="md-ellipsis">
      Building a stdenv package in nix-shell
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sec-tools-of-stdenv" class="md-nav__link">
    <span class="md-ellipsis">
      Tools provided by stdenv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssec-stdenv-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Specifying dependencies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Specifying dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssec-stdenv-dependencies-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssec-stdenv-dependencies-overview-example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssec-stdenv-dependencies-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Reference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssec-stdenv-dependencies-propagated" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency propagation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_19" >
        
          
          <label class="md-nav__link" for="__nav_19" id="__nav_19_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Using
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19">
            <span class="md-nav__icon md-icon"></span>
            Using
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../using/configuration.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Global configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../using/overlays.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overlays
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../using/overrides.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overriding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../using/platform-support.chapter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Platform Support
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="chap-stdenv">The Standard Environment<a class="headerlink" href="#chap-stdenv" title="Permanent link">#</a></h1>
<p>The standard build environment in the Nix Packages collection provides an environment for building Unix packages that does a lot of common build tasks automatically. In fact, for Unix packages that use the standard <code>./configure; make; make install</code> build interface, you don’t need to write a build script at all; the standard environment does everything automatically. If <code>stdenv</code> doesn’t do what you need automatically, you can easily customise or override the various build phases.</p>
<h2 id="sec-using-stdenv">Using <code>stdenv</code><a class="headerlink" href="#sec-using-stdenv" title="Permanent link">#</a></h2>
<p>To build a package with the standard environment, you use the function <code>stdenv.mkDerivation</code>, instead of the primitive built-in function <code>derivation</code>, e.g.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>stdenv<span class="o">.</span>mkDerivation <span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;libfoo-1.2.3&quot;</span><span class="p">;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>  <span class="ss">src</span> <span class="o">=</span> fetchurl <span class="p">{</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;http://example.org/libfoo-1.2.3.tar.bz2&quot;</span><span class="p">;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-tWxU/LANbQE32my+9AXyt3nCT7NBVfJ45CX757EMT3Q=&quot;</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>  <span class="p">};</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>(<code>stdenv</code> needs to be in scope, so if you write this in a separate Nix expression from <code>pkgs/all-packages.nix</code>, you need to pass it as a function argument.) Specifying a <code>name</code> and a <code>src</code> is the absolute minimum Nix requires. For convenience, you can also use <code>pname</code> and <code>version</code> attributes and <code>mkDerivation</code> will automatically set <code>name</code> to <code>"${pname}-${version}"</code> by default.
<strong>Since <a href="https://github.com/NixOS/rfcs/pull/35">RFC 0035</a>, this is preferred for packages in Nixpkgs</strong>, as it allows us to reuse the version easily:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>stdenv<span class="o">.</span>mkDerivation <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;libfoo&quot;</span><span class="p">;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;1.2.3&quot;</span><span class="p">;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>  <span class="ss">src</span> <span class="o">=</span> fetchurl <span class="p">{</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;http://example.org/libfoo-source-</span><span class="si">${</span>version<span class="si">}</span><span class="s2">.tar.bz2&quot;</span><span class="p">;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-tWxU/LANbQE32my+9AXyt3nCT7NBVfJ45CX757EMT3Q=&quot;</span><span class="p">;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>  <span class="p">};</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>Many packages have dependencies that are not provided in the standard environment. It’s usually sufficient to specify those dependencies in the <code>buildInputs</code> attribute:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>stdenv<span class="o">.</span>mkDerivation <span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;libfoo&quot;</span><span class="p">;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;1.2.3&quot;</span><span class="p">;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>  <span class="o">...</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>  <span class="ss">buildInputs</span> <span class="o">=</span> <span class="p">[</span>libbar perl ncurses<span class="p">];</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>This attribute ensures that the <code>bin</code> subdirectories of these packages appear in the <code>PATH</code> environment variable during the build, that their <code>include</code> subdirectories are searched by the C compiler, and so on. (See <a href="#ssec-setup-hooks"></a> for details.)</p>
<p>Often it is necessary to override or modify some aspect of the build. To make this easier, the standard environment breaks the package build into a number of <em>phases</em>, all of which can be overridden or modified individually: unpacking the sources, applying patches, configuring, building, and installing. (There are some others; see <a href="#sec-stdenv-phases"></a>.) For instance, a package that doesn’t supply a makefile but instead has to be compiled "manually" could be handled like this:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>stdenv<span class="o">.</span>mkDerivation <span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;fnord&quot;</span><span class="p">;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;4.5&quot;</span><span class="p">;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>  <span class="o">...</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>  <span class="ss">buildPhase</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="s s-Multiline">    gcc foo.c -o foo</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>  <span class="ss">installPhase</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="s s-Multiline">    mkdir -p $out/bin</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="s s-Multiline">    cp foo $out/bin</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="p">}</span>
</span></code></pre></div>
<p>(Note the use of <code>''</code>-style string literals, which are very convenient for large multi-line script fragments because they don’t need escaping of <code>"</code> and <code>\</code>, and because indentation is intelligently removed.)</p>
<p>There are many other attributes to customise the build. These are listed in <a href="#ssec-stdenv-attributes"></a>.</p>
<p>While the standard environment provides a generic builder, you can still supply your own build script:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>stdenv<span class="o">.</span>mkDerivation <span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;libfoo&quot;</span><span class="p">;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;1.2.3&quot;</span><span class="p">;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>  <span class="o">...</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>  <span class="ss">builder</span> <span class="o">=</span> <span class="l">./builder.sh</span><span class="p">;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>where the builder can do anything it wants, but typically starts with</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">source</span><span class="w"> </span><span class="nv">$stdenv</span>/setup
</span></code></pre></div>
<p>to let <code>stdenv</code> set up the environment (e.g. by resetting <code>PATH</code> and populating it from build inputs). If you want, you can still use <code>stdenv</code>’s generic builder:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">source</span><span class="w"> </span><span class="nv">$stdenv</span>/setup
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>buildPhase<span class="o">()</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;... this is my custom build phase ...&quot;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span>gcc<span class="w"> </span>foo.c<span class="w"> </span>-o<span class="w"> </span>foo
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="o">}</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>installPhase<span class="o">()</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">  </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$out</span>/bin
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">  </span>cp<span class="w"> </span>foo<span class="w"> </span><span class="nv">$out</span>/bin
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="o">}</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>genericBuild
</span></code></pre></div>
<h3 id="sec-building-stdenv-package-in-nix-shell">Building a <code>stdenv</code> package in <code>nix-shell</code><a class="headerlink" href="#sec-building-stdenv-package-in-nix-shell" title="Permanent link">#</a></h3>
<p>To build a <code>stdenv</code> package in a <a href="https://nixos.org/manual/nix/unstable/command-ref/nix-shell.html"><code>nix-shell</code></a>, enter a shell, find the <a href="#sec-stdenv-phases">phases</a> you wish to build, then invoke <code>genericBuild</code> manually:</p>
<p>Go to an empty directory, invoke <code>nix-shell</code> with the desired package, and from inside the shell, set the output variables to a writable directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>mktemp<span class="w"> </span>-d<span class="k">)</span><span class="s2">&quot;</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>nix-shell<span class="w"> </span><span class="s1">&#39;&lt;nixpkgs&gt;&#39;</span><span class="w"> </span>-A<span class="w"> </span>some_package
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">out</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/out
</span></code></pre></div>
<p>Next, invoke the desired parts of the build.
First, run the phases that generate a working copy of the sources, which will change directory to the sources for you:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nv">phases</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">prePhases</span><span class="p">[*]</span><span class="k">:-</span><span class="si">}</span><span class="s2"> unpackPhase patchPhase&quot;</span><span class="w"> </span>genericBuild
</span></code></pre></div>
<p>Then, run more phases up until the failure is reached.
If the failure is in the build or check phase, the following phases would be required:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nv">phases</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">preConfigurePhases</span><span class="p">[*]</span><span class="k">:-</span><span class="si">}</span><span class="s2"> configurePhase </span><span class="si">${</span><span class="nv">preBuildPhases</span><span class="p">[*]</span><span class="k">:-</span><span class="si">}</span><span class="s2"> buildPhase checkPhase&quot;</span><span class="w"> </span>genericBuild
</span></code></pre></div>
<p>Use this command to run all install phases:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nv">phases</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">preInstallPhases</span><span class="p">[*]</span><span class="k">:-</span><span class="si">}</span><span class="s2"> installPhase </span><span class="si">${</span><span class="nv">preFixupPhases</span><span class="p">[*]</span><span class="k">:-</span><span class="si">}</span><span class="s2"> fixupPhase installCheckPhase&quot;</span><span class="w"> </span>genericBuild
</span></code></pre></div></p>
<p>Single phase can be re-run as many times as necessary to examine the failure like so:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nv">phases</span><span class="o">=</span><span class="s2">&quot;buildPhase&quot;</span><span class="w"> </span>genericBuild
</span></code></pre></div>
<p>To modify a <a href="#sec-stdenv-phases">phase</a>, first print it with</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$buildPhase</span><span class="s2">&quot;</span>
</span></code></pre></div>
<p>Or, if that is empty, for instance, if it is using a function:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nb">type</span><span class="w"> </span>buildPhase
</span></code></pre></div>
<p>then change it in a text editor, and paste it back to the terminal.</p>
<p>::: {.note}
This method may have some inconsistencies in environment variables and behaviour compared to a normal build within the <a href="https://nixos.org/manual/nix/unstable/language/derivations#builder-execution">Nix build sandbox</a>.
The following is a non-exhaustive list of such differences:</p>
<ul>
<li><code>TMP</code>, <code>TMPDIR</code>, and similar variables likely point to non-empty directories that the build might conflict with files in.</li>
<li>Output store paths are not writable, so the variables for outputs need to be overridden to writable paths.</li>
<li>Other environment variables may be inconsistent with a <code>nix-build</code> either due to <code>nix-shell</code>'s initialization script or due to the use of <code>nix-shell</code> without the <code>--pure</code> option.</li>
</ul>
<p>If the build fails differently inside the shell than in the sandbox, consider using <a href="#breakpointhook"><code>breakpointHook</code></a> and invoking <code>nix-build</code> instead.
The <a href="https://nixos.org/manual/nix/unstable/command-ref/conf-file#opt--keep-failed"><code>--keep-failed</code></a> option for <code>nix-build</code> may also be useful to examine the build directory of a failed build.
:::</p>
<h2 id="sec-tools-of-stdenv">Tools provided by <code>stdenv</code><a class="headerlink" href="#sec-tools-of-stdenv" title="Permanent link">#</a></h2>
<p>The standard environment provides the following packages:</p>
<ul>
<li>The GNU C Compiler, configured with C and C++ support.</li>
<li>GNU coreutils (contains a few dozen standard Unix commands).</li>
<li>GNU findutils (contains <code>find</code>).</li>
<li>GNU diffutils (contains <code>diff</code>, <code>cmp</code>).</li>
<li>GNU <code>sed</code>.</li>
<li>GNU <code>grep</code>.</li>
<li>GNU <code>awk</code>.</li>
<li>GNU <code>tar</code>.</li>
<li><code>gzip</code>, <code>bzip2</code> and <code>xz</code>.</li>
<li>GNU Make.</li>
<li>Bash. This is the shell used for all builders in the Nix Packages collection. Not using <code>/bin/sh</code> removes a large source of portability problems.</li>
<li>The <code>patch</code> command.</li>
</ul>
<p>On Linux, <code>stdenv</code> also includes the <code>patchelf</code> utility.</p>
<h2 id="ssec-stdenv-dependencies">Specifying dependencies<a class="headerlink" href="#ssec-stdenv-dependencies" title="Permanent link">#</a></h2>
<p>Build systems often require more dependencies than just what <code>stdenv</code> provides. This section describes attributes accepted by <code>stdenv.mkDerivation</code> that can be used to make these dependencies available to the build system.</p>
<h3 id="ssec-stdenv-dependencies-overview">Overview<a class="headerlink" href="#ssec-stdenv-dependencies-overview" title="Permanent link">#</a></h3>
<p>A full reference of the different kinds of dependencies is provided in <a href="#ssec-stdenv-dependencies-reference"></a>, but here is an overview of the most common ones.
It should cover most use cases.</p>
<p>Add dependencies to <code>nativeBuildInputs</code> if they are executed during the build:
- those which are needed on <code>$PATH</code> during the build, for example <code>cmake</code> and <code>pkg-config</code>
- <a href="#ssec-setup-hooks">setup hooks</a>, for example <a href="#fun-makeWrapper"><code>makeWrapper</code></a>
- interpreters needed by <a href="#patch-shebangs.sh"><code>patchShebangs</code></a> for build scripts (with the <code>--build</code> flag), which can be the case for e.g. <code>perl</code></p>
<p>Add dependencies to <code>buildInputs</code> if they will end up copied or linked into the final output or otherwise used at runtime:
- libraries used by compilers, for example <code>zlib</code>,
- interpreters needed by <a href="#patch-shebangs.sh"><code>patchShebangs</code></a> for scripts which are installed, which can be the case for e.g. <code>perl</code></p>
<p>::: {.note}
These criteria are independent.</p>
<p>For example, software using Wayland usually needs the <code>wayland</code> library at runtime, so <code>wayland</code> should be added to <code>buildInputs</code>.
But it also executes the <code>wayland-scanner</code> program as part of the build to generate code, so <code>wayland</code> should also be added to <code>nativeBuildInputs</code>.
:::</p>
<p>Dependencies needed only to run tests are similarly classified between native (executed during build) and non-native (executed at runtime):
- <code>nativeCheckInputs</code> for test tools needed on <code>$PATH</code> (such as <code>ctest</code>) and <a href="#ssec-setup-hooks">setup hooks</a> (for example <a href="#python"><code>pytestCheckHook</code></a>)
- <code>checkInputs</code> for libraries linked into test executables (for example the <code>qcheck</code> OCaml package)</p>
<p>These dependencies are only injected when <a href="#var-stdenv-doCheck"><code>doCheck</code></a> is set to <code>true</code>.</p>
<h4 id="ssec-stdenv-dependencies-overview-example">Example<a class="headerlink" href="#ssec-stdenv-dependencies-overview-example" title="Permanent link">#</a></h4>
<p>Consider for example this simplified derivation for <code>solo5</code>, a sandboxing tool:
<div class="language-nix highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>stdenv<span class="o">.</span>mkDerivation <span class="k">rec</span> <span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;solo5&quot;</span><span class="p">;</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>  <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;0.7.5&quot;</span><span class="p">;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>  <span class="ss">src</span> <span class="o">=</span> fetchurl <span class="p">{</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/Solo5/solo5/releases/download/v</span><span class="si">${</span>version<span class="si">}</span><span class="s2">/solo5-v</span><span class="si">${</span>version<span class="si">}</span><span class="s2">.tar.gz&quot;</span><span class="p">;</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="ss">hash</span> <span class="o">=</span> <span class="s2">&quot;sha256-viwrS9lnaU8sTGuzK/+L/PlMM/xRRtgVuK5pixVeDEw=&quot;</span><span class="p">;</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>  <span class="p">};</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>  <span class="ss">nativeBuildInputs</span> <span class="o">=</span> <span class="p">[</span> makeWrapper pkg-config <span class="p">];</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>  <span class="ss">buildInputs</span> <span class="o">=</span> <span class="p">[</span> libseccomp <span class="p">];</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>  <span class="ss">postInstall</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="s s-Multiline">    substituteInPlace $out/bin/solo5-virtio-mkimage \</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="s s-Multiline">      --replace-fail &quot;/usr/lib/syslinux&quot; &quot;</span><span class="si">${</span>syslinux<span class="si">}</span><span class="s s-Multiline">/share/syslinux&quot; \</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="s s-Multiline">      --replace-fail &quot;/usr/share/syslinux&quot; &quot;</span><span class="si">${</span>syslinux<span class="si">}</span><span class="s s-Multiline">/share/syslinux&quot; \</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="s s-Multiline">      --replace-fail &quot;cp &quot; &quot;cp --no-preserve=mode &quot;</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="s s-Multiline">    wrapProgram $out/bin/solo5-virtio-mkimage \</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="s s-Multiline">      --prefix PATH : </span><span class="si">${</span>lib<span class="o">.</span>makeBinPath <span class="p">[</span> dosfstools mtools parted syslinux <span class="p">]</span><span class="si">}</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>  <span class="ss">doCheck</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>  <span class="ss">nativeCheckInputs</span> <span class="o">=</span> <span class="p">[</span> util-linux qemu <span class="p">];</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>  <span class="ss">checkPhase</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39; [elided] &#39;&#39;</span><span class="p">;</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="p">}</span>
</span></code></pre></div></p>
<ul>
<li><code>makeWrapper</code> is a setup hook, i.e., a shell script sourced by the generic builder of <code>stdenv</code>.
  It is thus executed during the build and must be added to <code>nativeBuildInputs</code>.</li>
<li><code>pkg-config</code> is a build tool which the configure script of <code>solo5</code> expects to be on <code>$PATH</code> during the build:
  therefore, it must be added to <code>nativeBuildInputs</code>.</li>
<li><code>libseccomp</code> is a library linked into <code>$out/bin/solo5-elftool</code>.
  As it is used at runtime, it must be added to <code>buildInputs</code>.</li>
<li>Tests need <code>qemu</code> and <code>getopt</code> (from <code>util-linux</code>) on <code>$PATH</code>, these must be added to <code>nativeCheckInputs</code>.</li>
<li>Some dependencies are injected directly in the shell code of phases: <code>syslinux</code>, <code>dosfstools</code>, <code>mtools</code>, and <code>parted</code>.
In this specific case, they will end up in the output of the derivation (<code>$out</code> here).
As Nix marks dependencies whose absolute path is present in the output as runtime dependencies, adding them to <code>buildInputs</code> is not required.</li>
</ul>
<p>For more complex cases, like libraries linked into an executable which is then executed as part of the build system, see <a href="#ssec-stdenv-dependencies-reference"></a>.</p>
<h3 id="ssec-stdenv-dependencies-reference">Reference<a class="headerlink" href="#ssec-stdenv-dependencies-reference" title="Permanent link">#</a></h3>
<p>As described in the Nix manual, almost any <code>*.drv</code> store path in a derivation’s attribute set will induce a dependency on that derivation. <code>mkDerivation</code>, however, takes a few attributes intended to include all the dependencies of a package. This is done both for structure and consistency, but also so that certain other setup can take place. For example, certain dependencies need their bin directories added to the <code>PATH</code>. That is built-in, but other setup is done via a pluggable mechanism that works in conjunction with these dependency attributes. See <a href="#ssec-setup-hooks"></a> for details.</p>
<p>Dependencies can be broken down along these axes: their host and target platforms relative to the new derivation’s. The platform distinctions are motivated by cross compilation; see <a href="#chap-cross"></a> for exactly what each platform means. [^footnote-stdenv-ignored-build-platform] But even if one is not cross compiling, the platforms imply whether a dependency is needed at run-time or build-time.</p>
<p>The extension of <code>PATH</code> with dependencies, alluded to above, proceeds according to the relative platforms alone. The process is carried out only for dependencies whose host platform matches the new derivation’s build platform i.e. dependencies which run on the platform where the new derivation will be built. [^footnote-stdenv-native-dependencies-in-path] For each dependency \&lt;dep&gt; of those dependencies, <code>dep/bin</code>, if present, is added to the <code>PATH</code> environment variable.</p>
<h3 id="ssec-stdenv-dependencies-propagated">Dependency propagation<a class="headerlink" href="#ssec-stdenv-dependencies-propagated" title="Permanent link">#</a></h3>
<p>Propagated dependencies are made available to all downstream dependencies.
This is particularly useful for interpreted languages, where all transitive dependencies have to be present in the same environment.
Therefore it is used for the Python infrastructure in Nixpkgs.</p>
<p>:::{.note}
Propagated dependencies should be used with care, because they obscure the actual build inputs of dependent derivations and cause side effects through setup hooks.
This can lead to conflicting dependencies that cannot easily be resolved.
:::</p>
<p>:::{.example}</p>
<h1 id="a-propagated-dependency">A propagated dependency<a class="headerlink" href="#a-propagated-dependency" title="Permanent link">#</a></h1>
<p><div class="language-nix highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">with</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">let</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>  <span class="ss">bar</span> <span class="o">=</span> stdenv<span class="o">.</span>mkDerivation <span class="p">{</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span><span class="p">;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="ss">dontUnpack</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="c1"># `hello` is also made available to dependents, such as `foo`</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="ss">propagatedBuildInputs</span> <span class="o">=</span> <span class="p">[</span> hello <span class="p">];</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="ss">postInstall</span> <span class="o">=</span> <span class="s2">&quot;mkdir $out&quot;</span><span class="p">;</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>  <span class="p">};</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>  <span class="ss">foo</span> <span class="o">=</span> stdenv<span class="o">.</span>mkDerivation <span class="p">{</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span><span class="p">;</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>    <span class="ss">dontUnpack</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>    <span class="c1"># `bar` is a direct dependency, which implicitly includes the propagated `hello`</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>    <span class="ss">buildInputs</span> <span class="o">=</span> <span class="p">[</span> bar <span class="p">];</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>    <span class="c1"># The `hello` binary is available!</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>    <span class="ss">postInstall</span> <span class="o">=</span> <span class="s2">&quot;hello &gt; $out&quot;</span><span class="p">;</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>  <span class="p">};</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="k">in</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>foo
</span></code></pre></div>
:::</p>
<p>Dependency propagation takes cross compilation into account, meaning that dependencies that cross platform boundaries are properly adjusted.</p>
<p>To determine the exact rules for dependency propagation, we start by assigning to each dependency a couple of ternary numbers (<code>-1</code> for <code>build</code>, <code>0</code> for <code>host</code>, and <code>1</code> for <code>target</code>) representing its <a href="#possible-dependency-types">dependency type</a>, which captures how its host and target platforms are each "offset" from the depending derivation’s host and target platforms. The following table summarize the different combinations that can be obtained:</p>
<table>
<thead>
<tr>
<th><code>host → target</code></th>
<th>attribute name</th>
<th>offset</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>build --&gt; build</code></td>
<td><code>depsBuildBuild</code></td>
<td><code>-1, -1</code></td>
</tr>
<tr>
<td><code>build --&gt; host</code></td>
<td><code>nativeBuildInputs</code></td>
<td><code>-1, 0</code></td>
</tr>
<tr>
<td><code>build --&gt; target</code></td>
<td><code>depsBuildTarget</code></td>
<td><code>-1, 1</code></td>
</tr>
<tr>
<td><code>host --&gt; host</code></td>
<td><code>depsHostHost</code></td>
<td><code>0, 0</code></td>
</tr>
<tr>
<td><code>host --&gt; target</code></td>
<td><code>buildInputs</code></td>
<td><code>0, 1</code></td>
</tr>
<tr>
<td><code>target --&gt; target</code></td>
<td><code>depsTargetTarget</code></td>
<td><code>1, 1</code></td>
</tr>
</tbody>
</table>
<p>Algorithmically, we traverse propagated inputs, accumulating every propagated dependency’s propagated dependencies and adjusting them to account for the “shift in perspective” described by the current dependency’s platform offsets. This results is sort of a transitive closure of the dependency relation, with the offsets being approximately summed when two dependency links are combined. We also prune transitive dependencies whose combined offsets go out-of-bounds, which can be viewed as a filter over that transitive closure removing dependencies that are blatantly absurd.</p>
<p>We can define the process precisely with <a href="https://en.wikipedia.org/wiki/Natural_deduction">Natural Deduction</a> using the inference rules. This probably seems a bit obtuse, but so is the bash code that actually implements it! [^footnote-stdenv-find-inputs-location] They’re confusing in very different ways so… hopefully if something doesn’t make sense in one presentation, it will in the other!</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>let mapOffset(h, t, i) = i + (if i &lt;= 0 then h else t - 1)
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>propagated-dep(h0, t0, A, B)
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>propagated-dep(h1, t1, B, C)
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>h0 + h1 in {-1, 0, 1}
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>h0 + t1 in {-1, 0, 1}
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>-------------------------------------- Transitive property
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>propagated-dep(mapOffset(h0, t0, h1),
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>               mapOffset(h0, t0, t1),
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>               A, C)
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>let mapOffset(h, t, i) = i + (if i &lt;= 0 then h else t - 1)
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>dep(h0, t0, A, B)
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>propagated-dep(h1, t1, B, C)
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>h0 + h1 in {-1, 0, 1}
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>h0 + t1 in {-1, 0, -1}
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>----------------------------- Take immediate dependencies&#39; propagated dependencies
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>propagated-dep(mapOffset(h0, t0, h1),
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>               mapOffset(h0, t0, t1),
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>               A, C)
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>propagated-dep(h, t, A, B)
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>----------------------------- Propagated dependencies count as dependencies
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>dep(h, t, A, B)
</span></code></pre></div>
<p>Some explanation of this monstrosity is in order. In the common case, the target offset of a dependency is the successor to the target offset: <code>t = h + 1</code>. That means that:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>let f(h, t, i) = i + (if i &lt;= 0 then h else t - 1)
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>let f(h, h + 1, i) = i + (if i &lt;= 0 then h else (h + 1) - 1)
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>let f(h, h + 1, i) = i + (if i &lt;= 0 then h else h)
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>let f(h, h + 1, i) = i + h
</span></code></pre></div>
<p>This is where “sum-like” comes in from above: We can just sum all of the host offsets to get the host offset of the transitive dependency. The target offset is the transitive dependency is the host offset + 1, just as it was with the dependencies composed to make this transitive one; it can be ignored as it doesn’t add any new information.</p>
<p>Because of the bounds checks, the uncommon cases are <code>h = t</code> and <code>h + 2 = t</code>. In the former case, the motivation for <code>mapOffset</code> is that since its host and target platforms are the same, no transitive dependency of it should be able to “discover” an offset greater than its reduced target offsets. <code>mapOffset</code> effectively “squashes” all its transitive dependencies’ offsets so that none will ever be greater than the target offset of the original <code>h = t</code> package. In the other case, <code>h + 1</code> is skipped over between the host and target offsets. Instead of squashing the offsets, we need to “rip” them apart so no transitive dependencies’ offset is that one.</p>
<p>Overall, the unifying theme here is that propagation shouldn’t be introducing transitive dependencies involving platforms the depending package is unaware of. [One can imagine the depending package asking for dependencies with the platforms it knows about; other platforms it doesn’t know how to ask for. The platform description in that scenario is a kind of unforgeable capability.] The offset bounds checking and definition of <code>mapOffset</code> together ensure that this is the case. Discovering a new offset is discovering a new platform, and since those platforms weren’t in the derivation “spec” of the needing package, they cannot be relevant. From a capability perspective, we can imagine that the host and target platforms of a package are the capabilities a package requires, and the depending package must provide the capability to the dependency.</p>
<h4 id="variables-specifying-dependencies">Variables specifying dependencies<a class="headerlink" href="#variables-specifying-dependencies" title="Permanent link">#</a></h4>
<h5 id="var-stdenv-depsBuildBuild"><code>depsBuildBuild</code><a class="headerlink" href="#var-stdenv-depsBuildBuild" title="Permanent link">#</a></h5>
<p>A list of dependencies whose host and target platforms are the new derivation’s build platform. These are programs and libraries used at build time that produce programs and libraries also used at build time. If the dependency doesn’t care about the target platform (i.e. isn’t a compiler or similar tool), put it in <code>nativeBuildInputs</code> instead. The most common use of this <code>buildPackages.stdenv.cc</code>, the default C compiler for this role. That example crops up more than one might think in old commonly used C libraries.</p>
<p>Since these packages are able to be run at build-time, they are always added to the <code>PATH</code>, as described above. But since these packages are only guaranteed to be able to run then, they shouldn’t persist as run-time dependencies. This isn’t currently enforced, but could be in the future.</p>
<h5 id="var-stdenv-nativeBuildInputs"><code>nativeBuildInputs</code><a class="headerlink" href="#var-stdenv-nativeBuildInputs" title="Permanent link">#</a></h5>
<p>A list of dependencies whose host platform is the new derivation’s build platform, and target platform is the new derivation’s host platform. These are programs and libraries used at build-time that, if they are a compiler or similar tool, produce code to run at run-time—i.e. tools used to build the new derivation. If the dependency doesn’t care about the target platform (i.e. isn’t a compiler or similar tool), put it here, rather than in <code>depsBuildBuild</code> or <code>depsBuildTarget</code>. This could be called <code>depsBuildHost</code> but <code>nativeBuildInputs</code> is used for historical continuity.</p>
<p>Since these packages are able to be run at build-time, they are added to the <code>PATH</code>, as described above. But since these packages are only guaranteed to be able to run then, they shouldn’t persist as run-time dependencies. This isn’t currently enforced, but could be in the future.</p>
<h5 id="var-stdenv-depsBuildTarget"><code>depsBuildTarget</code><a class="headerlink" href="#var-stdenv-depsBuildTarget" title="Permanent link">#</a></h5>
<p>A list of dependencies whose host platform is the new derivation’s build platform, and target platform is the new derivation’s target platform. These are programs used at build time that produce code to run with code produced by the depending package. Most commonly, these are tools used to build the runtime or standard library that the currently-being-built compiler will inject into any code it compiles. In many cases, the currently-being-built-compiler is itself employed for that task, but when that compiler won’t run (i.e. its build and host platform differ) this is not possible. Other times, the compiler relies on some other tool, like binutils, that is always built separately so that the dependency is unconditional.</p>
<p>This is a somewhat confusing concept to wrap one’s head around, and for good reason. As the only dependency type where the platform offsets, <code>-1</code> and <code>1</code>, are not adjacent integers, it requires thinking of a bootstrapping stage <em>two</em> away from the current one. It and its use-case go hand in hand and are both considered poor form: try to not need this sort of dependency, and try to avoid building standard libraries and runtimes in the same derivation as the compiler produces code using them. Instead strive to build those like a normal library, using the newly-built compiler just as a normal library would. In short, do not use this attribute unless you are packaging a compiler and are sure it is needed.</p>
<p>Since these packages are able to run at build time, they are added to the <code>PATH</code>, as described above. But since these packages are only guaranteed to be able to run then, they shouldn’t persist as run-time dependencies. This isn’t currently enforced, but could be in the future.</p>
<h5 id="var-stdenv-depsHostHost"><code>depsHostHost</code><a class="headerlink" href="#var-stdenv-depsHostHost" title="Permanent link">#</a></h5>
<p>A list of dependencies whose host and target platforms match the new derivation’s host platform. In practice, this would usually be tools used by compilers for macros or a metaprogramming system, or libraries used by the macros or metaprogramming code itself. It’s always preferable to use a <code>depsBuildBuild</code> dependency in the derivation being built over a <code>depsHostHost</code> on the tool doing the building for this purpose.</p>
<h5 id="var-stdenv-buildInputs"><code>buildInputs</code><a class="headerlink" href="#var-stdenv-buildInputs" title="Permanent link">#</a></h5>
<p>A list of dependencies whose host platform and target platform match the new derivation’s. This would be called <code>depsHostTarget</code> but for historical continuity. If the dependency doesn’t care about the target platform (i.e. isn’t a compiler or similar tool), put it here, rather than in <code>depsBuildBuild</code>.</p>
<p>These are often programs and libraries used by the new derivation at <em>run</em>-time, but that isn’t always the case. For example, the machine code in a statically-linked library is only used at run-time, but the derivation containing the library is only needed at build-time. Even in the dynamic case, the library may also be needed at build-time to appease the linker.</p>
<h5 id="var-stdenv-depsTargetTarget"><code>depsTargetTarget</code><a class="headerlink" href="#var-stdenv-depsTargetTarget" title="Permanent link">#</a></h5>
<p>A list of dependencies whose host platform matches the new derivation’s target platform. These are packages that run on the target platform, e.g. the standard library or run-time deps of standard library that a compiler insists on knowing about. It’s poor form in almost all cases for a package to depend on another from a future stage [future stage corresponding to positive offset]. Do not use this attribute unless you are packaging a compiler and are sure it is needed.</p>
<h5 id="var-stdenv-depsBuildBuildPropagated"><code>depsBuildBuildPropagated</code><a class="headerlink" href="#var-stdenv-depsBuildBuildPropagated" title="Permanent link">#</a></h5>
<p>The propagated equivalent of <code>depsBuildBuild</code>. This perhaps never ought to be used, but it is included for consistency [see below for the others].</p>
<h5 id="var-stdenv-propagatedNativeBuildInputs"><code>propagatedNativeBuildInputs</code><a class="headerlink" href="#var-stdenv-propagatedNativeBuildInputs" title="Permanent link">#</a></h5>
<p>The propagated equivalent of <code>nativeBuildInputs</code>. This would be called <code>depsBuildHostPropagated</code> but for historical continuity. For example, if package <code>Y</code> has <code>propagatedNativeBuildInputs = [X]</code>, and package <code>Z</code> has <code>buildInputs = [Y]</code>, then package <code>Z</code> will be built as if it included package <code>X</code> in its <code>nativeBuildInputs</code>. If instead, package <code>Z</code> has <code>nativeBuildInputs = [Y]</code>, then <code>Z</code> will be built as if it included <code>X</code> in the <code>depsBuildBuild</code> of package <code>Z</code>, because of the sum of the two <code>-1</code> host offsets.</p>
<h5 id="var-stdenv-depsBuildTargetPropagated"><code>depsBuildTargetPropagated</code><a class="headerlink" href="#var-stdenv-depsBuildTargetPropagated" title="Permanent link">#</a></h5>
<p>The propagated equivalent of <code>depsBuildTarget</code>. This is prefixed for the same reason of alerting potential users.</p>
<h5 id="var-stdenv-depsHostHostPropagated"><code>depsHostHostPropagated</code><a class="headerlink" href="#var-stdenv-depsHostHostPropagated" title="Permanent link">#</a></h5>
<p>The propagated equivalent of <code>depsHostHost</code>.</p>
<h5 id="var-stdenv-propagatedBuildInputs"><code>propagatedBuildInputs</code><a class="headerlink" href="#var-stdenv-propagatedBuildInputs" title="Permanent link">#</a></h5>
<p>The propagated equivalent of <code>buildInputs</code>. This would be called <code>depsHostTargetPropagated</code> but for historical continuity.</p>
<h5 id="var-stdenv-depsTargetTargetPropagated"><code>depsTargetTargetPropagated</code><a class="headerlink" href="#var-stdenv-depsTargetTargetPropagated" title="Permanent link">#</a></h5>
<p>The propagated equivalent of <code>depsTargetTarget</code>. This is prefixed for the same reason of alerting potential users.</p>
<h2 id="ssec-stdenv-attributes">Attributes<a class="headerlink" href="#ssec-stdenv-attributes" title="Permanent link">#</a></h2>
<h3 id="variables-affecting-stdenv-initialisation">Variables affecting <code>stdenv</code> initialisation<a class="headerlink" href="#variables-affecting-stdenv-initialisation" title="Permanent link">#</a></h3>
<h4 id="var-stdenv-NIX_DEBUG"><code>NIX_DEBUG</code><a class="headerlink" href="#var-stdenv-NIX_DEBUG" title="Permanent link">#</a></h4>
<p>A number between 0 and 7 indicating how much information to log. If set to 1 or higher, <code>stdenv</code> will print moderate debugging information during the build. In particular, the <code>gcc</code> and <code>ld</code> wrapper scripts will print out the complete command line passed to the wrapped tools. If set to 6 or higher, the <code>stdenv</code> setup script will be run with <code>set -x</code> tracing. If set to 7 or higher, the <code>gcc</code> and <code>ld</code> wrapper scripts will also be run with <code>set -x</code> tracing.</p>
<h3 id="attributes-affecting-build-properties">Attributes affecting build properties<a class="headerlink" href="#attributes-affecting-build-properties" title="Permanent link">#</a></h3>
<h4 id="var-stdenv-enableParallelBuilding"><code>enableParallelBuilding</code><a class="headerlink" href="#var-stdenv-enableParallelBuilding" title="Permanent link">#</a></h4>
<p>If set to <code>true</code>, <code>stdenv</code> will pass specific flags to <code>make</code> and other build tools to enable parallel building with up to <code>build-cores</code> workers.</p>
<p>Unless set to <code>false</code>, some build systems with good support for parallel building including <code>cmake</code>, <code>meson</code>, and <code>qmake</code> will set it to <code>true</code>.</p>
<h3 id="special-variables">Special variables<a class="headerlink" href="#special-variables" title="Permanent link">#</a></h3>
<h4 id="var-stdenv-passthru"><code>passthru</code><a class="headerlink" href="#var-stdenv-passthru" title="Permanent link">#</a></h4>
<p>This is an attribute set which can be filled with arbitrary values. For example:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="ss">passthru</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>  <span class="ss">foo</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span><span class="p">;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>  <span class="ss">baz</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="ss">value1</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    <span class="ss">value2</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>  <span class="p">};</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>Values inside it are not passed to the builder, so you can change them without triggering a rebuild. However, they can be accessed outside of a derivation directly, as if they were set inside a derivation itself, e.g. <code>hello.baz.value1</code>. We don’t specify any usage or schema of <code>passthru</code> - it is meant for values that would be useful outside the derivation in other parts of a Nix expression (e.g. in other derivations). An example would be to convey some specific dependency of your derivation which contains a program with plugins support. Later, others who make derivations with plugins can use passed-through dependency to ensure that their plugin would be binary-compatible with built program.</p>
<h4 id="var-passthru-updateScript"><code>passthru.updateScript</code><a class="headerlink" href="#var-passthru-updateScript" title="Permanent link">#</a></h4>
<p>A script to be run by <code>maintainers/scripts/update.nix</code> when the package is matched. The attribute can contain one of the following:</p>
<ul>
<li>[]{#var-passthru-updateScript-command} an executable file, either on the file system:</li>
</ul>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>passthru<span class="o">.</span><span class="ss">updateScript</span> <span class="o">=</span> <span class="l">./update.sh</span><span class="p">;</span>
</span></code></pre></div>
<p>or inside the expression itself:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>passthru<span class="o">.</span><span class="ss">updateScript</span> <span class="o">=</span> writeScript <span class="s2">&quot;update-zoom-us&quot;</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="s s-Multiline">  #!/usr/bin/env nix-shell</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="s s-Multiline">  #!nix-shell -i bash -p curl pcre2 common-updater-scripts</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="s s-Multiline">  set -eu -o pipefail</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="s s-Multiline">  version=&quot;$(curl -sI https://zoom.us/client/latest/zoom_x86_64.tar.xz | grep -Fi &#39;Location:&#39; | pcre2grep -o1 &#39;/(([0-9]\.?)+)/&#39;)&quot;</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="s s-Multiline">  update-source-version zoom-us &quot;$version&quot;</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="s s-Multiline">&#39;&#39;</span><span class="p">;</span>
</span></code></pre></div>
<ul>
<li>a list, a script followed by arguments to be passed to it:</li>
</ul>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>passthru<span class="o">.</span><span class="ss">updateScript</span> <span class="o">=</span> <span class="p">[</span> <span class="l">../../update.sh</span> pname <span class="s2">&quot;--requested-release=unstable&quot;</span> <span class="p">];</span>
</span></code></pre></div>
<ul>
<li>an attribute set containing:</li>
<li>[<code>command</code>]{#var-passthru-updateScript-set-command} – a string or list in the <a href="#var-passthru-updateScript-command">format expected by <code>passthru.updateScript</code></a>.</li>
<li>[<code>attrPath</code>]{#var-passthru-updateScript-set-attrPath} (optional) – a string containing the canonical attribute path for the package. If present, it will be passed to the update script instead of the attribute path on which the package was discovered during Nixpkgs traversal.</li>
<li>[<code>supportedFeatures</code>]{#var-passthru-updateScript-set-supportedFeatures} (optional) – a list of the <a href="#var-passthru-updateScript-supported-features">extra features</a> the script supports.</li>
</ul>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>passthru<span class="o">.</span><span class="ss">updateScript</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>  <span class="ss">command</span> <span class="o">=</span> <span class="p">[</span> <span class="l">../../update.sh</span> pname <span class="p">];</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>  <span class="ss">attrPath</span> <span class="o">=</span> pname<span class="p">;</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>  <span class="ss">supportedFeatures</span> <span class="o">=</span> <span class="p">[</span> <span class="err">…</span> <span class="p">];</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="p">};</span>
</span></code></pre></div>
<p>::: {.tip}
A common pattern is to use the <a href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/common-updater/nix-update.nix"><code>nix-update-script</code></a> attribute provided in Nixpkgs, which runs <a href="https://github.com/Mic92/nix-update"><code>nix-update</code></a>:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>passthru<span class="o">.</span><span class="ss">updateScript</span> <span class="o">=</span> nix-update-script <span class="p">{</span> <span class="p">};</span>
</span></code></pre></div>
<p>For simple packages, this is often enough, and will ensure that the package is updated automatically by <a href="https://ryantm.github.io/nixpkgs-update"><code>nixpkgs-update</code></a> when a new version is released. The <a href="https://nix-community.org/update-bot">update bot</a> runs periodically to attempt to automatically update packages, and will run <code>passthru.updateScript</code> if set. While not strictly necessary if the project is listed on <a href="https://repology.org">Repology</a>, using <code>nix-update-script</code> allows the package to update via many more sources (e.g. GitHub releases).
:::</p>
<h5 id="var-passthru-updateScript-execution">How update scripts are executed?<a class="headerlink" href="#var-passthru-updateScript-execution" title="Permanent link">#</a></h5>
<p>Update scripts are to be invoked by <code>maintainers/scripts/update.nix</code> script. You can run <code>nix-shell maintainers/scripts/update.nix</code> in the root of Nixpkgs repository for information on how to use it. <code>update.nix</code> offers several modes for selecting packages to update (e.g. select by attribute path, traverse Nixpkgs and filter by maintainer, etc.), and it will execute update scripts for all matched packages that have an <code>updateScript</code> attribute.</p>
<p>Each update script will be passed the following environment variables:</p>
<ul>
<li>[<code>UPDATE_NIX_NAME</code>]{#var-passthru-updateScript-env-UPDATE_NIX_NAME} – content of the <code>name</code> attribute of the updated package.</li>
<li>[<code>UPDATE_NIX_PNAME</code>]{#var-passthru-updateScript-env-UPDATE_NIX_PNAME} – content of the <code>pname</code> attribute of the updated package.</li>
<li>[<code>UPDATE_NIX_OLD_VERSION</code>]{#var-passthru-updateScript-env-UPDATE_NIX_OLD_VERSION} – content of the <code>version</code> attribute of the updated package.</li>
<li>[<code>UPDATE_NIX_ATTR_PATH</code>]{#var-passthru-updateScript-env-UPDATE_NIX_ATTR_PATH} – attribute path the <code>update.nix</code> discovered the package on (or the <a href="#var-passthru-updateScript-set-attrPath">canonical <code>attrPath</code></a> when available). Example: <code>pantheon.elementary-terminal</code></li>
</ul>
<p>::: {.note}
An update script will be usually run from the root of the Nixpkgs repository but you should not rely on that. Also note that <code>update.nix</code> executes update scripts in parallel by default so you should avoid running <code>git commit</code> or any other commands that cannot handle that.
:::</p>
<p>::: {.tip}
While update scripts should not create commits themselves, <code>maintainers/scripts/update.nix</code> supports automatically creating commits when running it with <code>--argstr commit true</code>. If you need to customize commit message, you can have the update script implement <a href="#var-passthru-updateScript-commit"><code>commit</code></a> feature.
:::</p>
<h5 id="var-passthru-updateScript-supported-features">Supported features<a class="headerlink" href="#var-passthru-updateScript-supported-features" title="Permanent link">#</a></h5>
<h6 id="var-passthru-updateScript-commit"><code>commit</code><a class="headerlink" href="#var-passthru-updateScript-commit" title="Permanent link">#</a></h6>
<p>This feature allows update scripts to <em>ask</em> <code>update.nix</code> to create Git commits.</p>
<p>When support of this feature is declared, whenever the update script exits with <code>0</code> return status, it is expected to print a JSON list containing an object described below for each updated attribute to standard output.</p>
<p>When <code>update.nix</code> is run with <code>--argstr commit true</code> arguments, it will create a separate commit for each of the objects. An empty list can be returned when the script did not update any files, for example, when the package is already at the latest version.</p>
<p>The commit object contains the following values:</p>
<ul>
<li>[<code>attrPath</code>]{#var-passthru-updateScript-commit-attrPath} – a string containing attribute path.</li>
<li>[<code>oldVersion</code>]{#var-passthru-updateScript-commit-oldVersion} – a string containing old version.</li>
<li>[<code>newVersion</code>]{#var-passthru-updateScript-commit-newVersion} – a string containing new version.</li>
<li>[<code>files</code>]{#var-passthru-updateScript-commit-files} – a non-empty list of file paths (as strings) to add to the commit.</li>
<li>[<code>commitBody</code>]{#var-passthru-updateScript-commit-commitBody} (optional) – a string with extra content to be appended to the default commit message (useful for adding changelog links).</li>
<li>[<code>commitMessage</code>]{#var-passthru-updateScript-commit-commitMessage} (optional) – a string to use instead of the default commit message.</li>
</ul>
<p>If the returned array contains exactly one object (e.g. <code>[{}]</code>), all values are optional and will be determined automatically.</p>
<p>::: {.example #var-passthru-updateScript-example-commit}</p>
<h1 id="standard-output-of-an-update-script-using-commit-feature">Standard output of an update script using commit feature<a class="headerlink" href="#standard-output-of-an-update-script-using-commit-feature" title="Permanent link">#</a></h1>
<p><div class="language-json highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="p">[</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="nt">&quot;attrPath&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;volume_key&quot;</span><span class="p">,</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="nt">&quot;oldVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.3.11&quot;</span><span class="p">,</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">    </span><span class="nt">&quot;newVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.3.12&quot;</span><span class="p">,</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">    </span><span class="nt">&quot;files&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">      </span><span class="s2">&quot;/path/to/nixpkgs/pkgs/development/libraries/volume-key/default.nix&quot;</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="p">]</span>
</span></code></pre></div>
:::</p>
<h3 id="mkderivation-recursive-attributes">Fixed-point arguments of <code>mkDerivation</code><a class="headerlink" href="#mkderivation-recursive-attributes" title="Permanent link">#</a></h3>
<p>If you pass a function to <code>mkDerivation</code>, it will receive as its argument the final arguments, including the overrides when reinvoked via <code>overrideAttrs</code>. For example:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>mkDerivation <span class="p">(</span>finalAttrs<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>  <span class="ss">pname</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>  <span class="ss">withFeature</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>  <span class="ss">configureFlags</span> <span class="o">=</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    lib<span class="o">.</span>optionals finalAttrs<span class="o">.</span>withFeature <span class="p">[</span><span class="s2">&quot;--with-feature&quot;</span><span class="p">];</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="p">})</span>
</span></code></pre></div>
<p>Note that this does not use the <code>rec</code> keyword to reuse <code>withFeature</code> in <code>configureFlags</code>.
The <code>rec</code> keyword works at the syntax level and is unaware of overriding.</p>
<p>Instead, the definition references <code>finalAttrs</code>, allowing users to change <code>withFeature</code>
consistently with <code>overrideAttrs</code>.</p>
<p><code>finalAttrs</code> also contains the attribute <code>finalPackage</code>, which includes the output paths, etc.</p>
<p>Let's look at a more elaborate example to understand the differences between
various bindings:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># `pkg` is the _original_ definition (for illustration purposes)</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">let</span> <span class="ss">pkg</span> <span class="o">=</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>  mkDerivation <span class="p">(</span>finalAttrs<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    <span class="c1"># ...</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    <span class="c1"># An example attribute</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>    <span class="ss">packages</span> <span class="o">=</span> <span class="p">[];</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>    <span class="c1"># `passthru.tests` is a commonly defined attribute.</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>    passthru<span class="o">.</span>tests<span class="o">.</span><span class="ss">simple</span> <span class="o">=</span> f finalAttrs<span class="o">.</span>finalPackage<span class="p">;</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>    <span class="c1"># An example of an attribute containing a function</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>    passthru<span class="o">.</span><span class="ss">appendPackages</span> <span class="o">=</span> packages&#39;<span class="p">:</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>      finalAttrs<span class="o">.</span>finalPackage<span class="o">.</span>overrideAttrs <span class="p">(</span>newSelf<span class="p">:</span> super<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>        <span class="ss">packages</span> <span class="o">=</span> super<span class="o">.</span>packages <span class="o">++</span> packages&#39;<span class="p">;</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>      <span class="p">});</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>    <span class="c1"># For illustration purposes; referenced as</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>    <span class="c1"># `(pkg.overrideAttrs(x)).finalAttrs` etc in the text below.</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>    passthru<span class="o">.</span><span class="ss">finalAttrs</span> <span class="o">=</span> finalAttrs<span class="p">;</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>    passthru<span class="o">.</span><span class="ss">original</span> <span class="o">=</span> pkg<span class="p">;</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>  <span class="p">});</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="k">in</span> pkg
</span></code></pre></div>
<p>Unlike the <code>pkg</code> binding in the above example, the <code>finalAttrs</code> parameter always references the final attributes. For instance <code>(pkg.overrideAttrs(x)).finalAttrs.finalPackage</code> is identical to <code>pkg.overrideAttrs(x)</code>, whereas <code>(pkg.overrideAttrs(x)).original</code> is the same as the original <code>pkg</code>.</p>
<p>See also the section about <a href="#var-meta-tests"><code>passthru.tests</code></a>.</p>
<h2 id="sec-stdenv-phases">Phases<a class="headerlink" href="#sec-stdenv-phases" title="Permanent link">#</a></h2>
<p><code>stdenv.mkDerivation</code> sets the Nix <a href="https://nixos.org/manual/nix/stable/expressions/derivations.html#derivations">derivation</a>'s builder to a script that loads the stdenv <code>setup.sh</code> bash library and calls <code>genericBuild</code>. Most packaging functions rely on this default builder.</p>
<p>This generic command either invokes a script at <em>buildCommandPath</em>, or a <em>buildCommand</em>, or a number of <em>phases</em>. Package builds are split into phases to make it easier to override specific parts of the build (e.g., unpacking the sources or installing the binaries).</p>
<p>Each phase can be overridden in its entirety either by setting the environment variable <code>namePhase</code> to a string containing some shell commands to be executed, or by redefining the shell function <code>namePhase</code>. The former is convenient to override a phase from the derivation, while the latter is convenient from a build script. However, typically one only wants to <em>add</em> some commands to a phase, e.g. by defining <code>postInstall</code> or <code>preFixup</code>, as skipping some of the default actions may have unexpected consequences. The default script for each phase is defined in the file <code>pkgs/stdenv/generic/setup.sh</code>.</p>
<p>When overriding a phase, for example <code>installPhase</code>, it is important to start with <code>runHook preInstall</code> and end it with <code>runHook postInstall</code>, otherwise <code>preInstall</code> and <code>postInstall</code> will not be run. Even if you don't use them directly, it is good practice to do so anyways for downstream users who would want to add a <code>postInstall</code> by overriding your derivation.</p>
<p>While inside an interactive <code>nix-shell</code>, if you wanted to run all phases in the order they would be run in an actual build, you can invoke <code>genericBuild</code> yourself.</p>
<h3 id="ssec-controlling-phases">Controlling phases<a class="headerlink" href="#ssec-controlling-phases" title="Permanent link">#</a></h3>
<p>There are a number of variables that control what phases are executed and in what order:</p>
<h4 id="variables-affecting-phase-control">Variables affecting phase control<a class="headerlink" href="#variables-affecting-phase-control" title="Permanent link">#</a></h4>
<h5 id="var-stdenv-phases"><code>phases</code><a class="headerlink" href="#var-stdenv-phases" title="Permanent link">#</a></h5>
<p>Specifies the phases. You can change the order in which phases are executed, or add new phases, by setting this variable. If it’s not set, the default value is used, which is <code>$prePhases unpackPhase patchPhase $preConfigurePhases configurePhase $preBuildPhases buildPhase checkPhase $preInstallPhases installPhase fixupPhase installCheckPhase $preDistPhases distPhase $postPhases</code>.</p>
<p>It is discouraged to set this variable, as it is easy to miss some important functionality hidden in some of the less obviously needed phases (like <code>fixupPhase</code> which patches the shebang of scripts).
Usually, if you just want to add a few phases, it’s more convenient to set one of the variables below (such as <code>preInstallPhases</code>).</p>
<h5 id="var-stdenv-prePhases"><code>prePhases</code><a class="headerlink" href="#var-stdenv-prePhases" title="Permanent link">#</a></h5>
<p>Additional phases executed before any of the default phases.</p>
<h5 id="var-stdenv-preConfigurePhases"><code>preConfigurePhases</code><a class="headerlink" href="#var-stdenv-preConfigurePhases" title="Permanent link">#</a></h5>
<p>Additional phases executed just before the configure phase.</p>
<h5 id="var-stdenv-preBuildPhases"><code>preBuildPhases</code><a class="headerlink" href="#var-stdenv-preBuildPhases" title="Permanent link">#</a></h5>
<p>Additional phases executed just before the build phase.</p>
<h5 id="var-stdenv-preInstallPhases"><code>preInstallPhases</code><a class="headerlink" href="#var-stdenv-preInstallPhases" title="Permanent link">#</a></h5>
<p>Additional phases executed just before the install phase.</p>
<h5 id="var-stdenv-preFixupPhases"><code>preFixupPhases</code><a class="headerlink" href="#var-stdenv-preFixupPhases" title="Permanent link">#</a></h5>
<p>Additional phases executed just before the fixup phase.</p>
<h5 id="var-stdenv-preDistPhases"><code>preDistPhases</code><a class="headerlink" href="#var-stdenv-preDistPhases" title="Permanent link">#</a></h5>
<p>Additional phases executed just before the distribution phase.</p>
<h5 id="var-stdenv-postPhases"><code>postPhases</code><a class="headerlink" href="#var-stdenv-postPhases" title="Permanent link">#</a></h5>
<p>Additional phases executed after any of the default phases.</p>
<h3 id="ssec-unpack-phase">The unpack phase<a class="headerlink" href="#ssec-unpack-phase" title="Permanent link">#</a></h3>
<p>The unpack phase is responsible for unpacking the source code of the package. The default implementation of <code>unpackPhase</code> unpacks the source files listed in the <code>src</code> environment variable to the current directory. It supports the following files by default:</p>
<h4 id="tar-files">Tar files<a class="headerlink" href="#tar-files" title="Permanent link">#</a></h4>
<p>These can optionally be compressed using <code>gzip</code> (<code>.tar.gz</code>, <code>.tgz</code> or <code>.tar.Z</code>), <code>bzip2</code> (<code>.tar.bz2</code>, <code>.tbz2</code> or <code>.tbz</code>) or <code>xz</code> (<code>.tar.xz</code>, <code>.tar.lzma</code> or <code>.txz</code>).</p>
<h4 id="zip-files">Zip files<a class="headerlink" href="#zip-files" title="Permanent link">#</a></h4>
<p>Zip files are unpacked using <code>unzip</code>. However, <code>unzip</code> is not in the standard environment, so you should add it to <code>nativeBuildInputs</code> yourself.</p>
<h4 id="directories-in-the-nix-store">Directories in the Nix store<a class="headerlink" href="#directories-in-the-nix-store" title="Permanent link">#</a></h4>
<p>These are copied to the current directory. The hash part of the file name is stripped, e.g. <code>/nix/store/1wydxgby13cz...-my-sources</code> would be copied to <code>my-sources</code>.</p>
<p>Additional file types can be supported by setting the <code>unpackCmd</code> variable (see below).</p>
<h4 id="variables-controlling-the-unpack-phase">Variables controlling the unpack phase<a class="headerlink" href="#variables-controlling-the-unpack-phase" title="Permanent link">#</a></h4>
<h5 id="var-stdenv-src"><code>srcs</code> / <code>src</code><a class="headerlink" href="#var-stdenv-src" title="Permanent link">#</a></h5>
<p>The list of source files or directories to be unpacked or copied. One of these must be set. Note that if you use <code>srcs</code>, you should also set <code>sourceRoot</code> or <code>setSourceRoot</code>.</p>
<h5 id="var-stdenv-sourceRoot"><code>sourceRoot</code><a class="headerlink" href="#var-stdenv-sourceRoot" title="Permanent link">#</a></h5>
<p>After unpacking all of <code>src</code> and <code>srcs</code>, if neither of <code>sourceRoot</code> and <code>setSourceRoot</code> are set, <code>unpackPhase</code> of the generic builder checks that the unpacking produced a single directory and moves the current working directory into it.</p>
<p>If <code>unpackPhase</code> produces multiple source directories, you should set <code>sourceRoot</code> to the name of the intended directory.
You can also set <code>sourceRoot = ".";</code> if you want to control it yourself in a later phase.</p>
<p>For example, if your want your build to start in a sub-directory inside your sources, and you are using <code>fetchzip</code>-derived <code>src</code> (like <code>fetchFromGitHub</code> or similar), you need to set <code>sourceRoot = "${src.name}/my-sub-directory"</code>.</p>
<h5 id="var-stdenv-setSourceRoot"><code>setSourceRoot</code><a class="headerlink" href="#var-stdenv-setSourceRoot" title="Permanent link">#</a></h5>
<p>Alternatively to setting <code>sourceRoot</code>, you can set <code>setSourceRoot</code> to a shell command to be evaluated by the unpack phase after the sources have been unpacked. This command must set <code>sourceRoot</code>.</p>
<p>For example, if you are using <code>fetchurl</code> on an archive file that gets unpacked into a single directory the name of which changes between package versions, and you want your build to start in its sub-directory, you need to set <code>setSourceRoot = "sourceRoot=$(echo */my-sub-directory)";</code>, or in the case of multiple sources, you could use something more specific, like <code>setSourceRoot = "sourceRoot=$(echo ${pname}-*/my-sub-directory)";</code>.</p>
<h5 id="var-stdenv-preUnpack"><code>preUnpack</code><a class="headerlink" href="#var-stdenv-preUnpack" title="Permanent link">#</a></h5>
<p>Hook executed at the start of the unpack phase.</p>
<h5 id="var-stdenv-postUnpack"><code>postUnpack</code><a class="headerlink" href="#var-stdenv-postUnpack" title="Permanent link">#</a></h5>
<p>Hook executed at the end of the unpack phase.</p>
<h5 id="var-stdenv-dontUnpack"><code>dontUnpack</code><a class="headerlink" href="#var-stdenv-dontUnpack" title="Permanent link">#</a></h5>
<p>Set to true to skip the unpack phase.</p>
<h5 id="var-stdenv-dontMakeSourcesWritable"><code>dontMakeSourcesWritable</code><a class="headerlink" href="#var-stdenv-dontMakeSourcesWritable" title="Permanent link">#</a></h5>
<p>If set to <code>1</code>, the unpacked sources are <em>not</em> made writable. By default, they are made writable to prevent problems with read-only sources. For example, copied store directories would be read-only without this.</p>
<h5 id="var-stdenv-unpackCmd"><code>unpackCmd</code><a class="headerlink" href="#var-stdenv-unpackCmd" title="Permanent link">#</a></h5>
<p>The unpack phase evaluates the string <code>$unpackCmd</code> for any unrecognised file. The path to the current source file is contained in the <code>curSrc</code> variable.</p>
<h3 id="ssec-patch-phase">The patch phase<a class="headerlink" href="#ssec-patch-phase" title="Permanent link">#</a></h3>
<p>The patch phase applies the list of patches defined in the <code>patches</code> variable.</p>
<h4 id="variables-controlling-the-patch-phase">Variables controlling the patch phase<a class="headerlink" href="#variables-controlling-the-patch-phase" title="Permanent link">#</a></h4>
<h5 id="var-stdenv-dontPatch"><code>dontPatch</code><a class="headerlink" href="#var-stdenv-dontPatch" title="Permanent link">#</a></h5>
<p>Set to true to skip the patch phase.</p>
<h5 id="var-stdenv-patches"><code>patches</code><a class="headerlink" href="#var-stdenv-patches" title="Permanent link">#</a></h5>
<p>The list of patches. They must be in the format accepted by the <code>patch</code> command, and may optionally be compressed using <code>gzip</code> (<code>.gz</code>), <code>bzip2</code> (<code>.bz2</code>) or <code>xz</code> (<code>.xz</code>).</p>
<h5 id="var-stdenv-patchFlags"><code>patchFlags</code><a class="headerlink" href="#var-stdenv-patchFlags" title="Permanent link">#</a></h5>
<p>Flags to be passed to <code>patch</code>. If not set, the argument <code>-p1</code> is used, which causes the leading directory component to be stripped from the file names in each patch.</p>
<h5 id="var-stdenv-prePatch"><code>prePatch</code><a class="headerlink" href="#var-stdenv-prePatch" title="Permanent link">#</a></h5>
<p>Hook executed at the start of the patch phase.</p>
<h5 id="var-stdenv-postPatch"><code>postPatch</code><a class="headerlink" href="#var-stdenv-postPatch" title="Permanent link">#</a></h5>
<p>Hook executed at the end of the patch phase.</p>
<h3 id="ssec-configure-phase">The configure phase<a class="headerlink" href="#ssec-configure-phase" title="Permanent link">#</a></h3>
<p>The configure phase prepares the source tree for building. The default <code>configurePhase</code> runs <code>./configure</code> (typically an Autoconf-generated script) if it exists.</p>
<h4 id="variables-controlling-the-configure-phase">Variables controlling the configure phase<a class="headerlink" href="#variables-controlling-the-configure-phase" title="Permanent link">#</a></h4>
<h5 id="var-stdenv-configureScript"><code>configureScript</code><a class="headerlink" href="#var-stdenv-configureScript" title="Permanent link">#</a></h5>
<p>The name of the configure script. It defaults to <code>./configure</code> if it exists; otherwise, the configure phase is skipped. This can actually be a command (like <code>perl ./Configure.pl</code>).</p>
<h5 id="var-stdenv-configureFlags"><code>configureFlags</code><a class="headerlink" href="#var-stdenv-configureFlags" title="Permanent link">#</a></h5>
<p>A list of strings passed as additional arguments to the configure script.</p>
<h5 id="var-stdenv-dontConfigure"><code>dontConfigure</code><a class="headerlink" href="#var-stdenv-dontConfigure" title="Permanent link">#</a></h5>
<p>Set to true to skip the configure phase.</p>
<h5 id="var-stdenv-configureFlagsArray"><code>configureFlagsArray</code><a class="headerlink" href="#var-stdenv-configureFlagsArray" title="Permanent link">#</a></h5>
<p>A shell array containing additional arguments passed to the configure script. You must use this instead of <code>configureFlags</code> if the arguments contain spaces.</p>
<h5 id="var-stdenv-dontAddPrefix"><code>dontAddPrefix</code><a class="headerlink" href="#var-stdenv-dontAddPrefix" title="Permanent link">#</a></h5>
<p>By default, the flag <code>--prefix=$prefix</code> is added to the configure flags. If this is undesirable, set this variable to true.</p>
<h5 id="var-stdenv-prefix"><code>prefix</code><a class="headerlink" href="#var-stdenv-prefix" title="Permanent link">#</a></h5>
<p>The prefix under which the package must be installed, passed via the <code>--prefix</code> option to the configure script. It defaults to <code>$out</code>.</p>
<h5 id="var-stdenv-prefixKey"><code>prefixKey</code><a class="headerlink" href="#var-stdenv-prefixKey" title="Permanent link">#</a></h5>
<p>The key to use when specifying the prefix. By default, this is set to <code>--prefix=</code> as that is used by the majority of packages.</p>
<h5 id="var-stdenv-dontAddStaticConfigureFlags"><code>dontAddStaticConfigureFlags</code><a class="headerlink" href="#var-stdenv-dontAddStaticConfigureFlags" title="Permanent link">#</a></h5>
<p>By default, when building statically, stdenv will try to add build system appropriate configure flags to try to enable static builds.</p>
<p>If this is undesirable, set this variable to true.</p>
<h5 id="var-stdenv-dontAddDisableDepTrack"><code>dontAddDisableDepTrack</code><a class="headerlink" href="#var-stdenv-dontAddDisableDepTrack" title="Permanent link">#</a></h5>
<p>By default, the flag <code>--disable-dependency-tracking</code> is added to the configure flags to speed up Automake-based builds. If this is undesirable, set this variable to true.</p>
<h5 id="var-stdenv-dontFixLibtool"><code>dontFixLibtool</code><a class="headerlink" href="#var-stdenv-dontFixLibtool" title="Permanent link">#</a></h5>
<p>By default, the configure phase applies some special hackery to all files called <code>ltmain.sh</code> before running the configure script in order to improve the purity of Libtool-based packages [^footnote-stdenv-sys-lib-search-path] . If this is undesirable, set this variable to true.</p>
<h5 id="var-stdenv-dontDisableStatic"><code>dontDisableStatic</code><a class="headerlink" href="#var-stdenv-dontDisableStatic" title="Permanent link">#</a></h5>
<p>By default, when the configure script has <code>--enable-static</code>, the option <code>--disable-static</code> is added to the configure flags.</p>
<p>If this is undesirable, set this variable to true.  It is automatically set to true when building statically, for example through <code>pkgsStatic</code>.</p>
<h5 id="var-stdenv-configurePlatforms"><code>configurePlatforms</code><a class="headerlink" href="#var-stdenv-configurePlatforms" title="Permanent link">#</a></h5>
<p>By default, when cross compiling, the configure script has <code>--build=...</code> and <code>--host=...</code> passed. Packages can instead pass <code>[ "build" "host" "target" ]</code> or a subset to control exactly which platform flags are passed. Compilers and other tools can use this to also pass the target platform. [^footnote-stdenv-build-time-guessing-impurity]</p>
<h5 id="var-stdenv-preConfigure"><code>preConfigure</code><a class="headerlink" href="#var-stdenv-preConfigure" title="Permanent link">#</a></h5>
<p>Hook executed at the start of the configure phase.</p>
<h5 id="var-stdenv-postConfigure"><code>postConfigure</code><a class="headerlink" href="#var-stdenv-postConfigure" title="Permanent link">#</a></h5>
<p>Hook executed at the end of the configure phase.</p>
<h3 id="build-phase">The build phase<a class="headerlink" href="#build-phase" title="Permanent link">#</a></h3>
<p>The build phase is responsible for actually building the package (e.g. compiling it). The default <code>buildPhase</code> calls <code>make</code> if a file named <code>Makefile</code>, <code>makefile</code> or <code>GNUmakefile</code> exists in the current directory (or the <code>makefile</code> is explicitly set); otherwise it does nothing.</p>
<h4 id="variables-controlling-the-build-phase">Variables controlling the build phase<a class="headerlink" href="#variables-controlling-the-build-phase" title="Permanent link">#</a></h4>
<h5 id="var-stdenv-dontBuild"><code>dontBuild</code><a class="headerlink" href="#var-stdenv-dontBuild" title="Permanent link">#</a></h5>
<p>Set to true to skip the build phase.</p>
<h5 id="var-stdenv-makefile"><code>makefile</code><a class="headerlink" href="#var-stdenv-makefile" title="Permanent link">#</a></h5>
<p>The file name of the Makefile.</p>
<h5 id="var-stdenv-makeFlags"><code>makeFlags</code><a class="headerlink" href="#var-stdenv-makeFlags" title="Permanent link">#</a></h5>
<p>A list of strings passed as additional flags to <code>make</code>. These flags are also used by the default install and check phase. For setting make flags specific to the build phase, use <code>buildFlags</code> (see below).</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="ss">makeFlags</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;PREFIX=$(out)&quot;</span> <span class="p">];</span>
</span></code></pre></div>
<p>::: {.note}
The flags are quoted in bash, but environment variables can be specified by using the make syntax.
:::</p>
<h5 id="var-stdenv-makeFlagsArray"><code>makeFlagsArray</code><a class="headerlink" href="#var-stdenv-makeFlagsArray" title="Permanent link">#</a></h5>
<p>A shell array containing additional arguments passed to <code>make</code>. You must use this instead of <code>makeFlags</code> if the arguments contain spaces, e.g.</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="ss">preBuild</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="s s-Multiline">  makeFlagsArray+=(CFLAGS=&quot;-O0 -g&quot; LDFLAGS=&quot;-lfoo -lbar&quot;)</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="s s-Multiline">&#39;&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>Note that shell arrays cannot be passed through environment variables, so you cannot set <code>makeFlagsArray</code> in a derivation attribute (because those are passed through environment variables): you have to define them in shell code.</p>
<h5 id="var-stdenv-buildFlags"><code>buildFlags</code> / <code>buildFlagsArray</code><a class="headerlink" href="#var-stdenv-buildFlags" title="Permanent link">#</a></h5>
<p>A list of strings passed as additional flags to <code>make</code>. Like <code>makeFlags</code> and <code>makeFlagsArray</code>, but only used by the build phase. Any build targets should be specified as part of the <code>buildFlags</code>.</p>
<h5 id="var-stdenv-preBuild"><code>preBuild</code><a class="headerlink" href="#var-stdenv-preBuild" title="Permanent link">#</a></h5>
<p>Hook executed at the start of the build phase.</p>
<h5 id="var-stdenv-postBuild"><code>postBuild</code><a class="headerlink" href="#var-stdenv-postBuild" title="Permanent link">#</a></h5>
<p>Hook executed at the end of the build phase.</p>
<p>You can set flags for <code>make</code> through the <code>makeFlags</code> variable.</p>
<p>Before and after running <code>make</code>, the hooks <code>preBuild</code> and <code>postBuild</code> are called, respectively.</p>
<h3 id="ssec-check-phase">The check phase<a class="headerlink" href="#ssec-check-phase" title="Permanent link">#</a></h3>
<p>The check phase checks whether the package was built correctly by running its test suite. The default <code>checkPhase</code> calls <code>make $checkTarget</code>, but only if the <a href="#var-stdenv-doCheck"><code>doCheck</code> variable</a> is enabled.</p>
<h4 id="variables-controlling-the-check-phase">Variables controlling the check phase<a class="headerlink" href="#variables-controlling-the-check-phase" title="Permanent link">#</a></h4>
<h5 id="var-stdenv-doCheck"><code>doCheck</code><a class="headerlink" href="#var-stdenv-doCheck" title="Permanent link">#</a></h5>
<p>Controls whether the check phase is executed. By default it is skipped, but if <code>doCheck</code> is set to true, the check phase is usually executed. Thus you should set</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="ss">doCheck</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></code></pre></div>
<p>in the derivation to enable checks. The exception is cross compilation. Cross compiled builds never run tests, no matter how <code>doCheck</code> is set, as the newly-built program won’t run on the platform used to build it.</p>
<h5 id="makeflags-makeflagsarray-makefile"><code>makeFlags</code> / <code>makeFlagsArray</code> / <code>makefile</code><a class="headerlink" href="#makeflags-makeflagsarray-makefile" title="Permanent link">#</a></h5>
<p>See the <a href="#var-stdenv-makeFlags">build phase</a> for details.</p>
<h5 id="var-stdenv-checkTarget"><code>checkTarget</code><a class="headerlink" href="#var-stdenv-checkTarget" title="Permanent link">#</a></h5>
<p>The <code>make</code> target that runs the tests.
If unset, use <code>check</code> if it exists, otherwise <code>test</code>; if neither is found, do nothing.</p>
<h5 id="var-stdenv-checkFlags"><code>checkFlags</code> / <code>checkFlagsArray</code><a class="headerlink" href="#var-stdenv-checkFlags" title="Permanent link">#</a></h5>
<p>A list of strings passed as additional flags to <code>make</code>. Like <code>makeFlags</code> and <code>makeFlagsArray</code>, but only used by the check phase. Unlike with <code>buildFlags</code>, the <code>checkTarget</code> is automatically added to the <code>make</code> invocation in addition to any <code>checkFlags</code> specified.</p>
<h5 id="var-stdenv-checkInputs"><code>checkInputs</code><a class="headerlink" href="#var-stdenv-checkInputs" title="Permanent link">#</a></h5>
<p>A list of host dependencies used by the phase, usually libraries linked into executables built during tests. This gets included in <code>buildInputs</code> when <code>doCheck</code> is set.</p>
<h5 id="var-stdenv-nativeCheckInputs"><code>nativeCheckInputs</code><a class="headerlink" href="#var-stdenv-nativeCheckInputs" title="Permanent link">#</a></h5>
<p>A list of native dependencies used by the phase, notably tools needed on <code>$PATH</code>. This gets included in <code>nativeBuildInputs</code> when <code>doCheck</code> is set.</p>
<h5 id="var-stdenv-preCheck"><code>preCheck</code><a class="headerlink" href="#var-stdenv-preCheck" title="Permanent link">#</a></h5>
<p>Hook executed at the start of the check phase.</p>
<h5 id="var-stdenv-postCheck"><code>postCheck</code><a class="headerlink" href="#var-stdenv-postCheck" title="Permanent link">#</a></h5>
<p>Hook executed at the end of the check phase.</p>
<h3 id="ssec-install-phase">The install phase<a class="headerlink" href="#ssec-install-phase" title="Permanent link">#</a></h3>
<p>The install phase is responsible for installing the package in the Nix store under <code>out</code>. The default <code>installPhase</code> creates the directory <code>$out</code> and calls <code>make install</code>.</p>
<h4 id="variables-controlling-the-install-phase">Variables controlling the install phase<a class="headerlink" href="#variables-controlling-the-install-phase" title="Permanent link">#</a></h4>
<h5 id="var-stdenv-dontInstall"><code>dontInstall</code><a class="headerlink" href="#var-stdenv-dontInstall" title="Permanent link">#</a></h5>
<p>Set to true to skip the install phase.</p>
<h5 id="makeflags-makeflagsarray-makefile-1"><code>makeFlags</code> / <code>makeFlagsArray</code> / <code>makefile</code><a class="headerlink" href="#makeflags-makeflagsarray-makefile-1" title="Permanent link">#</a></h5>
<p>See the <a href="#var-stdenv-makeFlags">build phase</a> for details.</p>
<h5 id="var-stdenv-installTargets"><code>installTargets</code><a class="headerlink" href="#var-stdenv-installTargets" title="Permanent link">#</a></h5>
<p>The make targets that perform the installation. Defaults to <code>install</code>. Example:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="ss">installTargets</span> <span class="o">=</span> <span class="s2">&quot;install-bin install-doc&quot;</span><span class="p">;</span>
</span></code></pre></div>
<h5 id="var-stdenv-installFlags"><code>installFlags</code> / <code>installFlagsArray</code><a class="headerlink" href="#var-stdenv-installFlags" title="Permanent link">#</a></h5>
<p>A list of strings passed as additional flags to <code>make</code>. Like <code>makeFlags</code> and <code>makeFlagsArray</code>, but only used by the install phase. Unlike with <code>buildFlags</code>, the <code>installTargets</code> are automatically added to the <code>make</code> invocation in addition to any <code>installFlags</code> specified.</p>
<h5 id="var-stdenv-preInstall"><code>preInstall</code><a class="headerlink" href="#var-stdenv-preInstall" title="Permanent link">#</a></h5>
<p>Hook executed at the start of the install phase.</p>
<h5 id="var-stdenv-postInstall"><code>postInstall</code><a class="headerlink" href="#var-stdenv-postInstall" title="Permanent link">#</a></h5>
<p>Hook executed at the end of the install phase.</p>
<h3 id="ssec-fixup-phase">The fixup phase<a class="headerlink" href="#ssec-fixup-phase" title="Permanent link">#</a></h3>
<p>The fixup phase performs (Nix-specific) post-processing actions on the files installed under <code>$out</code> by the install phase. The default <code>fixupPhase</code> does the following:</p>
<ul>
<li>It moves the <code>man/</code>, <code>doc/</code> and <code>info/</code> subdirectories of <code>$out</code> to <code>share/</code>.</li>
<li>It strips libraries and executables of debug information.</li>
<li>On Linux, it applies the <code>patchelf</code> command to ELF executables and libraries to remove unused directories from the <code>RPATH</code> in order to prevent unnecessary runtime dependencies.</li>
<li>It rewrites the interpreter paths of shell scripts to paths found in <code>PATH</code>. E.g., <code>/usr/bin/perl</code> will be rewritten to <code>/nix/store/some-perl/bin/perl</code> found in <code>PATH</code>. See <a href="#patch-shebangs.sh"></a> for details.</li>
</ul>
<h4 id="variables-controlling-the-fixup-phase">Variables controlling the fixup phase<a class="headerlink" href="#variables-controlling-the-fixup-phase" title="Permanent link">#</a></h4>
<h5 id="var-stdenv-dontFixup"><code>dontFixup</code><a class="headerlink" href="#var-stdenv-dontFixup" title="Permanent link">#</a></h5>
<p>Set to true to skip the fixup phase.</p>
<h5 id="var-stdenv-dontStrip"><code>dontStrip</code><a class="headerlink" href="#var-stdenv-dontStrip" title="Permanent link">#</a></h5>
<p>If set, libraries and executables are not stripped. By default, they are.</p>
<h5 id="var-stdenv-dontStripHost"><code>dontStripHost</code><a class="headerlink" href="#var-stdenv-dontStripHost" title="Permanent link">#</a></h5>
<p>Like <code>dontStrip</code>, but only affects the <code>strip</code> command targeting the package’s host platform. Useful when supporting cross compilation, but otherwise feel free to ignore.</p>
<h5 id="var-stdenv-dontStripTarget"><code>dontStripTarget</code><a class="headerlink" href="#var-stdenv-dontStripTarget" title="Permanent link">#</a></h5>
<p>Like <code>dontStrip</code>, but only affects the <code>strip</code> command targeting the packages’ target platform. Useful when supporting cross compilation, but otherwise feel free to ignore.</p>
<h5 id="var-stdenv-dontMoveSbin"><code>dontMoveSbin</code><a class="headerlink" href="#var-stdenv-dontMoveSbin" title="Permanent link">#</a></h5>
<p>If set, files in <code>$out/sbin</code> are not moved to <code>$out/bin</code>. By default, they are.</p>
<h5 id="var-stdenv-stripAllList"><code>stripAllList</code><a class="headerlink" href="#var-stdenv-stripAllList" title="Permanent link">#</a></h5>
<p>List of directories to search for libraries and executables from which <em>all</em> symbols should be stripped. By default, it’s empty. Stripping all symbols is risky, since it may remove not just debug symbols but also ELF information necessary for normal execution.</p>
<h5 id="var-stdenv-stripAllListTarget"><code>stripAllListTarget</code><a class="headerlink" href="#var-stdenv-stripAllListTarget" title="Permanent link">#</a></h5>
<p>Like <code>stripAllList</code>, but only applies to packages’ target platform. By default, it’s empty. Useful when supporting cross compilation.</p>
<h5 id="var-stdenv-stripAllFlags"><code>stripAllFlags</code><a class="headerlink" href="#var-stdenv-stripAllFlags" title="Permanent link">#</a></h5>
<p>Flags passed to the <code>strip</code> command applied to the files in the directories listed in <code>stripAllList</code>. Defaults to <code>-s</code> (i.e. <code>--strip-all</code>).</p>
<h5 id="var-stdenv-stripDebugList"><code>stripDebugList</code><a class="headerlink" href="#var-stdenv-stripDebugList" title="Permanent link">#</a></h5>
<p>List of directories to search for libraries and executables from which only debugging-related symbols should be stripped. It defaults to <code>lib lib32 lib64 libexec bin sbin</code>.</p>
<h5 id="var-stdenv-stripDebugListTarget"><code>stripDebugListTarget</code><a class="headerlink" href="#var-stdenv-stripDebugListTarget" title="Permanent link">#</a></h5>
<p>Like <code>stripDebugList</code>, but only applies to packages’ target platform. By default, it’s empty. Useful when supporting cross compilation.</p>
<h5 id="var-stdenv-stripDebugFlags"><code>stripDebugFlags</code><a class="headerlink" href="#var-stdenv-stripDebugFlags" title="Permanent link">#</a></h5>
<p>Flags passed to the <code>strip</code> command applied to the files in the directories listed in <code>stripDebugList</code>. Defaults to <code>-S</code> (i.e. <code>--strip-debug</code>).</p>
<h5 id="var-stdenv-stripExclude"><code>stripExclude</code><a class="headerlink" href="#var-stdenv-stripExclude" title="Permanent link">#</a></h5>
<p>A list of filenames or path patterns to avoid stripping. A file is excluded if its name <em>or</em> path (from the derivation root) matches.</p>
<p>This example prevents all <code>*.rlib</code> files from being stripped:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>stdenv<span class="o">.</span>mkDerivation <span class="p">{</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>  <span class="c1"># ...</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>  <span class="ss">stripExclude</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;*.rlib&quot;</span> <span class="p">]</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>This example prevents files within certain paths from being stripped:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>stdenv<span class="o">.</span>mkDerivation <span class="p">{</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>  <span class="c1"># ...</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>  <span class="ss">stripExclude</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;lib/modules/*/build/* ]</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="s2">}</span>
</span></code></pre></div>
<h5 id="var-stdenv-dontPatchELF"><code>dontPatchELF</code><a class="headerlink" href="#var-stdenv-dontPatchELF" title="Permanent link">#</a></h5>
<p>If set, the <code>patchelf</code> command is not used to remove unnecessary <code>RPATH</code> entries. Only applies to Linux.</p>
<h5 id="var-stdenv-dontPatchShebangs"><code>dontPatchShebangs</code><a class="headerlink" href="#var-stdenv-dontPatchShebangs" title="Permanent link">#</a></h5>
<p>If set, scripts starting with <code>#!</code> do not have their interpreter paths rewritten to paths in the Nix store. See <a href="#patch-shebangs.sh"></a> on how patching shebangs works.</p>
<h5 id="var-stdenv-dontPruneLibtoolFiles"><code>dontPruneLibtoolFiles</code><a class="headerlink" href="#var-stdenv-dontPruneLibtoolFiles" title="Permanent link">#</a></h5>
<p>If set, libtool <code>.la</code> files associated with shared libraries won’t have their <code>dependency_libs</code> field cleared.</p>
<h5 id="var-stdenv-forceShare"><code>forceShare</code><a class="headerlink" href="#var-stdenv-forceShare" title="Permanent link">#</a></h5>
<p>The list of directories that must be moved from <code>$out</code> to <code>$out/share</code>. Defaults to <code>man doc info</code>.</p>
<h5 id="var-stdenv-setupHook"><code>setupHook</code><a class="headerlink" href="#var-stdenv-setupHook" title="Permanent link">#</a></h5>
<p>A package can export a <a href="#ssec-setup-hooks">setup hook</a> by setting this variable. The setup hook, if defined, is copied to <code>$out/nix-support/setup-hook</code>. Environment variables are then substituted in it using <code>substituteAll</code>.</p>
<h5 id="var-stdenv-preFixup"><code>preFixup</code><a class="headerlink" href="#var-stdenv-preFixup" title="Permanent link">#</a></h5>
<p>Hook executed at the start of the fixup phase.</p>
<h5 id="var-stdenv-postFixup"><code>postFixup</code><a class="headerlink" href="#var-stdenv-postFixup" title="Permanent link">#</a></h5>
<p>Hook executed at the end of the fixup phase.</p>
<h5 id="stdenv-separateDebugInfo"><code>separateDebugInfo</code><a class="headerlink" href="#stdenv-separateDebugInfo" title="Permanent link">#</a></h5>
<p>If set to <code>true</code>, the standard environment will enable debug information in C/C++ builds. After installation, the debug information will be separated from the executables and stored in the output named <code>debug</code>. (This output is enabled automatically; you don’t need to set the <code>outputs</code> attribute explicitly.) To be precise, the debug information is stored in <code>debug/lib/debug/.build-id/XX/YYYY…</code>, where \&lt;XXYYYY…&gt; is the \&lt;build ID&gt; of the binary — a SHA-1 hash of the contents of the binary. Debuggers like GDB use the build ID to look up the separated debug information.</p>
<p>:::{.example #ex-gdb-debug-symbols-socat}</p>
<h1 id="enable-debug-symbols-for-use-with-gdb">Enable debug symbols for use with GDB<a class="headerlink" href="#enable-debug-symbols-for-use-with-gdb" title="Permanent link">#</a></h1>
<p>To make GDB find debug information for the <code>socat</code> package and its dependencies, you can use the following <code>shell.nix</code>:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="k">let</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>  <span class="ss">pkgs</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">./.</span> <span class="p">{</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>    <span class="ss">config</span> <span class="o">=</span> <span class="p">{};</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>    <span class="ss">overlays</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>      <span class="p">(</span>final<span class="p">:</span> prev<span class="p">:</span> <span class="p">{</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>        <span class="ss">ncurses</span> <span class="o">=</span> prev<span class="o">.</span>ncurses<span class="o">.</span>overrideAttrs <span class="p">{</span> <span class="ss">separateDebugInfo</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span> <span class="p">};</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>        <span class="ss">readline</span> <span class="o">=</span> prev<span class="o">.</span>readline<span class="o">.</span>overrideAttrs <span class="p">{</span> <span class="ss">separateDebugInfo</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span> <span class="p">};</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>      <span class="p">})</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>    <span class="p">];</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>  <span class="p">};</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>  <span class="ss">myDebugInfoDirs</span> <span class="o">=</span> pkgs<span class="o">.</span>symlinkJoin <span class="p">{</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>    <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;myDebugInfoDirs&quot;</span><span class="p">;</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>    <span class="ss">paths</span> <span class="o">=</span> <span class="k">with</span> pkgs<span class="p">;</span> <span class="p">[</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>      glibc<span class="o">.</span>debug
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>      ncurses<span class="o">.</span>debug
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>      openssl<span class="o">.</span>debug
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>      readline<span class="o">.</span>debug
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>    <span class="p">];</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a>  <span class="p">};</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="k">in</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>  pkgs<span class="o">.</span>mkShell <span class="p">{</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a>    <span class="ss">NIX_DEBUG_INFO_DIRS</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">${</span>pkgs<span class="o">.</span>lib<span class="o">.</span>getLib myDebugInfoDirs<span class="si">}</span><span class="s2">/lib/debug&quot;</span><span class="p">;</span>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a>    <span class="ss">packages</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a>      pkgs<span class="o">.</span>gdb
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a>      pkgs<span class="o">.</span>socat
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a>    <span class="p">];</span>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a>
</span><span id="__span-35-31"><a id="__codelineno-35-31" name="__codelineno-35-31" href="#__codelineno-35-31"></a>    <span class="ss">shellHook</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-35-32"><a id="__codelineno-35-32" name="__codelineno-35-32" href="#__codelineno-35-32"></a><span class="s s-Multiline">      </span><span class="si">${</span>pkgs<span class="o">.</span>lib<span class="o">.</span>getBin pkgs<span class="o">.</span>gdb<span class="si">}</span><span class="s s-Multiline">/bin/gdb </span><span class="si">${</span>pkgs<span class="o">.</span>lib<span class="o">.</span>getBin pkgs<span class="o">.</span>socat<span class="si">}</span><span class="s s-Multiline">/bin/socat</span>
</span><span id="__span-35-33"><a id="__codelineno-35-33" name="__codelineno-35-33" href="#__codelineno-35-33"></a><span class="s s-Multiline">    &#39;&#39;</span><span class="p">;</span>
</span><span id="__span-35-34"><a id="__codelineno-35-34" name="__codelineno-35-34" href="#__codelineno-35-34"></a>  <span class="p">}</span>
</span></code></pre></div>
<p>This setup works as follows:
- Add <a href="#chap-overlays"><code>overlays</code></a> to the package set, since debug symbols are disabled for <code>ncurses</code> and <code>readline</code> by default.
- Create a derivation to combine all required debug symbols under one path with <a href="#trivial-builder-symlinkJoin"><code>symlinkJoin</code></a>.
- Set the environment variable <code>NIX_DEBUG_INFO_DIRS</code> in the shell. Nixpkgs patches <code>gdb</code> to use it for looking up debug symbols.
- Run <code>gdb</code> on the <code>socat</code> binary on shell startup in the <a href="#sec-pkgs-mkShell"><code>shellHook</code></a>. Here we use <a href="#function-library-lib.attrsets.getBin"><code>lib.getBin</code></a> to ensure that the correct derivation output is selected rather than the default one.</p>
<p>:::</p>
<h3 id="ssec-installCheck-phase">The installCheck phase<a class="headerlink" href="#ssec-installCheck-phase" title="Permanent link">#</a></h3>
<p>The installCheck phase checks whether the package was installed correctly by running its test suite against the installed directories. The default <code>installCheck</code> calls <code>make installcheck</code>.</p>
<p>It is often better to add tests that are not part of the source distribution to <code>passthru.tests</code> (see
<a href="#var-meta-tests"></a>). This avoids adding overhead to every build and enables us to run them independently.</p>
<h4 id="variables-controlling-the-installcheck-phase">Variables controlling the installCheck phase<a class="headerlink" href="#variables-controlling-the-installcheck-phase" title="Permanent link">#</a></h4>
<h5 id="var-stdenv-doInstallCheck"><code>doInstallCheck</code><a class="headerlink" href="#var-stdenv-doInstallCheck" title="Permanent link">#</a></h5>
<p>Controls whether the installCheck phase is executed. By default it is skipped, but if <code>doInstallCheck</code> is set to true, the installCheck phase is usually executed. Thus you should set</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="ss">doInstallCheck</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></code></pre></div>
<p>in the derivation to enable install checks. The exception is cross compilation. Cross compiled builds never run tests, no matter how <code>doInstallCheck</code> is set, as the newly-built program won’t run on the platform used to build it.</p>
<h5 id="var-stdenv-installCheckTarget"><code>installCheckTarget</code><a class="headerlink" href="#var-stdenv-installCheckTarget" title="Permanent link">#</a></h5>
<p>The make target that runs the install tests. Defaults to <code>installcheck</code>.</p>
<h5 id="var-stdenv-installCheckFlags"><code>installCheckFlags</code> / <code>installCheckFlagsArray</code><a class="headerlink" href="#var-stdenv-installCheckFlags" title="Permanent link">#</a></h5>
<p>A list of strings passed as additional flags to <code>make</code>. Like <code>makeFlags</code> and <code>makeFlagsArray</code>, but only used by the installCheck phase.</p>
<h5 id="var-stdenv-installCheckInputs"><code>installCheckInputs</code><a class="headerlink" href="#var-stdenv-installCheckInputs" title="Permanent link">#</a></h5>
<p>A list of host dependencies used by the phase, usually libraries linked into executables built during tests. This gets included in <code>buildInputs</code> when <code>doInstallCheck</code> is set.</p>
<h5 id="var-stdenv-nativeInstallCheckInputs"><code>nativeInstallCheckInputs</code><a class="headerlink" href="#var-stdenv-nativeInstallCheckInputs" title="Permanent link">#</a></h5>
<p>A list of native dependencies used by the phase, notably tools needed on <code>$PATH</code>. This gets included in <code>nativeBuildInputs</code> when <code>doInstallCheck</code> is set.</p>
<h5 id="var-stdenv-preInstallCheck"><code>preInstallCheck</code><a class="headerlink" href="#var-stdenv-preInstallCheck" title="Permanent link">#</a></h5>
<p>Hook executed at the start of the installCheck phase.</p>
<h5 id="var-stdenv-postInstallCheck"><code>postInstallCheck</code><a class="headerlink" href="#var-stdenv-postInstallCheck" title="Permanent link">#</a></h5>
<p>Hook executed at the end of the installCheck phase.</p>
<h3 id="ssec-distribution-phase">The distribution phase<a class="headerlink" href="#ssec-distribution-phase" title="Permanent link">#</a></h3>
<p>The distribution phase is intended to produce a source distribution of the package. The default <code>distPhase</code> first calls <code>make dist</code>, then it copies the resulting source tarballs to <code>$out/tarballs/</code>. This phase is only executed if the attribute <code>doDist</code> is set.</p>
<h4 id="variables-controlling-the-distribution-phase">Variables controlling the distribution phase<a class="headerlink" href="#variables-controlling-the-distribution-phase" title="Permanent link">#</a></h4>
<h5 id="var-stdenv-doDist"><code>doDist</code><a class="headerlink" href="#var-stdenv-doDist" title="Permanent link">#</a></h5>
<p>If set, the distribution phase is executed.</p>
<h5 id="var-stdenv-distTarget"><code>distTarget</code><a class="headerlink" href="#var-stdenv-distTarget" title="Permanent link">#</a></h5>
<p>The make target that produces the distribution. Defaults to <code>dist</code>.</p>
<h5 id="var-stdenv-distFlags"><code>distFlags</code> / <code>distFlagsArray</code><a class="headerlink" href="#var-stdenv-distFlags" title="Permanent link">#</a></h5>
<p>Additional flags passed to <code>make</code>.</p>
<h5 id="var-stdenv-tarballs"><code>tarballs</code><a class="headerlink" href="#var-stdenv-tarballs" title="Permanent link">#</a></h5>
<p>The names of the source distribution files to be copied to <code>$out/tarballs/</code>. It can contain shell wildcards. The default is <code>*.tar.gz</code>.</p>
<h5 id="var-stdenv-dontCopyDist"><code>dontCopyDist</code><a class="headerlink" href="#var-stdenv-dontCopyDist" title="Permanent link">#</a></h5>
<p>If set, no files are copied to <code>$out/tarballs/</code>.</p>
<h5 id="var-stdenv-preDist"><code>preDist</code><a class="headerlink" href="#var-stdenv-preDist" title="Permanent link">#</a></h5>
<p>Hook executed at the start of the distribution phase.</p>
<h5 id="var-stdenv-postDist"><code>postDist</code><a class="headerlink" href="#var-stdenv-postDist" title="Permanent link">#</a></h5>
<p>Hook executed at the end of the distribution phase.</p>
<h2 id="ssec-stdenv-functions">Shell functions and utilities<a class="headerlink" href="#ssec-stdenv-functions" title="Permanent link">#</a></h2>
<p>The standard environment provides a number of useful functions.</p>
<h3 id="fun-makeWrapper"><code>makeWrapper</code> \&lt;executable&gt; \&lt;wrapperfile&gt; \&lt;args&gt;<a class="headerlink" href="#fun-makeWrapper" title="Permanent link">#</a></h3>
<p>Constructs a wrapper for a program with various possible arguments. It is defined as part of 2 setup-hooks named <code>makeWrapper</code> and <code>makeBinaryWrapper</code> that implement the same bash functions. Hence, to use it you have to add <code>makeWrapper</code> to your <code>nativeBuildInputs</code>. Here's an example usage:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># adds `FOOBAR=baz` to `$out/bin/foo`’s environment</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>makeWrapper<span class="w"> </span><span class="nv">$out</span>/bin/foo<span class="w"> </span><span class="nv">$wrapperfile</span><span class="w"> </span>--set<span class="w"> </span>FOOBAR<span class="w"> </span>baz
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="c1"># Prefixes the binary paths of `hello` and `git`</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="c1"># and suffixes the binary path of `xdg-utils`.</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="c1"># Be advised that paths often should be patched in directly</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="c1"># (via string replacements or in `configurePhase`).</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>makeWrapper<span class="w"> </span><span class="nv">$out</span>/bin/foo<span class="w"> </span><span class="nv">$wrapperfile</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="w">  </span>--prefix<span class="w"> </span>PATH<span class="w"> </span>:<span class="w"> </span><span class="si">${</span><span class="nv">lib</span><span class="p">.makeBinPath [ hello git ]</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="w">  </span>--suffix<span class="w"> </span>PATH<span class="w"> </span>:<span class="w"> </span><span class="si">${</span><span class="nv">lib</span><span class="p">.makeBinPath [ xdg-utils ]</span><span class="si">}</span>
</span></code></pre></div>
<p>Packages may expect or require other utilities to be available at runtime.
<code>makeWrapper</code> can be used to add packages to a <code>PATH</code> environment variable local to a wrapper.</p>
<p>Use <code>--prefix</code> to explicitly set dependencies in <code>PATH</code>.</p>
<p>::: {.note}
<code>--prefix</code> essentially hard-codes dependencies into the wrapper.
They cannot be overridden without rebuilding the package.
:::</p>
<p>If dependencies should be resolved at runtime, use <code>--suffix</code> to append fallback values to <code>PATH</code>.</p>
<p>There’s many more kinds of arguments, they are documented in <code>nixpkgs/pkgs/build-support/setup-hooks/make-wrapper.sh</code> for the <code>makeWrapper</code> implementation and in <code>nixpkgs/pkgs/build-support/setup-hooks/make-binary-wrapper/make-binary-wrapper.sh</code> for the <code>makeBinaryWrapper</code> implementation.</p>
<p><code>wrapProgram</code> is a convenience function you probably want to use most of the time, implemented by both <code>makeWrapper</code> and <code>makeBinaryWrapper</code>.</p>
<p>Using the <code>makeBinaryWrapper</code> implementation is usually preferred, as it creates a tiny <em>compiled</em> wrapper executable, that can be used as a shebang interpreter. This is needed mostly on Darwin, where shebangs cannot point to scripts, <a href="https://stackoverflow.com/questions/67100831/macos-shebang-with-absolute-path-not-working">due to a limitation with the <code>execve</code>-syscall</a>. Compiled wrappers generated by <code>makeBinaryWrapper</code> can be inspected with <code>less &lt;path-to-wrapper&gt;</code> - by scrolling past the binary data you should be able to see the shell command that generated the executable and there see the environment variables that were injected into the wrapper.</p>
<h3 id="fun-remove-references-to"><code>remove-references-to -t</code> \&lt;storepath&gt; [ <code>-t</code> \&lt;storepath&gt; ... ] \&lt;file&gt; ...<a class="headerlink" href="#fun-remove-references-to" title="Permanent link">#</a></h3>
<p>Removes the references of the specified files to the specified store files. This is done without changing the size of the file by replacing the hash by <code>eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</code>, and should work on compiled executables. This is meant to be used to remove the dependency of the output on inputs that are known to be unnecessary at runtime. Of course, reckless usage will break the patched programs.
To use this, add <code>removeReferencesTo</code> to <code>nativeBuildInputs</code>.</p>
<p>As <code>remove-references-to</code> is an actual executable and not a shell function, it can be used with <code>find</code>.
Example removing all references to the compiler in the output:
<div class="language-nix highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="ss">postInstall</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="s s-Multiline">  find &quot;$out&quot; -type f -exec remove-references-to -t </span><span class="si">${</span>stdenv<span class="o">.</span>cc<span class="si">}</span><span class="s s-Multiline"> &#39;{}&#39; +</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="s s-Multiline">&#39;&#39;</span><span class="p">;</span>
</span></code></pre></div></p>
<h3 id="fun-substitute"><code>substitute</code> \&lt;infile&gt; \&lt;outfile&gt; \&lt;subs&gt;<a class="headerlink" href="#fun-substitute" title="Permanent link">#</a></h3>
<p>Performs string substitution on the contents of \&lt;infile&gt;, writing the result to \&lt;outfile&gt;. The substitutions in \&lt;subs&gt; are of the following form:</p>
<h4 id="fun-substitute-replace-fail"><code>--replace-fail</code> \&lt;s1&gt; \&lt;s2&gt;<a class="headerlink" href="#fun-substitute-replace-fail" title="Permanent link">#</a></h4>
<p>Replace every occurrence of the string \&lt;s1&gt; by \&lt;s2&gt;.
Will error if no change is made.</p>
<h4 id="fun-substitute-replace-warn"><code>--replace-warn</code> \&lt;s1&gt; \&lt;s2&gt;<a class="headerlink" href="#fun-substitute-replace-warn" title="Permanent link">#</a></h4>
<p>Replace every occurrence of the string \&lt;s1&gt; by \&lt;s2&gt;.
Will print a warning if no change is made.</p>
<h4 id="fun-substitute-replace-quiet"><code>--replace-quiet</code> \&lt;s1&gt; \&lt;s2&gt;<a class="headerlink" href="#fun-substitute-replace-quiet" title="Permanent link">#</a></h4>
<p>Replace every occurrence of the string \&lt;s1&gt; by \&lt;s2&gt;.
Will do nothing if no change can be made.</p>
<h4 id="fun-substitute-subst-var"><code>--subst-var</code> \&lt;varName&gt;<a class="headerlink" href="#fun-substitute-subst-var" title="Permanent link">#</a></h4>
<p>Replace every occurrence of <code>@varName@</code> by the contents of the environment variable \&lt;varName&gt;. This is useful for generating files from templates, using <code>@...@</code> in the template as placeholders.</p>
<h4 id="fun-substitute-subst-var-by"><code>--subst-var-by</code> \&lt;varName&gt; \&lt;s&gt;<a class="headerlink" href="#fun-substitute-subst-var-by" title="Permanent link">#</a></h4>
<p>Replace every occurrence of <code>@varName@</code> by the string \&lt;s&gt;.</p>
<p>Example:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>substitute<span class="w"> </span>./foo.in<span class="w"> </span>./foo.out<span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">    </span>--replace-fail<span class="w"> </span>/usr/bin/bar<span class="w"> </span><span class="nv">$bar</span>/bin/bar<span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">    </span>--replace-fail<span class="w"> </span><span class="s2">&quot;a string containing spaces&quot;</span><span class="w"> </span><span class="s2">&quot;some other text&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">    </span>--subst-var<span class="w"> </span>someVar
</span></code></pre></div>
<h3 id="fun-substituteInPlace"><code>substituteInPlace</code> \&lt;multiple files&gt; \&lt;subs&gt;<a class="headerlink" href="#fun-substituteInPlace" title="Permanent link">#</a></h3>
<p>Like <code>substitute</code>, but performs the substitutions in place on the files passed.</p>
<h3 id="fun-substituteAll"><code>substituteAll</code> \&lt;infile&gt; \&lt;outfile&gt;<a class="headerlink" href="#fun-substituteAll" title="Permanent link">#</a></h3>
<p>Replaces every occurrence of <code>@varName@</code>, where \&lt;varName&gt; is any environment variable, in \&lt;infile&gt;, writing the result to \&lt;outfile&gt;. For instance, if \&lt;infile&gt; has the contents</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="ch">#! @bash@/bin/sh</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="nv">PATH</span><span class="o">=</span>@coreutils@/bin
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="nb">echo</span><span class="w"> </span>@foo@
</span></code></pre></div>
<p>and the environment contains <code>bash=/nix/store/bmwp0q28cf21...-bash-3.2-p39</code> and <code>coreutils=/nix/store/68afga4khv0w...-coreutils-6.12</code>, but does not contain the variable <code>foo</code>, then the output will be</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="ch">#! /nix/store/bmwp0q28cf21...-bash-3.2-p39/bin/sh</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="nv">PATH</span><span class="o">=</span>/nix/store/68afga4khv0w...-coreutils-6.12/bin
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="nb">echo</span><span class="w"> </span>@foo@
</span></code></pre></div>
<p>That is, no substitution is performed for undefined variables.</p>
<p>Environment variables that start with an uppercase letter or an underscore are filtered out, to prevent global variables (like <code>HOME</code>) or private variables (like <code>__ETC_PROFILE_DONE</code>) from accidentally getting substituted. The variables also have to be valid bash "names", as defined in the bash manpage (alphanumeric or <code>_</code>, must not start with a number).</p>
<h3 id="fun-substituteAllInPlace"><code>substituteAllInPlace</code> \&lt;file&gt;<a class="headerlink" href="#fun-substituteAllInPlace" title="Permanent link">#</a></h3>
<p>Like <code>substituteAll</code>, but performs the substitutions in place on the file \&lt;file&gt;.</p>
<h3 id="fun-stripHash"><code>stripHash</code> \&lt;path&gt;<a class="headerlink" href="#fun-stripHash" title="Permanent link">#</a></h3>
<p>Strips the directory and hash part of a store path, outputting the name part to <code>stdout</code>. For example:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># prints coreutils-8.24</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>stripHash<span class="w"> </span><span class="s2">&quot;/nix/store/9s9r019176g7cvn2nvcw41gsp862y6b4-coreutils-8.24&quot;</span>
</span></code></pre></div>
<p>If you wish to store the result in another variable, then the following idiom may be useful:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;/nix/store/9s9r019176g7cvn2nvcw41gsp862y6b4-coreutils-8.24&quot;</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="nv">someVar</span><span class="o">=</span><span class="k">$(</span>stripHash<span class="w"> </span><span class="nv">$name</span><span class="k">)</span>
</span></code></pre></div>
<h3 id="fun-wrapProgram"><code>wrapProgram</code> \&lt;executable&gt; \&lt;makeWrapperArgs&gt;<a class="headerlink" href="#fun-wrapProgram" title="Permanent link">#</a></h3>
<p>Convenience function for <code>makeWrapper</code> that replaces <code>&lt;executable&gt;</code> with a wrapper that executes the original program. It takes all the same arguments as <code>makeWrapper</code>, except for <code>--inherit-argv0</code> (used by the <code>makeBinaryWrapper</code> implementation) and <code>--argv0</code> (used by both <code>makeWrapper</code> and <code>makeBinaryWrapper</code> wrapper implementations).</p>
<p>If you will apply it multiple times, it will overwrite the wrapper file and you will end up with double wrapping, which should be avoided.</p>
<h3 id="fun-prependToVar"><code>prependToVar</code> \&lt;variableName&gt; \&lt;elements...&gt;<a class="headerlink" href="#fun-prependToVar" title="Permanent link">#</a></h3>
<p>Prepend elements to a variable.</p>
<p>Example:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>$ configureFlags=&quot;--disable-static&quot;
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>$ prependToVar configureFlags --disable-dependency-tracking --enable-foo
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>$ echo $configureFlags
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>--disable-dependency-tracking --enable-foo --disable-static
</span></code></pre></div>
<h3 id="fun-appendToVar"><code>appendToVar</code> \&lt;variableName&gt; \&lt;elements...&gt;<a class="headerlink" href="#fun-appendToVar" title="Permanent link">#</a></h3>
<p>Append elements to a variable.</p>
<p>Example:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>$ configureFlags=&quot;--disable-static&quot;
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>$ appendToVar configureFlags --disable-dependency-tracking --enable-foo
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>$ echo $configureFlags
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>--disable-static --disable-dependency-tracking --enable-foo
</span></code></pre></div>
<h2 id="ssec-setup-hooks">Package setup hooks<a class="headerlink" href="#ssec-setup-hooks" title="Permanent link">#</a></h2>
<p>Nix itself considers a build-time dependency as merely something that should previously be built and accessible at build time—packages themselves are on their own to perform any additional setup. In most cases, that is fine, and the downstream derivation can deal with its own dependencies. But for a few common tasks, that would result in almost every package doing the same sort of setup work—depending not on the package itself, but entirely on which dependencies were used.</p>
<p>In order to alleviate this burden, the setup hook mechanism was written, where any package can include a shell script that [by convention rather than enforcement by Nix], any downstream reverse-dependency will source as part of its build process. That allows the downstream dependency to merely specify its dependencies, and lets those dependencies effectively initialize themselves. No boilerplate mirroring the list of dependencies is needed.</p>
<p>The setup hook mechanism is a bit of a sledgehammer though: a powerful feature with a broad and indiscriminate area of effect. The combination of its power and implicit use may be expedient, but isn’t without costs. Nix itself is unchanged, but the spirit of added dependencies being effect-free is violated even if the latter isn’t. For example, if a derivation path is mentioned more than once, Nix itself doesn’t care and makes sure the dependency derivation is already built just the same—depending is just needing something to exist, and needing is idempotent. However, a dependency specified twice will have its setup hook run twice, and that could easily change the build environment (though a well-written setup hook will therefore strive to be idempotent so this is in fact not observable). More broadly, setup hooks are anti-modular in that multiple dependencies, whether the same or different, should not interfere and yet their setup hooks may well do so.</p>
<p>The most typical use of the setup hook is actually to add other hooks which are then run (i.e. after all the setup hooks) on each dependency. For example, the C compiler wrapper’s setup hook feeds itself flags for each dependency that contains relevant libraries and headers. This is done by defining a bash function, and appending its name to one of <code>envBuildBuildHooks</code>, <code>envBuildHostHooks</code>, <code>envBuildTargetHooks</code>, <code>envHostHostHooks</code>, <code>envHostTargetHooks</code>, or <code>envTargetTargetHooks</code>. These 6 bash variables correspond to the 6 sorts of dependencies by platform (there’s 12 total but we ignore the propagated/non-propagated axis).</p>
<p>Packages adding a hook should not hard code a specific hook, but rather choose a variable <em>relative</em> to how they are included. Returning to the C compiler wrapper example, if the wrapper itself is an <code>n</code> dependency, then it only wants to accumulate flags from <code>n + 1</code> dependencies, as only those ones match the compiler’s target platform. The <code>hostOffset</code> variable is defined with the current dependency’s host offset <code>targetOffset</code> with its target offset, before its setup hook is sourced. Additionally, since most environment hooks don’t care about the target platform, that means the setup hook can append to the right bash array by doing something like</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>addEnvHooks<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$hostOffset</span><span class="s2">&quot;</span><span class="w"> </span>myBashFunction
</span></code></pre></div>
<p>The <em>existence</em> of setups hooks has long been documented and packages inside Nixpkgs are free to use this mechanism. Other packages, however, should not rely on these mechanisms not changing between Nixpkgs versions. Because of the existing issues with this system, there’s little benefit from mandating it be stable for any period of time.</p>
<p>First, let’s cover some setup hooks that are part of Nixpkgs default <code>stdenv</code>. This means that they are run for every package built using <code>stdenv.mkDerivation</code> or when using a custom builder that has <code>source $stdenv/setup</code>. Some of these are platform specific, so they may run on Linux but not Darwin or vice-versa.</p>
<h3 id="move-docs.sh"><code>move-docs.sh</code><a class="headerlink" href="#move-docs.sh" title="Permanent link">#</a></h3>
<p>This setup hook moves any installed documentation to the <code>/share</code> subdirectory directory. This includes the man, doc and info directories. This is needed for legacy programs that do not know how to use the <code>share</code> subdirectory.</p>
<h3 id="compress-man-pages.sh"><code>compress-man-pages.sh</code><a class="headerlink" href="#compress-man-pages.sh" title="Permanent link">#</a></h3>
<p>This setup hook compresses any man pages that have been installed. The compression is done using the gzip program. This helps to reduce the installed size of packages.</p>
<h3 id="strip.sh"><code>strip.sh</code><a class="headerlink" href="#strip.sh" title="Permanent link">#</a></h3>
<p>This runs the strip command on installed binaries and libraries. This removes unnecessary information like debug symbols when they are not needed. This also helps to reduce the installed size of packages.</p>
<h3 id="patch-shebangs.sh"><code>patch-shebangs.sh</code><a class="headerlink" href="#patch-shebangs.sh" title="Permanent link">#</a></h3>
<p>This setup hook patches installed scripts to add Nix store paths to their shebang interpreter as found in the build environment. The <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> line tells a Unix-like operating system which interpreter to use to execute the script's contents.</p>
<p>::: {.note}
The <a href="https://github.com/NixOS/nixpkgs/blob/19d4f7dc485f74109bd66ef74231285ff797a823/pkgs/stdenv/generic/builder.sh">generic builder</a> populates <code>PATH</code> from inputs of the derivation.
:::</p>
<h4 id="patch-shebangs.sh-invocation">Invocation<a class="headerlink" href="#patch-shebangs.sh-invocation" title="Permanent link">#</a></h4>
<p>Multiple paths can be specified.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>patchShebangs [--build | --host] PATH...
</span></code></pre></div>
<h5 id="patch-shebangs.sh-invocation-flags">Flags<a class="headerlink" href="#patch-shebangs.sh-invocation-flags" title="Permanent link">#</a></h5>
<p><code>--build</code>
: Look up commands available at build time</p>
<p><code>--host</code>
: Look up commands available at run time</p>
<h5 id="patch-shebangs.sh-invocation-examples">Examples<a class="headerlink" href="#patch-shebangs.sh-invocation-examples" title="Permanent link">#</a></h5>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>patchShebangs<span class="w"> </span>--host<span class="w"> </span>/nix/store/&lt;hash&gt;-hello-1.0/bin
</span></code></pre></div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>patchShebangs<span class="w"> </span>--build<span class="w"> </span>configure
</span></code></pre></div>
<p><code>#!/bin/sh</code> will be rewritten to <code>#!/nix/store/&lt;hash&gt;-some-bash/bin/sh</code>.</p>
<p><code>#!/usr/bin/env</code> gets special treatment: <code>#!/usr/bin/env python</code> is rewritten to <code>/nix/store/&lt;hash&gt;/bin/python</code>.</p>
<p>Interpreter paths that point to a valid Nix store location are not changed.</p>
<p>::: {.note}
A script file must be marked as executable, otherwise it will not be
considered.
:::</p>
<p>This mechanism ensures that the interpreter for a given script is always found and is exactly the one specified by the build.</p>
<p>It can be disabled by setting <a href="#var-stdenv-dontPatchShebangs"><code>dontPatchShebangs</code></a>:</p>
<div class="language-nix highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>stdenv<span class="o">.</span>mkDerivation <span class="p">{</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>  <span class="c1"># ...</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>  <span class="ss">dontPatchShebangs</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>  <span class="c1"># ...</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>The file <a href="https://github.com/NixOS/nixpkgs/blob/19d4f7dc485f74109bd66ef74231285ff797a823/pkgs/build-support/setup-hooks/patch-shebangs.sh"><code>patch-shebangs.sh</code></a> defines the <a href="https://github.com/NixOS/nixpkgs/blob/19d4f7dc485f74109bd66ef74231285ff797a823/pkgs/build-support/setup-hooks/patch-shebangs.sh#L24-L105"><code>patchShebangs</code></a> function. It is used to implement <a href="https://github.com/NixOS/nixpkgs/blob/19d4f7dc485f74109bd66ef74231285ff797a823/pkgs/build-support/setup-hooks/patch-shebangs.sh#L107-L119"><code>patchShebangsAuto</code></a>, the <a href="#ssec-setup-hooks">setup hook</a> that is registered to run during the <a href="#ssec-fixup-phase">fixup phase</a> by default.</p>
<p>If you need to run <code>patchShebangs</code> at build time, it must be called explicitly within <a href="#sec-stdenv-phases">one of the build phases</a>.</p>
<h3 id="audit-tmpdir.sh"><code>audit-tmpdir.sh</code><a class="headerlink" href="#audit-tmpdir.sh" title="Permanent link">#</a></h3>
<p>This verifies that no references are left from the install binaries to the directory used to build those binaries. This ensures that the binaries do not need things outside the Nix store. This is currently supported in Linux only.</p>
<h3 id="multiple-outputs.sh"><code>multiple-outputs.sh</code><a class="headerlink" href="#multiple-outputs.sh" title="Permanent link">#</a></h3>
<p>This setup hook adds configure flags that tell packages to install files into any one of the proper outputs listed in <code>outputs</code>. This behavior can be turned off by setting <code>setOutputFlags</code> to false in the derivation environment. See <a href="#chap-multiple-output"></a> for more information.</p>
<h3 id="move-sbin.sh"><code>move-sbin.sh</code><a class="headerlink" href="#move-sbin.sh" title="Permanent link">#</a></h3>
<p>This setup hook moves any binaries installed in the <code>sbin/</code> subdirectory into <code>bin/</code>. In addition, a link is provided from <code>sbin/</code> to <code>bin/</code> for compatibility.</p>
<h3 id="move-lib64.sh"><code>move-lib64.sh</code><a class="headerlink" href="#move-lib64.sh" title="Permanent link">#</a></h3>
<p>This setup hook moves any libraries installed in the <code>lib64/</code> subdirectory into <code>lib/</code>. In addition, a link is provided from <code>lib64/</code> to <code>lib/</code> for compatibility.</p>
<h3 id="move-systemd-user-units.sh"><code>move-systemd-user-units.sh</code><a class="headerlink" href="#move-systemd-user-units.sh" title="Permanent link">#</a></h3>
<p>This setup hook moves any systemd user units installed in the <code>lib/</code> subdirectory into <code>share/</code>. In addition, a link is provided from <code>share/</code> to <code>lib/</code> for compatibility. This is needed for systemd to find user services when installed into the user profile.</p>
<p>This hook only runs when compiling for Linux.</p>
<h3 id="set-source-date-epoch-to-latest.sh"><code>set-source-date-epoch-to-latest.sh</code><a class="headerlink" href="#set-source-date-epoch-to-latest.sh" title="Permanent link">#</a></h3>
<p>This sets <code>SOURCE_DATE_EPOCH</code> to the modification time of the most recent file.</p>
<h3 id="bintools-wrapper">Bintools Wrapper and hook<a class="headerlink" href="#bintools-wrapper" title="Permanent link">#</a></h3>
<p>The Bintools Wrapper wraps the binary utilities for a bunch of miscellaneous purposes. These are GNU Binutils when targeting Linux, and a mix of cctools and GNU binutils for Darwin. [The “Bintools” name is supposed to be a compromise between “Binutils” and “cctools” not denoting any specific implementation.] Specifically, the underlying bintools package, and a C standard library (glibc or Darwin’s libSystem, just for the dynamic loader) are all fed in, and dependency finding, hardening (see below), and purity checks for each are handled by the Bintools Wrapper. Packages typically depend on CC Wrapper, which in turn (at run time) depends on the Bintools Wrapper.</p>
<p>The Bintools Wrapper was only just recently split off from CC Wrapper, so the division of labor is still being worked out. For example, it shouldn’t care about the C standard library, but just take a derivation with the dynamic loader (which happens to be the glibc on linux). Dependency finding however is a task both wrappers will continue to need to share, and probably the most important to understand. It is currently accomplished by collecting directories of host-platform dependencies (i.e. <code>buildInputs</code> and <code>nativeBuildInputs</code>) in environment variables. The Bintools Wrapper’s setup hook causes any <code>lib</code> and <code>lib64</code> subdirectories to be added to <code>NIX_LDFLAGS</code>. Since the CC Wrapper and the Bintools Wrapper use the same strategy, most of the Bintools Wrapper code is sparsely commented and refers to the CC Wrapper. But the CC Wrapper’s code, by contrast, has quite lengthy comments. The Bintools Wrapper merely cites those, rather than repeating them, to avoid falling out of sync.</p>
<p>A final task of the setup hook is defining a number of standard environment variables to tell build systems which executables fulfill which purpose. They are defined to just be the base name of the tools, under the assumption that the Bintools Wrapper’s binaries will be on the path. Firstly, this helps poorly-written packages, e.g. ones that look for just <code>gcc</code> when <code>CC</code> isn’t defined yet <code>clang</code> is to be used. Secondly, this helps packages not get confused when cross-compiling, in which case multiple Bintools Wrappers may simultaneously be in use. [^footnote-stdenv-per-platform-wrapper] <code>BUILD_</code>- and <code>TARGET_</code>-prefixed versions of the normal environment variable are defined for additional Bintools Wrappers, properly disambiguating them.</p>
<p>A problem with this final task is that the Bintools Wrapper is honest and defines <code>LD</code> as <code>ld</code>. Most packages, however, firstly use the C compiler for linking, secondly use <code>LD</code> anyways, defining it as the C compiler, and thirdly, only so define <code>LD</code> when it is undefined as a fallback. This triple-threat means Bintools Wrapper will break those packages, as LD is already defined as the actual linker which the package won’t override yet doesn’t want to use. The workaround is to define, just for the problematic package, <code>LD</code> as the C compiler. A good way to do this would be <code>preConfigure = "LD=$CC"</code>.</p>
<h3 id="cc-wrapper">CC Wrapper and hook<a class="headerlink" href="#cc-wrapper" title="Permanent link">#</a></h3>
<p>The CC Wrapper wraps a C toolchain for a bunch of miscellaneous purposes. Specifically, a C compiler (GCC or Clang), wrapped binary tools, and a C standard library (glibc or Darwin’s libSystem, just for the dynamic loader) are all fed in, and dependency finding, hardening (see below), and purity checks for each are handled by the CC Wrapper. Packages typically depend on the CC Wrapper, which in turn (at run-time) depends on the Bintools Wrapper.</p>
<p>Dependency finding is undoubtedly the main task of the CC Wrapper. This works just like the Bintools Wrapper, except that any <code>include</code> subdirectory of any relevant dependency is added to <code>NIX_CFLAGS_COMPILE</code>. The setup hook itself contains elaborate comments describing the exact mechanism by which this is accomplished.</p>
<p>Similarly, the CC Wrapper follows the Bintools Wrapper in defining standard environment variables with the names of the tools it wraps, for the same reasons described above. Importantly, while it includes a <code>cc</code> symlink to the c compiler for portability, the <code>CC</code> will be defined using the compiler’s “real name” (i.e. <code>gcc</code> or <code>clang</code>). This helps lousy build systems that inspect on the name of the compiler rather than run it.</p>
<p>Here are some more packages that provide a setup hook. Since the list of hooks is extensible, this is not an exhaustive list. The mechanism is only to be used as a last resort, so it might cover most uses.</p>
<h3 id="stdenv-other-hooks">Other hooks<a class="headerlink" href="#stdenv-other-hooks" title="Permanent link">#</a></h3>
<p>Many other packages provide hooks, that are not part of <code>stdenv</code>. You can find
these in the <a href="#chap-hooks">Hooks Reference</a>.</p>
<h3 id="compiler-linker-wrapper-hooks">Compiler and Linker wrapper hooks<a class="headerlink" href="#compiler-linker-wrapper-hooks" title="Permanent link">#</a></h3>
<p>If the file <code>${cc}/nix-support/cc-wrapper-hook</code> exists, it will be run at the end of the <a href="#cc-wrapper">compiler wrapper</a>.
If the file <code>${binutils}/nix-support/post-link-hook</code> exists, it will be run at the end of the linker wrapper.
These hooks allow a user to inject code into the wrappers.
As an example, these hooks can be used to extract <code>extraBefore</code>, <code>params</code> and <code>extraAfter</code> which store all the command line arguments passed to the compiler and linker respectively.</p>
<h2 id="sec-purity-in-nixpkgs">Purity in Nixpkgs<a class="headerlink" href="#sec-purity-in-nixpkgs" title="Permanent link">#</a></h2>
<p><em>Measures taken to prevent dependencies on packages outside the store, and what you can do to prevent them.</em></p>
<p>GCC doesn’t search in locations such as <code>/usr/include</code>. In fact, attempts to add such directories through the <code>-I</code> flag are filtered out. Likewise, the linker (from GNU binutils) doesn’t search in standard locations such as <code>/usr/lib</code>. Programs built on Linux are linked against a GNU C Library that likewise doesn’t search in the default system locations.</p>
<h2 id="sec-hardening-in-nixpkgs">Hardening in Nixpkgs<a class="headerlink" href="#sec-hardening-in-nixpkgs" title="Permanent link">#</a></h2>
<p>There are flags available to harden packages at compile or link-time. These can be toggled using the <code>stdenv.mkDerivation</code> parameters <code>hardeningDisable</code> and <code>hardeningEnable</code>.</p>
<p>Both parameters take a list of flags as strings. The special <code>"all"</code> flag can be passed to <code>hardeningDisable</code> to turn off all hardening. These flags can also be used as environment variables for testing or development purposes.</p>
<p>For more in-depth information on these hardening flags and hardening in general, refer to the <a href="https://wiki.debian.org/Hardening">Debian Wiki</a>, <a href="https://wiki.ubuntu.com/Security/Features">Ubuntu Wiki</a>, <a href="https://wiki.gentoo.org/wiki/Project:Hardened">Gentoo Wiki</a>, and the <a href="https://wiki.archlinux.org/title/Security">Arch Wiki</a>.</p>
<h3 id="sec-hardening-flags-enabled-by-default">Hardening flags enabled by default<a class="headerlink" href="#sec-hardening-flags-enabled-by-default" title="Permanent link">#</a></h3>
<p>The following flags are enabled by default and might require disabling with <code>hardeningDisable</code> if the program to package is incompatible.</p>
<h4 id="format"><code>format</code><a class="headerlink" href="#format" title="Permanent link">#</a></h4>
<p>Adds the <code>-Wformat -Wformat-security -Werror=format-security</code> compiler options. At present, this warns about calls to <code>printf</code> and <code>scanf</code> functions where the format string is not a string literal and there are no format arguments, as in <code>printf(foo);</code>. This may be a security hole if the format string came from untrusted input and contains <code>%n</code>.</p>
<p>This needs to be turned off or fixed for errors similar to:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>/tmp/nix-build-zynaddsubfx-2.5.2.drv-0/zynaddsubfx-2.5.2/src/UI/guimain.cpp:571:28: error: format not a string literal and no format arguments [-Werror=format-security]
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>         printf(help_message);
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>                            ^
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>cc1plus: some warnings being treated as errors
</span></code></pre></div>
<h4 id="stackprotector"><code>stackprotector</code><a class="headerlink" href="#stackprotector" title="Permanent link">#</a></h4>
<p>Adds the <code>-fstack-protector-strong --param ssp-buffer-size=4</code> compiler options. This adds safety checks against stack overwrites rendering many potential code injection attacks into aborting situations. In the best case this turns code injection vulnerabilities into denial of service or into non-issues (depending on the application).</p>
<p>This needs to be turned off or fixed for errors similar to:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>bin/blib.a(bios_console.o): In function `bios_handle_cup&#39;:
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>/tmp/nix-build-ipxe-20141124-5cbdc41.drv-0/ipxe-5cbdc41/src/arch/i386/firmware/pcbios/bios_console.c:86: undefined reference to `__stack_chk_fail&#39;
</span></code></pre></div>
<h4 id="fortify"><code>fortify</code><a class="headerlink" href="#fortify" title="Permanent link">#</a></h4>
<p>Adds the <code>-O2 -D_FORTIFY_SOURCE=2</code> compiler options. During code generation the compiler knows a great deal of information about buffer sizes (where possible), and attempts to replace insecure unlimited length buffer function calls with length-limited ones. This is especially useful for old, crufty code. Additionally, format strings in writable memory that contain <code>%n</code> are blocked. If an application depends on such a format string, it will need to be worked around.</p>
<p>Additionally, some warnings are enabled which might trigger build failures if compiler warnings are treated as errors in the package build. In this case, set <code>env.NIX_CFLAGS_COMPILE</code> to <code>-Wno-error=warning-type</code>.</p>
<p>This needs to be turned off or fixed for errors similar to:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>malloc.c:404:15: error: return type is an incomplete type
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>malloc.c:410:19: error: storage size of &#39;ms&#39; isn&#39;t known
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>strdup.h:22:1: error: expected identifier or &#39;(&#39; before &#39;__extension__&#39;
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>strsep.c:65:23: error: register name not specified for &#39;delim&#39;
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>installwatch.c:3751:5: error: conflicting types for &#39;__open_2&#39;
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>fcntl2.h:50:4: error: call to &#39;__open_missing_mode&#39; declared with attribute error: open with O_CREAT or O_TMPFILE in second argument needs 3 arguments
</span></code></pre></div>
<h4 id="pic"><code>pic</code><a class="headerlink" href="#pic" title="Permanent link">#</a></h4>
<p>Adds the <code>-fPIC</code> compiler options. This options adds support for position independent code in shared libraries and thus making ASLR possible.</p>
<p>Most notably, the Linux kernel, kernel modules and other code not running in an operating system environment like boot loaders won’t build with PIC enabled. The compiler will is most cases complain that PIC is not supported for a specific build.</p>
<p>This needs to be turned off or fixed for assembler errors similar to:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>ccbLfRgg.s: Assembler messages:
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>ccbLfRgg.s:33: Error: missing or invalid displacement expression `private_key_len@GOTOFF&#39;
</span></code></pre></div>
<h4 id="strictoverflow"><code>strictoverflow</code><a class="headerlink" href="#strictoverflow" title="Permanent link">#</a></h4>
<p>Signed integer overflow is undefined behaviour according to the C standard. If it happens, it is an error in the program as it should check for overflow before it can happen, not afterwards. GCC provides built-in functions to perform arithmetic with overflow checking, which are correct and faster than any custom implementation. As a workaround, the option <code>-fno-strict-overflow</code> makes gcc behave as if signed integer overflows were defined.</p>
<p>This flag should not trigger any build or runtime errors.</p>
<h4 id="relro"><code>relro</code><a class="headerlink" href="#relro" title="Permanent link">#</a></h4>
<p>Adds the <code>-z relro</code> linker option. During program load, several ELF memory sections need to be written to by the linker, but can be turned read-only before turning over control to the program. This prevents some GOT (and .dtors) overwrite attacks, but at least the part of the GOT used by the dynamic linker (.got.plt) is still vulnerable.</p>
<p>This flag can break dynamic shared object loading. For instance, the module systems of Xorg and OpenCV are incompatible with this flag. In almost all cases the <code>bindnow</code> flag must also be disabled and incompatible programs typically fail with similar errors at runtime.</p>
<h4 id="bindnow"><code>bindnow</code><a class="headerlink" href="#bindnow" title="Permanent link">#</a></h4>
<p>Adds the <code>-z now</code> linker option. During program load, all dynamic symbols are resolved, allowing for the complete GOT to be marked read-only (due to <code>relro</code>). This prevents GOT overwrite attacks. For very large applications, this can incur some performance loss during initial load while symbols are resolved, but this shouldn’t be an issue for daemons.</p>
<p>This flag can break dynamic shared object loading. For instance, the module systems of Xorg and PHP are incompatible with this flag. Programs incompatible with this flag often fail at runtime due to missing symbols, like:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>intel_drv.so: undefined symbol: vgaHWFreeHWRec
</span></code></pre></div>
<h3 id="sec-hardening-flags-disabled-by-default">Hardening flags disabled by default<a class="headerlink" href="#sec-hardening-flags-disabled-by-default" title="Permanent link">#</a></h3>
<p>The following flags are disabled by default and should be enabled with <code>hardeningEnable</code> for packages that take untrusted input like network services.</p>
<h4 id="pie"><code>pie</code><a class="headerlink" href="#pie" title="Permanent link">#</a></h4>
<p>This flag is disabled by default for normal <code>glibc</code> based NixOS package builds, but enabled by default for <code>musl</code> based package builds.</p>
<p>Adds the <code>-fPIE</code> compiler and <code>-pie</code> linker options. Position Independent Executables are needed to take advantage of Address Space Layout Randomization, supported by modern kernel versions. While ASLR can already be enforced for data areas in the stack and heap (brk and mmap), the code areas must be compiled as position-independent. Shared libraries already do this with the <code>pic</code> flag, so they gain ASLR automatically, but binary .text regions need to be build with <code>pie</code> to gain ASLR. When this happens, ROP attacks are much harder since there are no static locations to bounce off of during a memory corruption attack.</p>
<p>Static libraries need to be compiled with <code>-fPIE</code> so that executables can link them in with the <code>-pie</code> linker option.
If the libraries lack <code>-fPIE</code>, you will get the error <code>recompile with -fPIE</code>.</p>
<p>[^footnote-stdenv-ignored-build-platform]: The build platform is ignored because it is a mere implementation detail of the package satisfying the dependency: As a general programming principle, dependencies are always <em>specified</em> as interfaces, not concrete implementation.
[^footnote-stdenv-native-dependencies-in-path]: Currently, this means for native builds all dependencies are put on the <code>PATH</code>. But in the future that may not be the case for sake of matching cross: the platforms would be assumed to be unique for native and cross builds alike, so only the <code>depsBuild*</code> and <code>nativeBuildInputs</code> would be added to the <code>PATH</code>.
[^footnote-stdenv-propagated-dependencies]: Nix itself already takes a package’s transitive dependencies into account, but this propagation ensures nixpkgs-specific infrastructure like <a href="#ssec-setup-hooks">setup hooks</a> also are run as if it were a propagated dependency.
[^footnote-stdenv-find-inputs-location]: The <code>findInputs</code> function, currently residing in <code>pkgs/stdenv/generic/setup.sh</code>, implements the propagation logic.
[^footnote-stdenv-sys-lib-search-path]: It clears the <code>sys_lib_*search_path</code> variables in the Libtool script to prevent Libtool from using libraries in <code>/usr/lib</code> and such.
[^footnote-stdenv-build-time-guessing-impurity]: Eventually these will be passed building natively as well, to improve determinism: build-time guessing, as is done today, is a risk of impurity.
[^footnote-stdenv-per-platform-wrapper]: Each wrapper targets a single platform, so if binaries for multiple platforms are needed, the underlying binaries must be wrapped multiple times. As this is a property of the wrapper itself, the multiple wrappings are needed whether or not the same underlying binaries can target multiple platforms.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="platform-notes.chapter.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Platform Notes">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Platform Notes
              </div>
            </div>
          </a>
        
        
          
          <a href="../using/configuration.chapter.html" class="md-footer__link md-footer__link--next" aria-label="Next: Global configuration">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Global configuration
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 <a href=https://nervosys.ai/>Nervosys, LLC</a>
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/nervosys/Botnix" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://discord.gg/x84JXYje" target="_blank" rel="noopener" title="discord.gg" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://x.com/nervosys" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.tabs.link", "navigation.expand", "navigation.top", "navigation.instant", "navigation.path", "navigation.footer", "search.suggest", "search.share", "toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest"}}</script>
    
    
      <script src="../assets/javascripts/bundle.caa56a14.min.js"></script>
      
        <script src="../javascripts/extra.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>